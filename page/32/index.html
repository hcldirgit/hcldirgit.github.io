<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>失落的乐章</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="失落的乐章的Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="失落的乐章">
<meta property="og:url" content="https://hcldirgit.github.io/page/32/index.html">
<meta property="og:site_name" content="失落的乐章">
<meta property="og:description" content="失落的乐章的Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="失落的乐章">
<meta name="twitter:description" content="失落的乐章的Blog">
  
    <link rel="alternative" href="/atom.xml" title="失落的乐章" type="application/atom+xml">
  
  
    <link rel="icon" href="https://github.com/hcldirgit/image/blob/master/0.png?raw=true">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85415703-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">失落的乐章</a></h1>
		</hgroup>

		
		<p class="header-subtitle">技术面前，永远都是学生。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags">静心阅读</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Ansible/" style="font-size: 10.42px;">Ansible</a> <a href="/tags/Apache/" style="font-size: 18.33px;">Apache</a> <a href="/tags/Cacti/" style="font-size: 11.67px;">Cacti</a> <a href="/tags/DNS/" style="font-size: 13.33px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/FTP/" style="font-size: 11.25px;">FTP</a> <a href="/tags/Git/" style="font-size: 10.83px;">Git</a> <a href="/tags/HA集群/" style="font-size: 11.67px;">HA集群</a> <a href="/tags/Hadoop/" style="font-size: 12.5px;">Hadoop</a> <a href="/tags/Jenkins/" style="font-size: 10.42px;">Jenkins</a> <a href="/tags/LAMP/" style="font-size: 19.58px;">LAMP</a> <a href="/tags/LNMP/" style="font-size: 17.08px;">LNMP</a> <a href="/tags/LVS/" style="font-size: 16.67px;">LVS</a> <a href="/tags/Linux/" style="font-size: 19.17px;">Linux</a> <a href="/tags/Linux命令/" style="font-size: 20px;">Linux命令</a> <a href="/tags/Linux安全/" style="font-size: 14.17px;">Linux安全</a> <a href="/tags/Memcached/" style="font-size: 11.25px;">Memcached</a> <a href="/tags/MongoDB/" style="font-size: 15.42px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 17.5px;">MySQL</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/Nagios/" style="font-size: 11.67px;">Nagios</a> <a href="/tags/Nginx/" style="font-size: 17.92px;">Nginx</a> <a href="/tags/OpenStack/" style="font-size: 11.25px;">OpenStack</a> <a href="/tags/Php/" style="font-size: 14.58px;">Php</a> <a href="/tags/Puppet/" style="font-size: 11.25px;">Puppet</a> <a href="/tags/Python/" style="font-size: 14.58px;">Python</a> <a href="/tags/Redis/" style="font-size: 16.25px;">Redis</a> <a href="/tags/Resin/" style="font-size: 10px;">Resin</a> <a href="/tags/Saltstack/" style="font-size: 10px;">Saltstack</a> <a href="/tags/Samba/" style="font-size: 12.08px;">Samba</a> <a href="/tags/Squid/" style="font-size: 14.58px;">Squid</a> <a href="/tags/Tomcat/" style="font-size: 13.75px;">Tomcat</a> <a href="/tags/Zabbix/" style="font-size: 15.83px;">Zabbix</a> <a href="/tags/haproxy/" style="font-size: 12.5px;">haproxy</a> <a href="/tags/keepalived/" style="font-size: 12.92px;">keepalived</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/shell练习/" style="font-size: 18.75px;">shell练习</a> <a href="/tags/正则表达式/" style="font-size: 12.92px;">正则表达式</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">失落的乐章</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">失落的乐章</h1>
			</hgroup>
			
			<p class="header-subtitle">技术面前，永远都是学生。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags">静心阅读</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-Memcached/1. Memcached" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Memcached/1. Memcached/" class="article-date">
  	<time datetime="2017-09-02T18:04:45.994Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Memcached/1. Memcached/">
        Memcached
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-memcached介绍"><a href="#1-memcached介绍" class="headerlink" title="1.memcached介绍"></a>1.memcached介绍</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;是国外社区网站LiveJournal团队开发，通过缓存数据库查询结果，减少数据库访问次数，从而提高动态web站点性能。<a href="http://memcached.org/" target="_blank" rel="external">官方站点</a></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;基于c/s架构，协议简单</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;基于libevent的事件处理</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;自主内存存储处理（slab allowcation)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;数据过期方式：Lazy Expiration 和 LRU</p>
<h2 id="2-memcached数据流"><a href="#2-memcached数据流" class="headerlink" title="2.memcached数据流"></a>2.memcached数据流</h2><p><img src="https://github.com/hcldirgit/image/blob/master/memcached/01.png?raw=true" alt=""></p>
<h2 id="3-slab-allocation"><a href="#3-slab-allocation" class="headerlink" title="3.slab allocation"></a>3.slab allocation</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Slab Allocation的原理——将分配的内存分割成各种尺寸的块（chunk）， 并把尺寸相同的块分成组（chunk的集合），每个chunk集合被称为slab。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Memcached的内存分配以Page为单位，Page默认值为1M，可以在启动时通过-I参数来指定。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Slab是由多个Page组成的，Page按照指定大小切割成多个chunk。其结构如图</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached/02.png?raw=true" alt=""></p>
<h2 id="4-Growth-factor"><a href="#4-Growth-factor" class="headerlink" title="4.Growth factor"></a>4.Growth factor</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;memcached在启动时通过-f选项可以指定 Growth Factor因子。该值控制chunk大小的差异。默认值为1.25。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;通过memcached-tool查看指定memcached实例的不同slab状态，可以看到各Item所占大小（chunk大小）差距为1.25</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">memcached-tool 127.0.0.1:11211 display</div></pre></td></tr></table></figure>
<h2 id="5-memcached数据过期方式"><a href="#5-memcached数据过期方式" class="headerlink" title="5.memcached数据过期方式"></a>5.memcached数据过期方式</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Lazy Expiration </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;memcached 内部不会监视记录是否过期，而是在get时查看记录的时间戳，检查记录是否过期。这种技术被称为lazy（惰性）expiration。因此，memcached不会在过期监视上耗费CPU时间。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;LRU</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;memcached会优先使用已超时的记录的空间，但即使如此，也会发生追加新记录时空间不足的情况，此时就要使用名为Least Recently Used（LRU）机制来分配空间。顾名思义，这是删除“最近最少使用”的记录的机制。因此，当内存空间不足时（无法从slab class获取到新的空间时），就从最近未被使用的记录中搜索，并将其空间分配给新的记录。从缓存的实用角度来看，该模型十分理想。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Memcached/">Memcached</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Memcached/2. memcached安装" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Memcached/2. memcached安装/" class="article-date">
  	<time datetime="2017-09-02T18:04:45.994Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Memcached/2. memcached安装/">
        memcached安装
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-memcached安装"><a href="#1-memcached安装" class="headerlink" title="1.memcached安装"></a>1.memcached安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># yum install -y epel-release</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># yum install -y libevent memcached libmemcached</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动 /etc/init.d/memcached start</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># service memcached start</span></div><div class="line">正在启动 memcached： [确定]</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># ps aux |grep memcached</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/01.png?raw=true" alt="01"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;memcached -d -p 11211 -u memcached -m 64 -c 1024 -P /var/run/memcached/memcached.pid</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;相关的参数在/etc/init.d/memcached和/etc/sysconfig/memcached中定义</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># vim /etc/sysconfig/memcached</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/02.png?raw=true" alt="02"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改为</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/03.png?raw=true" alt="03"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;将内存改为 128m</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;重启服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># /etc/init.d/memcached restart</span></div><div class="line">停止 memcached：     [确定]</div><div class="line">正在启动 memcached：  [确定]</div></pre></td></tr></table></figure>
<h3 id="memcached-启动参数"><a href="#memcached-启动参数" class="headerlink" title="memcached 启动参数"></a>memcached 启动参数</h3><ul>
<li>-d选项是启动一个守护进程</li>
<li>-m是分配给Memcache使用的内存数量，单位是MB，这里是200MB </li>
<li>-u是运行Memcache的用户，如果当前为 root 的话，需要使用此参数指定用户。 </li>
<li>-l是监听的服务器IP地址</li>
<li>-p是设置Memcache监听的端口，默认是11211</li>
<li>-c选项是最大运行的并发连接数，默认是1024</li>
<li>-P是设置保存Memcache的pid文件 </li>
</ul>
<h3 id="查看-memcached-运行状态"><a href="#查看-memcached-运行状态" class="headerlink" title="查看 memcached 运行状态"></a>查看 memcached 运行状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># memcached-tool 127.0.0.1:11211 stats</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/04.png?raw=true" alt="04"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># echo stats | nc 127.0.0.1:11211</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;需要安装nc工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># yum install -y nc</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/05.png?raw=true" alt="05"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;若安装libmemcached后，可以使用命令 </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;memstat –servers=127.0.0.1:11211 查看memcached服务状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># memstat --servers=127.0.0.1:11211</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/06.png?raw=true" alt="06"></p>
<h2 id="2-memcached-基本命令"><a href="#2-memcached-基本命令" class="headerlink" title="2.memcached 基本命令"></a>2.memcached 基本命令</h2><h3 id="memcached-命令行"><a href="#memcached-命令行" class="headerlink" title="memcached 命令行"></a>memcached 命令行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># telnet 127.0.0.1 11211</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/07.png?raw=true" alt="07"></p>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/08.png?raw=true" alt="08"></p>
<h3 id="mamcached-语法规则"><a href="#mamcached-语法规则" class="headerlink" title="mamcached 语法规则"></a>mamcached 语法规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="built_in">command</span> name&gt; &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt;\r\n &lt;data block&gt;\r\n</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注：\r\n在windows下是Enter键</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a) <command name=""> 可以是”set”, “add”, “replace”。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;“set”表示按照相应的<key>存储该数据，没有的时候增加，有的覆盖。</key></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; “add”表示按照相应的<key>添加该数据,但是如果该<key>已经存在则会操作失败。</key></key></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; “replace”表示按照相应的<key>替换数据,但是如果该<key>不存在则操作失败。</key></key></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;b) <key> 客户端需要保存数据的key。</key></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;c) <flags> 是一个16位的无符号的整数(以十进制的方式表示)。</flags></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;该标志将和需要存储的数据一起存储,并在客户端get数据时返回。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;客户可以将此标志用做特殊用途，此标志对服务器来说是不透明的。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;d) <exptime> 过期的时间。</exptime></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;若为0表示存储的数据永远不过期(但可被服务器算法：LRU 等替换)。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果非0(unix时间或者距离此时的秒数),当过期后,服务器可以保证用户得不到该数据(以服务器时间为标准)。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;e) <bytes> 需要存储的字节数，当用户希望存储空数据时<bytes>可以为0</bytes></bytes></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;f) <data block="">需要存储的内容，输入完成后，最后客户端需要加上”\r\n”（直接点击Enter）作为”命令头”的结束标志。</data></p>
<h3 id="memcached-数据示例"><a href="#memcached-数据示例" class="headerlink" title="memcached 数据示例"></a>memcached 数据示例</h3><p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/09.png?raw=true" alt="09"></p>
<h2 id="3-PHP-连接-memcached"><a href="#3-PHP-连接-memcached" class="headerlink" title="3.PHP 连接 memcached"></a>3.PHP 连接 memcached</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;先安装php的memcache扩展</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># wget http://www.lishiming.net/data/attachment/forum/memcache-2.2.3.tgz</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># tar zxf memcache-2.2.3.tgz </span></div><div class="line">[root@memcached ~]<span class="comment"># cd memcache-2.2.3</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached memcache-2.2.3]<span class="comment"># /usr/local/php/bin/phpize</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/10.png?raw=true" alt="10"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached memcache-2.2.3]<span class="comment"># ./configure --with-php-config=/usr/local/php/bin/php-config</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached memcache-2.2.3]<span class="comment"># make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;安装完后会有类似这样的提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Installing shared extensions: /usr/<span class="built_in">local</span>/php/lib/php/extensions/no-debug-non-zts-20131226/</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/11.png?raw=true" alt="11"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把这个记住，然后修改php.ini</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached memcache-2.2.3]<span class="comment"># vim /usr/local/php/etc/php.ini</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把 extension_dir = “./“ 修改为<br>extension_dir = “/usr/local/php/lib/php/extensions/no-debug-non-zts-20131226/“</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/12.png?raw=true" alt="12"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改为</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/13.png?raw=true" alt="13"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;并添加一行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">extension = <span class="string">"memcache.so"</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/14.png?raw=true" alt="14"></p>
<h3 id="PHP-连接-memcached-检验"><a href="#PHP-连接-memcached-检验" class="headerlink" title="PHP 连接 memcached 检验"></a>PHP 连接 memcached 检验</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;检查模块是否添加正常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached memcache-2.2.3]<span class="comment"># /usr/local/php/bin/php -m | grep memcache</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/15.png?raw=true" alt="15"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;模块中有 memcache 说明配置成功</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下载测试php脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached memcache-2.2.3]<span class="comment"># curl www.apelearn.com/study_v2/.memcache.txt &gt; 1.php 2&gt;/dev/null</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;执行脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached memcache-2.2.3]<span class="comment"># /usr/local/php/bin/php 1.php</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/16.png?raw=true" alt="16"></p>
<h2 id="4-memcached-实现-session-共享"><a href="#4-memcached-实现-session-共享" class="headerlink" title="4.memcached 实现 session 共享"></a>4.memcached 实现 session 共享</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;本实例是在lamp/lnmp环境下实现</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编辑php.ini添加两行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># vim /usr/local/php/etc/php.ini</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">session.save_handler = memcache </div><div class="line">session.save_path = <span class="string">"tcp://127.0.0.1:11211"</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/17.png?raw=true" alt="17"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果 session 服务器在远程这里输入远程的 IP 地址</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;或者httpd.conf中对应的虚拟主机中添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># vim /usr/local/apache2/conf/httpd.conf</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">php_value session.save_handler <span class="string">"memcache"</span> </div><div class="line">php_value session.save_path <span class="string">"tcp://192.168.0.9:11211"</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 或者php-fpm.conf对应的pool中添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">php_value[session.save_handler] = memcache</div><div class="line">php_value[session.save_path] = <span class="string">" tcp://192.168.0.9:11211 "</span></div></pre></td></tr></table></figure>
<h3 id="memcached-session测试"><a href="#memcached-session测试" class="headerlink" title="memcached session测试"></a>memcached session测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># wget http://study.lishiming.net/.mem_se.txt</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># mv .mem_se.txt /usr/local/apache2/htdocs/session.php</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># curl localhost/session.php</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/18.png?raw=true" alt="18"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;类似于1443702394<br><br>1443702394<br><br>i44nunao0g3o7vf2su0hnc5440</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@memcached ~]<span class="comment"># telnet 127.0.0.1 11211</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/memcached%E5%AE%89%E8%A3%85/19.png?raw=true" alt="19"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Memcached/">Memcached</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Git/1. Git安装使用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Git/1. Git安装使用/" class="article-date">
  	<time datetime="2017-09-02T18:02:06.177Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Git/1. Git安装使用/">
        Git安装使用
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-安装git"><a href="#1-安装git" class="headerlink" title="1.安装git"></a>1.安装git</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;centos上  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum install -y epel-release</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum install -y git</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ubuntu上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install git</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;windows 上安装 msysgit,<a href="https://git-for-windows.github.io/" target="_blank" rel="external">下载地址</a></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;安装完成后，还需要最后一步设置  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># git config --global user.name "yanyi"</span></div><div class="line">[root@localhost ~]<span class="comment"># git config --global user.email "hcldir@qq.com"</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;设置完成会生成 .gitconfig 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ls -la</span></div><div class="line">-rw-r--r-- 1 root root 44 1月 6 20:01 .gitconfig</div><div class="line">[root@localhost ~]<span class="comment"># cat .gitconfig </span></div><div class="line">[user]</div><div class="line">      name = yanyi</div><div class="line">      email = hcldir@qq.com</div></pre></td></tr></table></figure>
<h2 id="2-创建版本库"><a href="#2-创建版本库" class="headerlink" title="2.创建版本库"></a>2.创建版本库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># mkdir /home/gitroot</span></div><div class="line">[root@localhost ~]<span class="comment"># cd /home/gitroot</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git init</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /home/gitroot/.git/</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明：git init 用这个命令初始化，让这个目录变成git可以管理的仓库。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ls -a 可以看到多了一个 .git 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># ls -a</span></div><div class="line">. .. .git</div></pre></td></tr></table></figure>
<h2 id="3-提交文件到仓库"><a href="#3-提交文件到仓库" class="headerlink" title="3.提交文件到仓库"></a>3.提交文件到仓库</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建一个文件 1.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># echo -e "123\naaa\n456\nbbb" &gt; 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># cat 1.txt</span></div><div class="line">123</div><div class="line">aaa</div><div class="line">456</div><div class="line">bbb</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把1.txt添加到仓库中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git add 1.txt</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>add</strong> 完了必须要 <strong>commit</strong> 才算真正把文件提交到git仓库里</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git commit -m "add new file 1.txt"</span></div><div class="line">[master (root-commit) 0214d82] add new file 1.txt</div><div class="line"> 1 files changed, 4 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;更改 1.txt后，查看和版本库是否一致</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git status</span></div><div class="line"><span class="comment"># On branch master</span></div><div class="line"><span class="comment"># Changed but not updated:</span></div><div class="line"><span class="comment"># (use "git add &lt;file&gt;..." to update what will be committed)</span></div><div class="line"><span class="comment"># (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># modified: 1.txt</span></div><div class="line"><span class="comment">#</span></div><div class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明：<strong>git status</strong>  查看当前仓库中的状态，比如是否有改动的文件  </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果不提交，需要把文件恢复成版本库里的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git checkout -- 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># cat 1.txt</span></div><div class="line">123</div><div class="line">aaa</div><div class="line">456</div><div class="line">bbb</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再次执行 git status 命令，提示没有任何更改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git status</span></div><div class="line"><span class="comment"># On branch master</span></div><div class="line">nothing to commit (working directory clean)</div><div class="line">``` </div><div class="line"></div><div class="line">&amp;<span class="comment">#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;再次修改 1.txt文件，对比修改内容</span></div><div class="line"></div><div class="line">```bash</div><div class="line">[root@localhost gitroot]<span class="comment"># echo -e "111111\n2222222222" &gt;&gt; 1.txt </span></div><div class="line">[root@localhost gitroot]<span class="comment"># git status</span></div><div class="line"><span class="comment"># On branch master</span></div><div class="line"><span class="comment"># Changed but not updated:</span></div><div class="line"><span class="comment"># (use "git add &lt;file&gt;..." to update what will be committed)</span></div><div class="line"><span class="comment"># (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># modified: 1.txt</span></div><div class="line"><span class="comment">#</span></div><div class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</div><div class="line">[root@localhost gitroot]<span class="comment"># git diff 1.txt</span></div><div class="line">diff --git a/1.txt b/1.txt</div><div class="line">index b149eee..aa2d2ae 100644</div><div class="line">--- a/1.txt</div><div class="line">+++ b/1.txt</div><div class="line">@@ -2,3 +2,5 @@</div><div class="line"> aaa</div><div class="line"> 456</div><div class="line"> bbb</div><div class="line">+111111</div><div class="line">+2222222222</div></pre></td></tr></table></figure>
<p>说明：<strong>git diff</strong> 1.txt  可以对比1.txt本次修改了什么内容，相比较仓库里面的版本。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把更改个文件提交到版本库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git add 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git commit -m "add a line 1.txt"</span></div><div class="line">[master 182c98f] add a line 1.txt</div><div class="line">1 files changed, 2 insertions(+), 0 deletions(-)</div><div class="line">[root@localhost gitroot]<span class="comment"># git status</span></div><div class="line"><span class="comment"># On branch master</span></div><div class="line">nothing to commit (working directory clean)</div></pre></td></tr></table></figure>
<h2 id="4-版本回退"><a href="#4-版本回退" class="headerlink" title="4.版本回退"></a>4.版本回退</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;多更改几次1.txt，并进行 git add,  git commit操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># echo "asdfkjsadkjf" &gt;&gt; 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git add 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git commit -m "change 1.txt agin"</span></div><div class="line">[master 0c72aba] change 1.txt agin</div><div class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</div><div class="line">[root@localhost gitroot]<span class="comment"># echo "123456" &gt;&gt; 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git add 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git commit -m "change 1.txt agin agin"</span></div><div class="line">[master e4fe595] change 1.txt agin agin</div><div class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</div><div class="line">[root@localhost gitroot]<span class="comment"># git status</span></div><div class="line"><span class="comment"># On branch master</span></div><div class="line">nothing to commit (working directory clean)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git log</strong>  查看所有提交git仓库的记录操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git log</span></div><div class="line">commit e4fe59596fc6c16757cb1d772d775932701f86ab</div><div class="line">Author: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date:   Fri Jan 6 21:57:43 2017 +0800</div><div class="line"></div><div class="line">     change 1.txt agin agin</div><div class="line"></div><div class="line">commit 0c72aba21aba27ccc9c9873ec53c552d5474a02f</div><div class="line">Author: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date:   Fri Jan 6 21:56:41 2017 +0800</div><div class="line"></div><div class="line">     change 1.txt agin</div><div class="line"></div><div class="line">commit 182c98ff8798f47965ba44ed218e9da5e9964295</div><div class="line">Author: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date:   Fri Jan 6 20:34:15 2017 +0800</div><div class="line"></div><div class="line">     add a line 1.txt</div><div class="line"></div><div class="line">commit 0214d8252fd3c37a7f09fc32e8ff29d10d577230</div><div class="line">Author: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date:   Fri Jan 6 20:15:19 2017 +0800</div><div class="line"></div><div class="line">     add new file 1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;根据这个 log 可退回到前边某个版本</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git log –pretty=oneline</strong> 命令可以让每个版本单独一行显示，更清晰。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git log --pretty=oneline</span></div><div class="line">e4fe59596fc6c16757cb1d772d775932701f86ab change 1.txt agin agin</div><div class="line">0c72aba21aba27ccc9c9873ec53c552d5474a02f change 1.txt agin</div><div class="line">182c98ff8798f47965ba44ed218e9da5e9964295 add a line 1.txt</div><div class="line">0214d8252fd3c37a7f09fc32e8ff29d10d577230 add new file 1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git reset –hard 字符串</strong> 可以退回到以前版本，字符串可以简写，只写前边几位</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git reset --hard 182c</span></div><div class="line">HEAD is now at 182c98f add a line 1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;退回版本后，在 git log 则无法显示退回版本以上的版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git log --pretty=oneline</span></div><div class="line">182c98ff8798f47965ba44ed218e9da5e9964295 add a line 1.txt</div><div class="line">0214d8252fd3c37a7f09fc32e8ff29d10d577230 add new file 1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git reflog</strong> 可以显示所有版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git reflog</span></div><div class="line">e4fe595 HEAD@&#123;0&#125;: e4fe5: updating HEAD</div><div class="line">182c98f HEAD@&#123;1&#125;: 182c: updating HEAD</div><div class="line">e4fe595 HEAD@&#123;2&#125;: commit: change 1.txt agin agin</div><div class="line">0c72aba HEAD@&#123;3&#125;: commit: change 1.txt agin</div><div class="line">182c98f HEAD@&#123;4&#125;: commit: add a line 1.txt</div><div class="line">0214d82 HEAD@&#123;5&#125;: commit (initial): add new file 1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后可以使用 git reset –hard 字符串 再次退回版本。</p>
<h2 id="5-撤销修改（文件恢复）"><a href="#5-撤销修改（文件恢复）" class="headerlink" title="5.撤销修改（文件恢复）"></a>5.撤销修改（文件恢复）</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果修改文件后，发现改的不对，想恢复到上一次提交的状态，或不小心删除了文件。可以使用</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git checkout – file</strong> 恢复到上一次提交的状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git checkout 1.txt</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果文件修改完成，保存后，git add 了，但没有 commit ，想退回到上一次提交的状态可以用<strong>git reset HEAD <file></file></strong>，再使用 git checkout – file </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git add 1.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git status</span></div><div class="line"><span class="comment"># On branch master</span></div><div class="line"><span class="comment"># Changes to be committed:</span></div><div class="line"><span class="comment"># (use "git reset HEAD &lt;file&gt;..." to unstage)</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># modified: 1.txt</span></div><div class="line"><span class="comment">#</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git reset HEAD 1.txt</span></div><div class="line">Unstaged changes after reset:</div><div class="line">M 1.txt</div><div class="line">[root@localhost gitroot]<span class="comment"># git checkout -- 1.txt</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果不仅 add 又 commit 了，就用版本退回恢复到上一次提交状态。</p>
<h2 id="6-文件删除"><a href="#6-文件删除" class="headerlink" title="6.文件删除"></a>6.文件删除</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;新建 2.txt 文件，add 并 commit 提交到 git 仓库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># echo "2222222" &gt;&gt; 2.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git add 2.txt</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git commit -m " a new 2.txt"</span></div><div class="line">[master 44ec005] a new 2.txt</div><div class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 2.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下面删除它</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># rm -rf 2.txt</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;git status 可以看到，提示 2.txt 被删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git status</span></div><div class="line"><span class="comment"># On branch master</span></div><div class="line"><span class="comment"># Changed but not updated:</span></div><div class="line"><span class="comment"># (use "git add/rm &lt;file&gt;..." to update what will be committed)</span></div><div class="line"><span class="comment"># (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># deleted: 2.txt</span></div><div class="line"><span class="comment">#</span></div><div class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果需要恢复就用 git checkout – 2.txt，现在是要从 git 仓库里删除 2.txt，命令 <strong>git rm file</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># git rm 2.txt</span></div><div class="line">rm <span class="string">'2.txt'</span></div><div class="line">[root@localhost gitroot]<span class="comment"># git commit -m "delete 2.txt"</span></div><div class="line">[master b01be1a] delete 2.txt</div><div class="line"> 1 files changed, 0 insertions(+), 1 deletions(-)</div><div class="line"> delete mode 100644 2.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样就彻底从 git 仓库删除 2.txt 了</p>
<h2 id="7-创建远程仓库（github）"><a href="#7-创建远程仓库（github）" class="headerlink" title="7.创建远程仓库（github）"></a>7.创建远程仓库（github）</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先到 <a href="https://github.com/" target="_blank" rel="external">https://github.com/</a> 注册一个账号，创建自己的git，点repositories 再点new</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;名字自定义，比如叫studygit  选择public  点 create repository</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;添加key：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;右上角点自己头像，选择settings，左侧选择SSH and GPG keys</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;填写好标题，key 在自己主机上创建，命令 ssh-keygen</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># ssh-keygen</span></div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </div><div class="line">Created directory <span class="string">'/root/.ssh'</span>.</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </div><div class="line">Enter same passphrase again: </div><div class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</div><div class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">1f:5f:50:04:2b:80:16:16:e1:9a:a8:59:8c:0a:83:f4 root@localhost</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line"><span class="string">+--[ RSA 2048]----+</span></div><div class="line"><span class="string">|      ==.   .oo  |</span></div><div class="line"><span class="string">|     oo  .   o   | </span></div><div class="line"><span class="string">| .   ..   . o    |</span></div><div class="line"><span class="string">|oo.. o     . .   |</span></div><div class="line"><span class="string">|= +Eo   S .   .  |</span></div><div class="line"><span class="string">|o=       . o .   |</span></div><div class="line"><span class="string">|+         . .    |</span></div><div class="line"><span class="string">|                 |</span></div><div class="line"><span class="string">|                 |</span></div><div class="line"><span class="string">+-----------------+</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;右上角点New SSH key，把linux机器上的 /root/.ssh/id_rsa.pub内容粘贴到这里</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost gitroot]<span class="comment"># cat /root/.ssh/id_rsa.pub</span></div><div class="line">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAmTutzYNSxeZNJmHZXtczs8UbfvPZAkKF/Kwj4f8rlD5IG0Mml+euYjgzb2ppQzvh/sxqFJOKBvM9MhQ5MRc2t4eLm1U11FLyxLLJh6Kdtc6do8lWRJLJFOomkky6DQ4ISN8RinW6GMaT22H41xQ4LozIoA2EbYKELsno6MxbFqfwJlwSgv6WB3oBwDWYaY6nf7c04K2jH/xJwxLD8OyO+SzI15JdQBuZrgAXIvh5sQwwX6spKBKqyeYhTOGXZkkI8FSiY90ZMJrsxwZvbZVMNrpvFnXFN5f8ZHeVM33pTpT05EMLt+FrHixuccP8EJjq4efcwQQcrZJoFJYJZSy5vQ== root@localhost</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把本地仓库推送到远程仓库，命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git remote add origin git@github.com:hcldirgit/studygit.git</div><div class="line">git push -u origin master</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@localhost home]<span class="comment"># mkdir studygit</span></div><div class="line">[root@localhost home]<span class="comment"># cd studygit</span></div><div class="line">[root@localhost studygit]<span class="comment"># echo "# studygit" &gt;&gt; README.md</span></div><div class="line">[root@localhost studygit]<span class="comment"># git init</span></div><div class="line"> itialized empty Git repository <span class="keyword">in</span> /home/studygit/.git/</div><div class="line">[root@localhost studygit]<span class="comment"># git add README.md</span></div><div class="line">[root@localhost studygit]<span class="comment"># git commit -m "first commit"</span></div><div class="line">[master (root-commit) f3cba66] first commit</div><div class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 README.md</div><div class="line">[root@localhost studygit]<span class="comment"># git remote add origin git@github.com:hcldirgit/studygit.git</span></div><div class="line">[root@localhost studygit]<span class="comment"># git push -u origin master </span></div><div class="line">The authenticity of host <span class="string">'github.com (192.30.253.112)'</span> can<span class="string">'t be established.</span></div><div class="line"><span class="string">RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48.</span></div><div class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></div><div class="line"><span class="string">Warning: Permanently added '</span>github.com,192.30.253.112<span class="string">' (RSA) to the list of known hosts.</span></div><div class="line"><span class="string">Counting objects: 6, done.</span></div><div class="line"><span class="string">Delta compression using up to 4 threads.</span></div><div class="line"><span class="string">Compressing objects: 100% (4/4), done.</span></div><div class="line"><span class="string">Writing objects: 100% (6/6), 3.12 KiB, done.</span></div><div class="line"><span class="string">Total 6 (delta 0), reused 0 (delta 0)</span></div><div class="line"><span class="string">To git@github.com:hcldirgit/studygit.git</span></div><div class="line"><span class="string"> * [new branch] master -&gt; master</span></div><div class="line"><span class="string">Branch master set up to track remote branch master from origin.</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下一次再推送，就可以直接 git push </p>
<h2 id="8-克隆远程仓库"><a href="#8-克隆远程仓库" class="headerlink" title="8.克隆远程仓库"></a>8.克隆远程仓库</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在 github 上想把别人的仓库克隆下来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># cd /home/</span></div><div class="line">[root@localhost home]<span class="comment"># git clone git@github.com:aminglinux/lanmp.git</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /home/lanmp/.git/</div><div class="line">Warning: Permanently added the RSA host key <span class="keyword">for</span> IP address <span class="string">'192.30.253.113'</span> to the list of known hosts.</div><div class="line">remote: Counting objects: 26, <span class="keyword">done</span>.</div><div class="line">remote: Total 26 (delta 0), reused 0 (delta 0), pack-reused 26</div><div class="line">Receiving objects: 100% (26/26), 5.46 KiB, <span class="keyword">done</span>.</div><div class="line">Resolving deltas: 100% (4/4), <span class="keyword">done</span>.</div><div class="line">[root@localhost home]<span class="comment"># ls</span></div><div class="line">gitroot lanmp studygit</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;它提示，会在当前目录下初始化一个仓库，并创建一个.git的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Initialized empty Git repository <span class="keyword">in</span> /home/lanmp/.git/</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;完成后可以看到一个lanmp 的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost home]<span class="comment"># ls</span></div><div class="line">gitroot lanmp studygit</div><div class="line">[root@localhost home]<span class="comment"># cd lanmp</span></div><div class="line">[root@localhost lanmp]<span class="comment"># ls</span></div><div class="line">lanmp.sh README.md</div><div class="line">[root@localhost lanmp]<span class="comment"># cat README.md</span></div><div class="line"><span class="comment"># lanmp</span></div><div class="line">lamp/lnmp 一键安装脚本</div><div class="line">author: aming</div><div class="line">version: 0.2</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编辑修改后，使用 git push 再推送到远程服务端。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注：如果是克隆的别人的 git 仓库，则无法推送，因为别人没有加我的 key 。</p>
<h2 id="9-使用分支"><a href="#9-使用分支" class="headerlink" title="9.使用分支"></a>9.使用分支</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查看分支，命令 <strong>git branch</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git branch</span></div><div class="line">* master</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建分支，命令 <strong>git branch 分支名</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git branch yanyi</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;切换到创建分之下，<strong>git checkout 分支名</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git checkout yanyi</span></div><div class="line">Switched to branch <span class="string">'yanyi'</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在新分支下，创建文件并提交</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># echo "234qw34\qwerqwer" &gt; 2.txt</span></div><div class="line">[root@localhost studygit]<span class="comment"># git add 2.txt</span></div><div class="line">[root@localhost studygit]<span class="comment"># git commit -m "add new 2.txt"</span></div><div class="line">[yanyi acbc9ea] add new 2.txt</div><div class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 2.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;切换到 master 分支，查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git checkout master</span></div><div class="line">Switched to branch <span class="string">'master'</span></div><div class="line">[root@localhost studygit]<span class="comment"># ls</span></div><div class="line">lanmp.sh README.md</div></pre></td></tr></table></figure>
<h2 id="10-分支的合并和删除"><a href="#10-分支的合并和删除" class="headerlink" title="10.分支的合并和删除"></a>10.分支的合并和删除</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>把 yanyi 分支合并到 master  ，命令 <code>git merge yanyi</code> 。注意必须先切换到 master 分支下执行命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git checkout master</span></div><div class="line">Switched to branch <span class="string">'master'</span></div><div class="line">[root@localhost studygit]<span class="comment"># git merge yanyi </span></div><div class="line">Updating 23545a4..acbc9ea</div><div class="line">Fast-forward</div><div class="line"> 2.txt | 1 +</div><div class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 2.txt</div><div class="line">[root@localhost studygit]<span class="comment"># ls</span></div><div class="line">2.txt lanmp.sh README.md</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果master分支和yanyi分支都对2.txt进行了编辑，当合并时会提示冲突，需要先解决冲突才可以继续合并。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决冲突的方法是在master分支下，编辑2.txt，改为yanyi分支里面2.txt的内容。 然后提交2.txt，再合并yanyi分支。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;但是这样有一个问题，万一master分支更改的内容是我们想要的呢？ 我们可以编辑2.txt内容，改为我们想要的，然后提交。切换到yanyi分支，然后合并master分支到yanyi分支即可。（倒着合并）合并分支有一个原则，那就是要把最新的分支合并到旧的分支。也就是说merge后面跟的分支名字一定是最新的分支。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>删除分支，命令 <code>git branch -d 分支名</code></strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>如果分支没有合并，删除之前会提示。不合并，强制删除，命令 <code>git branch -D 分支名</code></strong></p>
<h2 id="11-分支使用原则"><a href="#11-分支使用原则" class="headerlink" title="11.分支使用原则"></a>11.分支使用原则</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;对于分支的应用，建议大家以这样的原则来：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;master分支是非常重要的，线上发布代码用这个分支，平时我们开发代码不要在这个分支上。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建一个dev分支，专门用作开发，只有当发布到线上之前，才会把dev分支合并到master</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;开发人员应该在dev的基础上再分支成个人分支，个人分支（在自己pc上）里面开发代码，然后合并到dev分支</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Git%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/01.png?raw=true" alt=""></p>
<h2 id="12-git-stash-保留现场"><a href="#12-git-stash-保留现场" class="headerlink" title="12.git stash 保留现场"></a>12.git stash 保留现场</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;当你正在进行项目中某一部分的工作，里面的东西处于一个比较杂乱的状态，而你想转到其他分支上进行一些工作。问题是，你不想提交进行了一半的工作，否则以后你无法回到这个工作点。解决这个问题的办法就是<strong>git stash</strong>命令。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;比如我们在 yanyi 分支，编辑了一个新的文件3.txt</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这时候我们需要到其他分支去修复一个bug，所以需要先git add 3.txt</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后 git  stash  保存一下现场</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再切换到另外分支去修复bug，修复完bug后，再回到 yanyi 分支</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git stash list</strong> 可以看到我们保存过的现场</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;用 <strong>git stash apply</strong> 恢复现场</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以指定stash：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git stash apply stash@{0}</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># echo "wqerqwer\asdasg\q1234234" &gt; 3.txt</span></div><div class="line">[root@localhost studygit]<span class="comment"># ls</span></div><div class="line">2.txt 3.txt lanmp.sh README.md</div><div class="line">[root@localhost studygit]<span class="comment"># git add 3.txt</span></div><div class="line">[root@localhost studygit]<span class="comment"># git stash</span></div><div class="line">Saved working directory and index state WIP on yanyi: acbc9ea add new 2.txt</div><div class="line">HEAD is now at acbc9ea add new 2.txt</div><div class="line">[root@localhost studygit]<span class="comment"># git stash list</span></div><div class="line">stash@&#123;0&#125;: WIP on yanyi: acbc9ea add new 2.txt</div><div class="line">[root@localhost studygit]<span class="comment"># git stash apply stash@&#123;0&#125;</span></div><div class="line"><span class="comment"># On branch yanyi</span></div><div class="line"><span class="comment"># Changes to be committed:</span></div><div class="line"><span class="comment"># (use "git reset HEAD &lt;file&gt;..." to unstage)</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># new file: 3.txt</span></div><div class="line"><span class="comment">#</span></div><div class="line">[root@localhost studygit]<span class="comment"># ls</span></div><div class="line">2.txt 3.txt lanmp.sh README.md</div></pre></td></tr></table></figure>
<h2 id="13-远程分支管理"><a href="#13-远程分支管理" class="headerlink" title="13.远程分支管理"></a>13.远程分支管理</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查看远程库信息，使用<strong>git remote -v</strong> 本地新建的分支如果不推送到远程，对其他人就是不可见的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git remote -v</span></div><div class="line">origin git@github.com:hcldirgit/studygit.git (fetch)</div><div class="line">origin git@github.com:hcldirgit/studygit.git (push)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查看远程分支 <strong>git ls-remote origin</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git ls-remote origin</span></div><div class="line">acbc9ea125b527e9f3ab30dcf5f5b3e415c760e1 HEAD</div><div class="line">acbc9ea125b527e9f3ab30dcf5f5b3e415c760e1 refs/heads/dev</div><div class="line">acbc9ea125b527e9f3ab30dcf5f5b3e415c760e1 refs/heads/master</div><div class="line">acbc9ea125b527e9f3ab30dcf5f5b3e415c760e1 refs/heads/yanyi</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;从本地推送分支，使用<strong>git push origin branch-name</strong>，如果推送失败，先用<strong>git pull</strong>抓取远程的新提交</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git push origin yanyi</span></div><div class="line">Everything up-to-date</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git pull</span></div><div class="line">Already up-to-date.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在本地创建和远程分支对应的分支，使用<strong>git checkout -b branch-name origin/branch-name</strong>，本地和远程分支的名称最好一致</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@localhost home]<span class="comment"># rm -rf studygit</span></div><div class="line">[root@localhost home]<span class="comment"># git clone git@github.com:hcldirgit/studygit.git</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /home/studygit/.git/</div><div class="line">remote: Counting objects: 9, <span class="keyword">done</span>.</div><div class="line">remote: Compressing objects: 100% (6/6), <span class="keyword">done</span>.</div><div class="line">remote: Total 9 (delta 0), reused 9 (delta 0), pack-reused 0</div><div class="line">Receiving objects: 100% (9/9), <span class="keyword">done</span>.</div><div class="line">[root@localhost home]<span class="comment"># cd studygit</span></div><div class="line">[root@localhost studygit]<span class="comment"># ls</span></div><div class="line">2.txt lanmp.sh README.md</div><div class="line">[root@localhost studygit]<span class="comment"># git branch</span></div><div class="line">* master</div><div class="line">[root@localhost studygit]<span class="comment"># git checkout -b dev origin/dev</span></div><div class="line">Branch dev <span class="built_in">set</span> up to track remote branch dev from origin.</div><div class="line">Switched to a new branch <span class="string">'dev'</span></div><div class="line">[root@localhost studygit]<span class="comment"># git checkout -b yanyi origin/yanyi</span></div><div class="line">Branch yanyi <span class="built_in">set</span> up to track remote branch yanyi from origin.</div><div class="line">Switched to a new branch <span class="string">'yanyi'</span></div><div class="line">[root@localhost studygit]<span class="comment"># git checkout -b yi origin/yi </span></div><div class="line">Branch yi <span class="built_in">set</span> up to track remote branch yi from origin.</div><div class="line">Switched to a new branch <span class="string">'yi'</span></div><div class="line">[root@localhost studygit]<span class="comment"># git branch</span></div><div class="line"> dev</div><div class="line"> master</div><div class="line"> yanyi</div><div class="line">* yi</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;从远程抓取分支，使用<strong>git pull</strong>，如果有冲突，要先处理冲突。</p>
<h2 id="14-标签管理"><a href="#14-标签管理" class="headerlink" title="14.标签管理"></a>14.标签管理</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;标签类似于快照功能，我们可以给版本库打一个标签，记录某个时刻库的状态。我们可以随时恢复到该状态。</p>
<p><strong><code>git checkout master</code> 先切到master分支上</strong></p>
<p><strong><code>git tag v1.0</code>  给master打一个标签v1.0</strong></p>
<p><strong><code>git tag</code> 可以查看所有的标签</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git tag v1.0</span></div><div class="line">[root@localhost studygit]<span class="comment"># git tag</span></div><div class="line">v1.0</div><div class="line">[root@localhost studygit]<span class="comment"># git show v1.0</span></div><div class="line">commit acbc9ea125b527e9f3ab30dcf5f5b3e415c760e1</div><div class="line">Author: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date: Mon Jan 9 05:08:10 2017 +0800</div><div class="line"> </div><div class="line"> add new 2.txt</div><div class="line"> </div><div class="line">diff --git a/2.txt b/2.txt</div><div class="line">new file mode 100644</div><div class="line">index 0000000..e9af856</div><div class="line">--- /dev/null</div><div class="line">+++ b/2.txt</div><div class="line">@@ -0,0 +1 @@</div><div class="line">+234qw34\qwerqwer</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>tag是针对commit来打标签的，所以可以针对历史的commit来打tag</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;命令 <strong>git log –pretty=oneline –abbrev-commit</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git log --pretty=oneline</span></div><div class="line">acbc9ea125b527e9f3ab30dcf5f5b3e415c760e1 add new 2.txt</div><div class="line">23545a469bcea58ba25718515d1de2c78c9d7235 add lanmp.sh</div><div class="line">f3cba6670b29b8848c8a8ea61777918f097bcfbe first commit</div><div class="line">[root@localhost studygit]<span class="comment"># git log --pretty=oneline --abbrev-commit</span></div><div class="line">acbc9ea add new 2.txt</div><div class="line">23545a4 add lanmp.sh</div><div class="line">f3cba66 first commit</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git tag v0.9 23545a4</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git tag v0.9 23545a4</span></div><div class="line">[root@localhost studygit]<span class="comment"># git tag</span></div><div class="line">v0.9</div><div class="line">v1.0</div><div class="line">[root@localhost studygit]<span class="comment"># git show v0.9</span></div><div class="line">commit 23545a469bcea58ba25718515d1de2c78c9d7235</div><div class="line">Author: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date: Sun Jan 8 04:13:11 2017 +0800</div><div class="line"></div><div class="line">add lanmp.sh</div><div class="line"></div><div class="line">diff --git a/lanmp.sh b/lanmp.sh</div><div class="line">new file mode 100644</div><div class="line">index 0000000..5a1db53</div><div class="line">--- /dev/null</div><div class="line">+++ b/lanmp.sh</div><div class="line">@@ -0,0 +1,465 @@</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git tag -a v0.8 -m “tag just v1.1 and so on”  acbc9ea</strong>  可以对标签进行描述</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git tag -a v0.8 -m "tag just v1.1 and so on" acbc9ea</span></div><div class="line">[root@localhost studygit]<span class="comment"># git tag</span></div><div class="line">v0.8</div><div class="line">v0.9</div><div class="line">v1.0</div><div class="line">[root@localhost studygit]<span class="comment"># git show v0.8</span></div><div class="line">tag v0.8</div><div class="line">Tagger: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date: Mon Jan 9 19:32:17 2017 +0800</div><div class="line"> </div><div class="line">tag just v1.1 and so on</div><div class="line"> </div><div class="line">commit acbc9ea125b527e9f3ab30dcf5f5b3e415c760e1</div><div class="line">Author: yanyi &lt;hcldir@qq.com&gt;</div><div class="line">Date: Mon Jan 9 05:08:10 2017 +0800</div><div class="line"> </div><div class="line"> add new 2.txt</div><div class="line"> </div><div class="line">diff --git a/2.txt b/2.txt</div><div class="line">new file mode 100644</div><div class="line">index 0000000..e9af856</div><div class="line">--- /dev/null</div><div class="line">+++ b/2.txt</div><div class="line">@@ -0,0 +1 @@</div><div class="line">+234qw34\qwerqwer</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git tag -d v0.8</strong> 删除标签</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git tag -d v0.8</span></div><div class="line">Deleted tag <span class="string">'v0.8'</span> (was 2321146)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git push origin v1.0</strong>   推送指定标签到远程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git push origin v1.0 </span></div><div class="line">Total 0 (delta 0), reused 0 (delta 0)</div><div class="line">To git@github.com:hcldirgit/studygit.git</div><div class="line">* [new tag]         v1.0 -&gt; v1.0</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git push –tag origin</strong>   推送所有标签</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git push --tag origin</span></div><div class="line">Total 0 (delta 0), reused 0 (delta 0)</div><div class="line">To git@github.com:hcldirgit/studygit.git</div><div class="line"> * [new tag] v0.9 -&gt; v0.9</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果本地删除了一个标签，远程也想要删除需要这样操作：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git tag v1.0 -d</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git push origin :refs/tags/v1.0</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git tag v1.0 -d</span></div><div class="line">Deleted tag <span class="string">'v1.0'</span> (was acbc9ea)</div><div class="line">[root@localhost studygit]<span class="comment"># git push origin :refs/tags/v1.0</span></div><div class="line">To git@github.com:hcldirgit/studygit.git</div><div class="line">- [deleted]          v1.0</div></pre></td></tr></table></figure>
<h2 id="15-git-别名"><a href="#15-git-别名" class="headerlink" title="15.git 别名"></a>15.git 别名</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;git commit 这个命令是不是有点长？ 用别名可以提高我们的工作效率</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git config –global alias.ci commit</strong> </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git config –global alias.co  checkout</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git config –global alias.br  branch</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git config --global alias.ci comit</span></div><div class="line">[root@localhost studygit]<span class="comment"># git config --global alias.br branch</span></div><div class="line">[root@localhost studygit]<span class="comment"># git config --global alias.co checkout</span></div><div class="line">[root@localhost studygit]<span class="comment"># git config --global alias.lg "log --pretty=oneline"</span></div><div class="line">[root@localhost studygit]<span class="comment"># git br</span></div><div class="line"> dev</div><div class="line">* master</div><div class="line"> yanyi</div><div class="line"> yi</div><div class="line">[root@localhost studygit]<span class="comment"># git co dev</span></div><div class="line">Switched to branch <span class="string">'dev'</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;别名所在文件 <strong>/root/.gitconfig</strong> 也可以直接编辑该文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># cat /root/.gitconfig</span></div><div class="line">[user]</div><div class="line">      name = yanyi</div><div class="line">      email = hcldir@qq.com</div><div class="line">[<span class="built_in">alias</span>]</div><div class="line">      ci = comit</div><div class="line">      br = branch</div><div class="line">      co = checkout</div><div class="line">      lg = <span class="built_in">log</span> --pretty=oneline</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查看git别名使用命令</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git config –list |grep alias</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git config --list |grep alias</span></div><div class="line">alias.ci=comit</div><div class="line">alias.br=branch</div><div class="line">alias.co=checkout</div><div class="line">alias.lg=<span class="built_in">log</span> --pretty=oneline</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git config –list</strong> 可以详细查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git config --list</span></div><div class="line">user.name=yanyi</div><div class="line">user.email=hcldir@qq.com</div><div class="line">alias.ci=comit</div><div class="line">alias.br=branch</div><div class="line">alias.co=checkout</div><div class="line">alias.lg=<span class="built_in">log</span> --pretty=oneline</div><div class="line">core.repositoryformatversion=0</div><div class="line">core.filemode=<span class="literal">true</span></div><div class="line">core.bare=<span class="literal">false</span></div><div class="line">core.logallrefupdates=<span class="literal">true</span></div><div class="line">remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*</div><div class="line">remote.origin.url=git@github.com:hcldirgit/studygit.git</div><div class="line">branch.master.remote=origin</div><div class="line">branch.master.merge=refs/heads/master</div><div class="line">branch.dev.remote=origin</div><div class="line">branch.dev.merge=refs/heads/dev</div><div class="line">branch.yanyi.remote=origin</div><div class="line">branch.yanyi.merge=refs/heads/yanyi</div><div class="line">branch.yi.remote=origin</div><div class="line">branch.yi.merge=refs/heads/yi</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>查询log小技巧</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config --global alias.lg <span class="string">"log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit"</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git config --global alias.lg "log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit"</span></div><div class="line">[root@localhost studygit]<span class="comment"># git lg</span></div><div class="line">* acbc9ea - (HEAD, origin/yi, origin/yanyi, origin/master, origin/dev, origin/HEAD, yi, yanyi, master, dev) add new 2.txt (15 hours ago) &lt;yanyi&gt;</div><div class="line">* 23545a4 - (v0.9) add lanmp.sh (2 days ago) &lt;yanyi&gt;</div><div class="line">* f3cba66 - first commit (2 days ago) &lt;yanyi&gt;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用以后，git 就会有颜色</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Git%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/02.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;取消别名</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>git config –global –unset alias.br</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># git config --global --unset alias.br</span></div><div class="line">[root@localhost studygit]<span class="comment"># git br</span></div><div class="line">git: <span class="string">'br'</span> is not a git <span class="built_in">command</span>. See <span class="string">'git --help'</span>.</div><div class="line"></div><div class="line">Did you mean this?</div><div class="line">        var</div><div class="line">`</div></pre></td></tr></table></figure>
<h2 id="16-搭建-git-服务器"><a href="#16-搭建-git-服务器" class="headerlink" title="16.搭建 git 服务器"></a>16.搭建 git 服务器</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;github 毕竟是公开的，而私有仓库又得花钱买。所以我们可以想办法搭建一个私有的，只自己公司使用的。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;yum install git安装git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@gitserver ~]<span class="comment"># yum install -y epel-release</span></div><div class="line">[root@gitserver ~]<span class="comment"># yum install -y git</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>useradd -s /usr/bin/git-shell git 添加git用户，并且设置shell为/usr/bin/git-shell,目的是为了不让git用户远程登陆</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@gitserver ~]<span class="comment"># useradd -s /usr/bin/git-shell git</span></div><div class="line">[root@gitserver ~]<span class="comment"># cd /home/git</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建 authorized_keys 文件，并更改属主、属组和权限，用来存客户端机器上的公钥  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@gitserver git]<span class="comment"># mkdir .ssh</span></div><div class="line">[root@gitserver git]<span class="comment"># touch .ssh/authorized_keys</span></div><div class="line">[root@gitserver git]<span class="comment"># vim .ssh/authorized_keys</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;公钥内容在，客户端 /root/.shh/id_rsa.pub</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># cat /root/.ssh/id_rsa.pub</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;设置权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@gitserver git]<span class="comment"># chown -R git .ssh</span></div><div class="line">[root@gitserver git]<span class="comment"># chmod 700 .ssh</span></div><div class="line">[root@gitserver git]<span class="comment"># chmod 600 .ssh/authorized_keys</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;客户端查看能否连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># ssh git@192.168.0.91</span></div><div class="line">The authenticity of host <span class="string">'192.168.0.91 (192.168.0.91)'</span> can<span class="string">'t be established.</span></div><div class="line"><span class="string">RSA key fingerprint is 38:82:75:f9:11:a3:56:b4:00:ce:46:75:65:7c:5c:9b.</span></div><div class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></div><div class="line"><span class="string">Warning: Permanently added '</span>192.168.0.91<span class="string">' (RSA) to the list of known hosts.</span></div><div class="line"><span class="string">fatal: What do you think I am? A shell?</span></div><div class="line"><span class="string">Connection to 192.168.0.91 closed.</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样就说明可以连接</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;主机设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@gitserver git]<span class="comment"># usermod -s /bin/bash git</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;客户端连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost studygit]<span class="comment"># ssh git@192.168.0.91</span></div><div class="line">Last login: Mon Jan 9 21:53:51 2017 from 192.168.0.92</div><div class="line">[git@gitserver ~]$ <span class="built_in">logout</span></div><div class="line">Connection to 192.168.0.91 closed.</div><div class="line">[root@localhost studygit]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样检测客户端公钥能登录主机，检测完成主机改回设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@gitserver git]<span class="comment"># usermod -s /usr/bin/git-shell git</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样客户端就不能登录主机</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;定好存储git仓库的目录，比如 /data/gitroot</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@gitserver git]<span class="comment"># mkdir -p /data/gitroot</span></div><div class="line">[root@gitserver git]<span class="comment"># cd /data/gitroot</span></div><div class="line">[root@gitserver gitroot]<span class="comment"># git init --bare sample.git</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /data/gitroot/sample.git/</div><div class="line">[root@gitserver gitroot]<span class="comment"># ls -la</span></div><div class="line">总用量 12</div><div class="line">drwxr-xr-x 3 root root 4096 1月 9 22:16 .</div><div class="line">drwxr-xr-x 3 root root 4096 1月 9 22:16 ..</div><div class="line">drwxr-xr-x 7 root root 4096 1月 9 22:16 sample.git</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明：<strong>git init –bare sample.git</strong>  会创建一个裸仓库，裸仓库没有工作区，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，并且服务器上的Git仓库通常都以.git结尾</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;更改权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@gitserver gitroot]<span class="comment"># chown -R git.git sample.git</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在客户端上（自己pc）克隆远程仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost home]<span class="comment"># git clone git@192.168.0.91:/data/gitroot/sample.git</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /home/sample/.git/</div><div class="line">warning: You appear to have cloned an empty repository.</div><div class="line">[root@localhost home]<span class="comment"># ls</span></div><div class="line">gitroot lanmp sample studygit</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;客户端操作，推送到服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@localhost sample]<span class="comment"># ls</span></div><div class="line">[root@localhost sample]<span class="comment"># echo "1234\abcd\5678\efgh" &gt; 1.txt</span></div><div class="line">[root@localhost sample]<span class="comment"># git add 1.txt</span></div><div class="line">[root@localhost sample]<span class="comment"># git commit -m "add new 1.txt"</span></div><div class="line">[master (root-commit) a86f429] add new 1.txt</div><div class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</div><div class="line"> create mode 100644 1.txt</div><div class="line">[root@localhost sample]<span class="comment"># git push -u origin master</span></div><div class="line">Counting objects: 3, <span class="keyword">done</span>.</div><div class="line">Writing objects: 100% (3/3), 224 bytes, <span class="keyword">done</span>.</div><div class="line">Total 3 (delta 0), reused 0 (delta 0)</div><div class="line">To git@192.168.0.91:/data/gitroot/sample.git</div><div class="line"> * [new branch] master -&gt; master</div><div class="line">Branch master <span class="built_in">set</span> up to track remote branch master from origin.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;以上操作是在git服务器上做的，平时git服务器是不需要开发人员登录修改代码的，它仅仅是充当着一个服务器的角色，就像github一样，平时操作都是在我们自己的pc上做的。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先要把客户端上的公钥放到git服务器上/home/git/.ssh/authorized_keys文件里 git clone git@ip:/data/gitroot/sample.git</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;此时就可以在当前目录下生成一个sample的目录，这个就是我们克隆的远程仓库了。进入到这里面，可以开发一些代码，然后push到远程。  </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Git/2.  github常见操作和常见错误  错误提示  fatal   remote origin already exists." class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Git/2.  github常见操作和常见错误  错误提示  fatal   remote origin already exists./" class="article-date">
  	<time datetime="2017-09-02T18:02:06.177Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Git/2.  github常见操作和常见错误  错误提示  fatal   remote origin already exists./">
        github常见操作和常见错误  错误提示  fatal   remote origin already exists.
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Git remote add origin git@github.com:djqiang（github帐号名）/gitdemo（项目名）.git</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;提示出错信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fatal: remote origin already exists.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决办法如下：</p>
<ol>
<li><p>先输入 <strong>$ git remote rm origin</strong></p>
</li>
<li><p>再输入 $ git remote add origin git@github.com:djqiang/gitdemo.git 就不会报错了！</p>
</li>
<li><p>如果输入 <strong>$ git remote rm origin</strong> 还是报错的话，error: Could not remove config section ‘remote.origin’. 我们需要修改gitconfig文件的内容</p>
</li>
<li><p>找到github的安装路径，我的是C:\Users\ASUS\AppData\Local\GitHub\PortableGit_ca477551eeb4aea0e4ae9fcd3358bd96720bb5c8\etc</p>
</li>
<li><p>找到一个名为gitconfig的文件，打开它把里面的[remote “origin”]那一行删掉就好了！</p>
</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -T git@github.com</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;出现错误提示：Permission denied (publickey).因为新生成的key不能加入ssh就会导致连接不上github。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决办法如下：</p>
<ol>
<li><p>先输入$ ssh-agent，再输入$ ssh-add ~/.ssh/id_key，这样就可以了。</p>
</li>
<li><p>如果还是不行的话，输入ssh-add ~/.ssh/id_key 命令后出现报错Could not open a connection to your authentication agent.解决方法是key用Git Gui的ssh工具生成，这样生成的时候key就直接保存在ssh中了，不需要再ssh-add命令加入了，其它的user，token等配置都用命令行来做。</p>
</li>
<li><p>最好检查一下在你复制id_rsa.pub文件的内容时有没有产生多余的空格或空行，有些编辑器会帮你添加这些的。</p>
</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push origin master</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;提示出错信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">error:failed to push som refs to .......</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决办法如下：</p>
<ol>
<li><p>先输入$ git pull origin master //先把远程服务器github上面的文件拉下来</p>
</li>
<li><p>再输入$ git push origin master</p>
</li>
<li><p>如果出现报错 fatal: Couldn’t find remote ref master或者fatal: ‘origin’ does not appear to be a git repository以及fatal: Could not read from remote repository.</p>
</li>
<li><p>则需要重新输入$ git remote add origingit@github.com:djqiang/gitdemo.git</p>
</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用git在本地创建一个项目的过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">makdir ~/hello-world    //创建一个项目hello-world</div><div class="line"><span class="built_in">cd</span> ~/hello-world       //打开这个项目</div><div class="line">git init             //初始化 </div><div class="line">touch README</div><div class="line">git add README        //更新README文件</div><div class="line">git commit -m <span class="string">'first commit'</span>     //提交更新，并注释信息“first commit” </div><div class="line">git remote add origin git@github.com:defnngj/hello-world.git     //连接远程github项目  </div><div class="line">git push -u origin master     //将本地项目更新到github项目上去</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;gitconfig配置文件</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Git有一个工具被称为git config，它允许你获得和设置配置变量；这些变量可以控制Git的外观和操作的各个方面。这些变量可以被存储在三个不同的位置： </p>
<ol>
<li><p>/etc/gitconfig 文件：包含了适用于系统所有用户和所有库的值。如果你传递参数选项’–system’ 给 git config，它将明确的读和写这个文件。 </p>
</li>
<li><p>~/.gitconfig 文件 ：具体到你的用户。你可以通过传递–global 选项使Git 读或写这个特定的文件。</p>
</li>
<li><p>位于git目录的config文件 (也就是 .git/config) ：无论你当前在用的库是什么，特定指向该单一的库。每个级别重写前一个级别的值。因此，在.git/config中的值覆盖了在/etc/gitconfig中的同一个值。</p>
</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在Windows系统中，Git在$HOME目录中查找.gitconfig文件（对大多数人来说，位于C:\Documents and Settings\$USER下）。它也会查找/etc/gitconfig，尽管它是相对于Msys 根目录的。这可能是你在Windows中运行安装程序时决定安装Git的任何地方。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;配置相关信息：</p>
<ol>
<li>当你安装Git后首先要做的事情是设置你的用户名称和e-mail地址。这是非常重要的，因为每次Git提交都会使用该信息。它被永远的嵌入到了你的提交中：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">git config --global user.name <span class="string">"John Doe"</span></div><div class="line">git config --global user.email johndoe@example.com</div><div class="line">``` </div><div class="line"></div><div class="line">2. 你的编辑器(Your Editor)</div><div class="line"></div><div class="line">&amp;<span class="comment">#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;现在，标识已经设置，可以配置缺省文本编辑器，Git在需要输入一些消息时会使用该文本编辑器。缺省情况下，Git使用系统的缺省编辑器，这通常可能是vi 或者 vim。如果想使用一个不同的文本编辑器，例如Emacs，可以做如下操作：</span></div><div class="line"></div><div class="line">```bash</div><div class="line">git config --global core.editor emacs</div></pre></td></tr></table></figure>
<ol>
<li>检查设置(Checking Your Settings)</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果想检查设置，可以使用 git config –list 命令来列出Git可以在该处找到的所有的设置:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config --list</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以查看Git认为的一个特定的关键字目前的值，使用如下命令 git config {key}:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git config user.name</div></pre></td></tr></table></figure>
<ol>
<li>获取帮助(Getting help)</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果当你在使用Git时需要帮助，有三种方法可以获得任何git命令的手册页(manpage)帮助信息:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">help</span> &lt;verb&gt;</div><div class="line">git &lt;verb&gt; --<span class="built_in">help</span></div><div class="line">man git-&lt;verb&gt;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;例如，你可以运行如下命令获取对config命令的手册页帮助:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">help</span> config</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-FTP/4. vsftp 利用mysql 验证虚拟账户" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/FTP/4. vsftp 利用mysql 验证虚拟账户/" class="article-date">
  	<time datetime="2017-09-02T18:02:06.174Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/FTP/4. vsftp 利用mysql 验证虚拟账户/">
        vsftp 利用mysql 验证虚拟账户
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="安装vsftpd"><a href="#安装vsftpd" class="headerlink" title="安装vsftpd"></a>安装vsftpd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y  vsftpd</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编辑vsftpd.conf</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">listen=YES</div><div class="line">connect_from_port_20=YES</div><div class="line">pasv_enable=YES</div><div class="line">tcp_wrappers=YES</div><div class="line">local_enable=YES</div><div class="line">chroot_local_user=yes</div><div class="line">anonymous_enable=NO</div><div class="line">guest_enable=YES</div><div class="line">guest_username=vsftpdguest</div><div class="line">user_config_dir=/etc/vsftpd/vsftpd_user_conf</div><div class="line">pam_service_name=/etc/pam.d/vsftpd</div><div class="line">dirmessage_enable=YES</div><div class="line">idle_session_timeout=600</div><div class="line">check_shell=NO</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建一个虚拟用户映射系统用户    </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd –s /sbin/nologin vsftpdguest</div></pre></td></tr></table></figure>
<h2 id="安装-mysql"><a href="#安装-mysql" class="headerlink" title="安装 mysql"></a>安装 mysql</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;具体步骤参考 <a href="https://hcldirgit.github.io/2017/07/29/1.%20Mysql%E5%AE%89%E8%A3%85/">MySQL安装</a></p>
<h2 id="安装-pam-mysql"><a href="#安装-pam-mysql" class="headerlink" title="安装 pam-mysql"></a>安装 pam-mysql</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://cdnetworks-kr-1.dl.sourceforge.net/project/pam-mysql/pam-mysql/0.7RC1/pam_mysql-0.7RC1.tar.gz</div><div class="line">tar zxvf  pam_mysql-0.7RC1.tar.gz</div><div class="line"><span class="built_in">cd</span> pam_mysql-0.7RC1</div><div class="line">./configure --with-mysql=/usr/<span class="built_in">local</span>/mysql --with-pam=/usr --with-pam-mods-dir=/usr/lib</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h2 id="创建vsftp-库和相关的表并授权"><a href="#创建vsftp-库和相关的表并授权" class="headerlink" title="创建vsftp 库和相关的表并授权"></a>创建vsftp 库和相关的表并授权</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;create database vsftp;</div><div class="line">&gt;use vsftp ;</div><div class="line">&gt;create table users ( name char(16) binary ,passwd char(125) binary ) ;</div><div class="line">&gt;insert into users (name,passwd) values (<span class="string">'test001'</span>,password(<span class="string">'123456'</span>));</div><div class="line">&gt;insert into users (name,passwd) values (<span class="string">'test002'</span>,password(<span class="string">'234567'</span>));</div><div class="line">&gt;grant select on vsftp.users to vsftpdguest@localhost identified by <span class="string">'vsftpdguest'</span>;</div></pre></td></tr></table></figure>
<h2 id="创建虚拟账户的配置文件"><a href="#创建虚拟账户的配置文件" class="headerlink" title="创建虚拟账户的配置文件"></a>创建虚拟账户的配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir /etc/vsftpd/vsftpd_user_conf </div><div class="line"><span class="built_in">cd</span>  /etc/vsftpd/vsftpd_user_conf</div><div class="line">vim test001</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">local_root=/ftp/        </div><div class="line">write_enable=YES</div><div class="line">virtual_use_local_privs=YES</div><div class="line">chmod_enable=YES</div></pre></td></tr></table></figure>
<h2 id="编辑验证文件"><a href="#编辑验证文件" class="headerlink" title="编辑验证文件"></a>编辑验证文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim  /etc/pam.d/vsftpd</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#%PAM-1.0</span></div><div class="line">auth required /usr/lib/pam_mysql.so user=vsftpdguest passwd=vsftpdguest host=localhost db=vsftp table=users usercolumn=name passwdcolumn=passwd crypt=2</div><div class="line">account required /usr/lib/pam_mysql.so user=vsftpdguest passwd=vsftpdguest host=localhost db=vsftp table=users usercolumn=name passwdcolumn=passwd crypt=2</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果不想使用mysql也可以使用文件的形式来搞虚拟账号，请参考<a href="https://hcldirgit.github.io/2017/08/02/2.%20vsftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/">vsftp部署和优化</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FTP/">FTP</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-FTP/3. ftp的主动模式与被动模式的区别是什么？" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/FTP/3. ftp的主动模式与被动模式的区别是什么？/" class="article-date">
  	<time datetime="2017-09-02T18:02:06.173Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/FTP/3. ftp的主动模式与被动模式的区别是什么？/">
        ftp的主动模式与被动模式的区别是什么？
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FTP协议有两种工作方式：PORT方式和PASV方式，中文意思为主动模式和被动模式</p>
<h2 id="一、什么是主动FTP"><a href="#一、什么是主动FTP" class="headerlink" title="一、什么是主动FTP"></a>一、什么是主动FTP</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;主动模式的FTP工作原理：客户端从一个任意的非特权端口N连接到FTP服务器的命令端口，也就是21端口。然后客户端开始监听端口N+1，并发送FTP命令“port N+1”到FTP服务器。接着服务器会从它自己的数据端口（20）连接到客户端指定的数据端口（N+1）。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 针对FTP服务器前面的防火墙来说，必须允许以下通讯才能支持主动方式FTP：    </p>
<ol>
<li><p>任何大于1024的端口到FTP服务器的21端口。（客户端初始化的连接）  </p>
</li>
<li><p>FTP服务器的21端口到大于1024的端口。 （服务器响应客户端的控制端口） </p>
</li>
<li><p>FTP服务器的20端口到大于1024的端口。（服务器端初始化数据连接到客户端的数据端口）</p>
</li>
<li><p>大于1024端口到FTP服务器的20端口（客户端发送ACK响应到服务器的数据端口） </p>
</li>
</ol>
<h2 id="二、什么是被动FTP"><a href="#二、什么是被动FTP" class="headerlink" title="二、什么是被动FTP"></a>二、什么是被动FTP</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为了解决服务器发起到客户的连接的问题，人们开发了一种不同的FTP连接方式。这就是所谓的被动方式，或者叫做PASV，当客户端通知服务器它处于被动模式时才启用。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在被动方式FTP中，命令连接和数据连接都由客户端发起，这样就可以解决从服务器到客户端的数据端口的入方向连接被防火墙过滤掉的问题。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;当开启一个 FTP连接时，客户端打开两个任意的非特权本地端口（N &gt; 1024和N+1）。第一个端口连接服务器的21端口，但与主动方式的FTP不同，客户端不会提交PORT命令并允许服务器来回连它的数据端口，而是提交 PASV命令。这样做的结果是服务器会开启一个任意的非特权端口（P &gt; 1024），并发送PORT P命令给客户端。然后客户端发起从本地端口N+1到服务器的端口P的连接用来传送数据。  </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;对于服务器端的防火墙来说，必须允许下面的通讯才能支持被动方式的FTP:     </p>
<ol>
<li><p>从任何大于1024的端口到服务器的21端口（客户端初始化的连接）  </p>
</li>
<li><p>服务器的21端口到任何大于1024的端口（服务器响应到客户端的控制端口的连接） </p>
</li>
<li><p>从任何大于1024端口到服务器的大于1024端口（客户端初始化数据连接到服务器指定的任意端口）</p>
</li>
<li><p>服务器的大于1024端口到远程的大于1024的端口（服务器发送ACK响应和数据到客户端的数据端口）</p>
</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;从上面可以看出，两种方式的命令链路连接方法是一样的，而数据链路的建立方法就完全不同，如下图：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FTP服务器的主动工作模式</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/ftp%E7%9A%84%E4%B8%BB%E5%8A%A8%E6%A8%A1%E5%BC%8F%E4%B8%8E%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/01.jpg?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FTP服务器的被动工作模式</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/ftp%E7%9A%84%E4%B8%BB%E5%8A%A8%E6%A8%A1%E5%BC%8F%E4%B8%8E%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/02.jpg?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;以上关于主动和被动FTP的解释，可以简单概括为以下两点：</p>
<p>1.主动FTP：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;命令连接：客户端 &gt;1024端口 -&gt; 服务器 21端口</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;数据连接：客户端 &gt;1024端口 &lt;- 服务器 20端口</p>
<ol>
<li>被动FTP：</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;命令连接：客户端 &gt;1024端口 -&gt; 服务器 21端口 </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;数据连接：客户端 &gt;1024端口 -&gt; 服务器 &gt;1024端口</p>
<h2 id="三、主动模式ftp与被动模式FTP优点和缺点："><a href="#三、主动模式ftp与被动模式FTP优点和缺点：" class="headerlink" title="三、主动模式ftp与被动模式FTP优点和缺点："></a>三、主动模式ftp与被动模式FTP优点和缺点：</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;主动FTP对FTP服务器的管理和安全很有利，但对客户端的管理不利。因为FTP服务器企图与客户端的高位随机端口建立连接，而这个端口很有可能被客户端的防火墙阻塞掉。被动FTP对FTP客户端的管理有利，但对服务器端的管理不利。因为客户端要与服务器端建立两个连接，其中一个连到一个高位随机端口，而这个端口很有可能被服务器端的防火墙阻塞掉。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/ftp%E7%9A%84%E4%B8%BB%E5%8A%A8%E6%A8%A1%E5%BC%8F%E4%B8%8E%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/03.jpg?raw=true" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FTP/">FTP</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-FTP/2. vsftp部署和优化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/FTP/2. vsftp部署和优化/" class="article-date">
  	<time datetime="2017-09-02T18:02:06.172Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/FTP/2. vsftp部署和优化/">
        vsftp部署和优化
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;作为系统默认自带的 ftp 服务软件，vsftp 也是比较常用的。</p>
<h2 id="1-安装-vsftp"><a href="#1-安装-vsftp" class="headerlink" title="1.安装 vsftp"></a>1.安装 vsftp</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># yum install -y vsftpd db4-utils</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这里安装两个软件包，同时会把依赖的包安装上。其中 db4-utils 用来生成木马库文件。</p>
<h2 id="2-建立帐号"><a href="#2-建立帐号" class="headerlink" title="2.建立帐号"></a>2.建立帐号</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vsftp 默认是可以支持使用系统帐号体系登录的，但这样不太安全，所以建议使用虚拟账号体系。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;建立虚拟账号相关的系统帐号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># useradd virftp -s /sbin/nologin</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;建立虚拟账户相关的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># vim /etc/vsftpd/vsftpd_login</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">test1</div><div class="line">123456</div><div class="line">test2</div><div class="line">abcdef</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;更改该文件的权限，提升安全级别</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># chmod 600 /etc/vsftpd/vsftpd_login</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;vsftpd 使用的密码文件肯定不是铭文的，需要生成对应的库文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># db_load -T -t hash -f /etc/vsftpd/vsftpd_login /etc/vsftpd/vsftpd_login.db</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;建立虚拟帐号相关的目录以及配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># mkdir /etc/vsftpd/vsftpd_user_conf</span></div><div class="line">[root@192 ~]<span class="comment"># cd /etc/vsftpd/vsftpd_user_conf</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;3.创建和用户对应的配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 vsftpd_user_conf]<span class="comment"># vim test1</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">local_root=/home/virftp/test1</div><div class="line">anonymous_enable=NO</div><div class="line">write_enable=YES</div><div class="line">local_umask=022</div><div class="line">anon_upload_enable=NO</div><div class="line">anon_mkdir_write_enable=NO</div><div class="line">idle_session_timeout=600</div><div class="line">data_connection_timeout=120</div><div class="line">max_clients=10</div><div class="line">max_per_ip=5</div><div class="line">local_max_rate=50000</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明:local_root 为该帐号的家目录，anonymous_enable 用来限制是否允许匿名帐号登录，若为 NO 表示不允许匿名帐号登录， write_enable=YES 表示可写，local_umask 指定 umask 值，anon_upload_enable 是否允许匿名帐号上传文件，anon_mkdir_write_enable 是否允许匿名帐号可写。以上为关键参数，其他暂时不用关心，创建 test2 帐号的步骤和 test1 一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@192 vsftpd_user_conf]<span class="comment"># mkdir /home/virftp/test1</span></div><div class="line">[root@192 vsftpd_user_conf]<span class="comment"># chown -R virftp:virftp /home/virftp</span></div><div class="line">[root@192 vsftpd_user_conf]<span class="comment"># vim /etc/pam.d/vsftpd</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在最开头添加两行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">auth sufficient /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login</div><div class="line">account sufficient /lib64/security/pam_userdb.so db=/etc/vsftpd/vsftpd_login</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明：linux 为 64 位系统，所以库文件为 /lib64/security/pam_userdb.so ，若系统为 32位，那么库文件在 /lib/security/pam_userdb.so</p>
<h2 id="4-修改全局配置文件-etc-vsftpd-conf"><a href="#4-修改全局配置文件-etc-vsftpd-conf" class="headerlink" title="4.修改全局配置文件 /etc/vsftpd.conf"></a>4.修改全局配置文件 /etc/vsftpd.conf</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 vsftpd_user_conf]<span class="comment"># vim /etc/vsftpd/vsftpd.conf</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/vsftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/01.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;改为</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/vsftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/02.png?raw=true" alt=""></p>
<p><img src="https://github.com/hcldirgit/image/blob/master/vsftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/03.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;改为</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/vsftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/04.png?raw=true" alt=""></p>
<p><img src="https://github.com/hcldirgit/image/blob/master/vsftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/05.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;改为</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/vsftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/06.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再增加：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">chroot_local_user=YES</div><div class="line">guest_enabled=YES</div><div class="line">guest_username=virftp</div><div class="line">virtual_use_local_privs=YES</div><div class="line">user_config_dir=/etc/vsftpd/vsftpd_user_conf</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;最后启动 vsftpd 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 vsftpd_user_conf]<span class="comment"># /etc/init.d/vsftpd start </span></div><div class="line">为 vsftpd 启动 vsftpd： [确定]</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果服务启动不了，很有可能是前面 21端口占用。测试过程和 pure-ftpd 一样，如果用户无法登录，查看日志 /var/log/srcure</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FTP/">FTP</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-FTP/1. pureftp部署和优化" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/FTP/1. pureftp部署和优化/" class="article-date">
  	<time datetime="2017-09-02T18:02:06.172Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/FTP/1. pureftp部署和优化/">
        pureftp部署和优化
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;FTP 是 File Transfer Protocol （文件传输协议）的英文简称，而中文简称为“文传协议”用于 Internet 上的控制文件的双向传输。同时，它也是一个应用程序（Applocation）用户可以通过它把自己的 PC 机与世界各地所有运行 FTP 协议的服务器相连，访问服务器上的大量程序和信息。 FTP 的主要作用，就是让用户连接上一个远程计算机（这些计算机上运行着 FTP 服务器程序）查看远程计算机有哪些文件，然后把文件从远程计算机上拷贝到本地计算机。或把本地计算机的文件送到远程计算机去。FTP 用得比 NFS 更多。</p>
<h2 id="安装pure-ftpd"><a href="#安装pure-ftpd" class="headerlink" title="安装pure-ftpd"></a>安装pure-ftpd</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在 centos 或者 redhat linux 上有自带的 ftp 软件叫做 vsftp ，但 pure-ftpd 比 vsftp 配置起来更加灵活。</p>
<h3 id="1-下载软件"><a href="#1-下载软件" class="headerlink" title="1.下载软件"></a>1.下载软件</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<a href="http://www.pureftpd.org/project/pure-ftpd" target="_blank" rel="external">pure-ftpd 官网</a> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># cd /usr/local/src</span></div><div class="line">[root@192 src]<span class="comment"># wget http://download.pureftpd.org/pub/pure-ftpd/releases/pure-ftpd-1.0.42.tar.bz2</span></div></pre></td></tr></table></figure>
<h3 id="2-安装-pure-ftpd"><a href="#2-安装-pure-ftpd" class="headerlink" title="2.安装 pure-ftpd"></a>2.安装 pure-ftpd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 src]<span class="comment"># tar jxvf pure-ftpd-1.0.42.tar.bz2 </span></div><div class="line">[root@192 src]<span class="comment"># cd pure-ftpd-1.0.42</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">./configure \</div><div class="line">--prefix=/usr/<span class="built_in">local</span>/pureftpd \</div><div class="line">--without-inetd \</div><div class="line">--with-altlog \</div><div class="line">--with-puredb \</div><div class="line">--with-throttling \</div><div class="line">--with-peruserlimits \</div><div class="line">--with-tls</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编译报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">configure: error: <span class="keyword">in</span> `/usr/<span class="built_in">local</span>/src/pure-ftpd-1.0.42<span class="string">':</span></div><div class="line"><span class="string">configure: error: no acceptable C compiler found in $PATH</span></div><div class="line"><span class="string">See `config.log'</span> <span class="keyword">for</span> more details</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决办法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y gcc</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编译报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">configure: error: OpenSSL headers not found.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决办法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y openssl-devel</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/pureftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/01.png?raw=true" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 pure-ftpd-1.0.42]<span class="comment"># make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<h3 id="3-配置-pure-ftpd"><a href="#3-配置-pure-ftpd" class="headerlink" title="3.配置 pure-ftpd"></a>3.配置 pure-ftpd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@192 pure-ftpd-1.0.42]<span class="comment"># cd configuration-file/</span></div><div class="line">[root@192 configuration-file]<span class="comment"># mkdir -p /usr/local/pureftpd/etc/</span></div><div class="line">[root@192 configuration-file]<span class="comment"># cp pure-ftpd.conf /usr/local/pureftpd/etc/pure-ftpd.conf</span></div><div class="line">[root@192 configuration-file]<span class="comment"># cp pure-config.pl /usr/local/pureftpd/sbin/pure-config.pl</span></div><div class="line">[root@192 configuration-file]<span class="comment"># chmod 755 /usr/local/pureftpd/sbin/pure-config.pl</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在启动 pure-ftpd 之前需要先修改配置文件，配置文件为 /usr/local/pureftpd/etc/pure-ftpd.conf，把自带配置删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 configuration-file]<span class="comment"># &gt; /usr/local/pureftpd/etc/pure-ftpd.conf </span></div><div class="line">[root@192 configuration-file]<span class="comment"># vim /usr/local/pureftpd/etc/pure-ftpd.conf</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;加入内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">ChrootEveryone             yes</div><div class="line">BrokenClientsCompatibility no</div><div class="line">MaxClientsNumber           50</div><div class="line">Daemonize                  yes</div><div class="line">MaxClientsPerIP            8</div><div class="line">VerboseLog                 no</div><div class="line">DisplayDotFiles            yes</div><div class="line">AnonymousOnly              no</div><div class="line">NoAnonymous                no</div><div class="line">SyslogFacility             ftp</div><div class="line">DontResolve                yes</div><div class="line">MaxIdleTime                15</div><div class="line">PureDB                     /usr/<span class="built_in">local</span>/pureftpd/etc/pureftpd.pdb</div><div class="line">LimitRecursion             3136 8</div><div class="line">AnonymousCanCreateDirs     no</div><div class="line">MaxLoad                    4</div><div class="line">AntiWarez                  yes</div><div class="line">Umask                      133:022</div><div class="line">MinUID                     100</div><div class="line">AllowUserFXP               no</div><div class="line">AllowAnonymousFXP          no</div><div class="line">ProhibitDotFilesWrite      no</div><div class="line">ProhibitDotFilesRead       no</div><div class="line">AutoRename                 no</div><div class="line">AnonymousCantUpload        no</div><div class="line">PIDFile                    /usr/<span class="built_in">local</span>/pureftpd/var/run/pure-ftpd.pid</div><div class="line">MaxDiskUsage               99</div><div class="line">CustomerProof              yes</div></pre></td></tr></table></figure>
<h3 id="4-启动-pure-ftpd"><a href="#4-启动-pure-ftpd" class="headerlink" title="4.启动 pure-ftpd"></a>4.启动 pure-ftpd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 configuration-file]<span class="comment"># cd /usr/local/pureftpd/</span></div><div class="line">[root@192 pureftpd]<span class="comment"># ./sbin/pure-config.pl ./etc/pure-ftpd.conf</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/pureftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/02.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果启动成功，会显示一行长长的以 Running 开头的信息，否则那就是错误信息。重启会比较麻烦一些，重启可以使用下面的命令来实现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 pureftpd]<span class="comment"># killall pure-ftpd</span></div><div class="line">[root@192 pureftpd]<span class="comment"># cd /usr/local/pureftpd/;./sbin/pure-config.pl ./etc/pure-ftpd.conf</span></div></pre></td></tr></table></figure>
<h3 id="5-建立帐号"><a href="#5-建立帐号" class="headerlink" title="5.建立帐号"></a>5.建立帐号</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pure-ftpd 使用的帐号并非 linux 系统帐号，而是虚拟帐号。因为这样做比较安全。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># mkdir -p /data/www/</span></div><div class="line">[root@192 ~]<span class="comment"># useradd www</span></div><div class="line">[root@192 ~]<span class="comment"># chown -R www:www /data/www/</span></div><div class="line">[root@192 ~]<span class="comment"># /usr/local/pureftpd/bin/pure-pw useradd ftp_user1 -uwww -d /data/www/</span></div><div class="line">Password: </div><div class="line">Enter it again:</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;其中，-u 将虚拟用户 ftp_user1 与系统用户 www 关联在一起，也就是说使用 ftp_user1 帐号登录 ftp 后，会以 www 的身份来读取文件或下载文件。 -d 后边的目录为 ftp_user1 账户的家目录，这样可以使 ftp_user1 只能访问其家目录 /data/www/ 。到这里还有最关键的一部，就是创建用户信息数据库文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># /usr/local/pureftpd/bin/pure-pw mkdb</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pure-pw 还可以列出当前的 ftp 帐号，当然也可以删除某个帐号。再创建一个帐号：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># /usr/local/pureftpd/bin/pure-pw useradd ftp_user2 -uwww -d /tmp/</span></div><div class="line">Password: </div><div class="line">Enter it again: </div><div class="line">[root@192 ~]<span class="comment"># /usr/local/pureftpd/bin/pure-pw mkdb</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;列出当前帐号：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># /usr/local/pureftpd/bin/pure-pw list</span></div><div class="line">ftp_user1 /data/www/./ </div><div class="line">ftp_user2 /tmp/./</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;删除帐号的命令为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># /usr/local/pureftpd/bin/pure-pw userdel ftp_user2</span></div></pre></td></tr></table></figure>
<h3 id="6-测试-pure-ftpd"><a href="#6-测试-pure-ftpd" class="headerlink" title="6.测试 pure-ftpd"></a>6.测试 pure-ftpd</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;测试需要的工具叫做 lftp ，先安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># yum install -y lftp</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># touch /data/www/123.txt</span></div><div class="line">[root@192 ~]<span class="comment"># lftp ftp_user1@127.0.0.1</span></div></pre></td></tr></table></figure>
<p> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注：登录以后可以用 get 下载，put 上传。也可以用 ftp + ip 登录。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/pureftp%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BC%98%E5%8C%96/03.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;登录后，使用 ls 命令可以列出当前目录都有什么软件。使用 lftp 工具是为了方便在 linux 系统里测试。最好的测试方法是，在 windows 机器里安装个 ftp 客户端软件（推荐 filezilla-client），然后去远程连接测试。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下面使用 yum 安装 pure-ftpd 的方法。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># yum install -y epel-release expect</span></div><div class="line">[root@192 ~]<span class="comment"># yum install -y pure-ftpd</span></div><div class="line">[root@192 ~]<span class="comment"># curl http://www.apelearn.com/study_v2/.pf.c &gt; /etc/pure-ftpd/pure-ftpd.conf</span></div><div class="line">[root@192 ~]<span class="comment"># user='mkpasswd -l 5 -s 0 -d 0 -C 0'</span></div><div class="line">[root@192 ~]<span class="comment"># pass='mkpasswd -s 0'</span></div><div class="line">[root@192 ~]<span class="comment"># echo $user $pass &gt; /tmp/ftp.pass</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建 ftp 服务的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># mkdir -p /data/ftp</span></div><div class="line">[root@192 ~]<span class="comment"># echo -e "$pass\n$pass"|pure-pw useradd $user -u apache -d /data/ftp/</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建密码文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># pure-pw mkdb</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;列出用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># pure-pw list</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;删除帐号</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># pure-pw userdel $user</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@192 ~]<span class="comment"># /etc/init.d/pure-ftpd start</span></div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FTP/">FTP</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Docker/1. Docker" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Docker/1. Docker/" class="article-date">
  	<time datetime="2017-09-02T18:02:06.168Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Docker/1. Docker/">
        Docker
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Docker简介"><a href="#1-Docker简介" class="headerlink" title="1.Docker简介"></a>1.Docker简介</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;容器虚拟化，比传统的虚拟化轻量</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;2013年出现，发展非常迅猛</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Redhat在6.5版本开始支持docker</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用go语言开发，基于apache2.0协议</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;开源软件，项目代码在github维护</p>
<h3 id="容器虚拟化和传统虚拟化比较"><a href="#容器虚拟化和传统虚拟化比较" class="headerlink" title="容器虚拟化和传统虚拟化比较"></a>容器虚拟化和传统虚拟化比较</h3><p><img src="https://github.com/hcldirgit/image/blob/master/Docker/01.png?raw=true" alt="01"></p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/02.png?raw=true" alt="02"></p>
<h3 id="Docker的优势"><a href="#Docker的优势" class="headerlink" title="Docker的优势"></a>Docker的优势</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动非常快，秒级实现</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;资源利用率很高，一台机器可以跑上千个docker容器</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;更快的交付和部署，一次创建和配置后，可以在任意地方运行</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;内核级别的虚拟化，不需要额外的hypevisor支持，会有更高的性能和效率</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;易迁移，平台依赖性不强</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/03.png?raw=true" alt="03"></p>
<h3 id="Docker核心概念"><a href="#Docker核心概念" class="headerlink" title="Docker核心概念"></a>Docker核心概念</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;镜像，是一个只读的模板，类似于安装系统用到的那个iso文件，我们通过镜像来完成各种应用的部署。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;容器，镜像类似于操作系统，而容器类似于虚拟机本身。它可以被启动、开始、停止、删除等操作，每个容器都是相互隔离的。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;仓库，存放镜像的一个场所，仓库分为公开仓库和私有仓库。 最大的公开仓库是Docker hub（hub.docker.com），国内公开仓库（dockerpool.com）</p>
<h2 id="2-Docker安装"><a href="#2-Docker安装" class="headerlink" title="2.Docker安装"></a>2.Docker安装</h2><h3 id="centos6-上安装"><a href="#centos6-上安装" class="headerlink" title="centos6 上安装"></a>centos6 上安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># yum install -y epel-release</span></div><div class="line">[root@docker ~]<span class="comment"># yum install -y docker-io</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># /etc/init.d/docker start</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如status 查看状态</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/04.png?raw=true" alt="04"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决办法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># yum install device-mapper-event-libs</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;重启 docker 正常运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># service docker restart</span></div><div class="line">停止 docker： [失败]</div><div class="line">Starting docker: [确定]</div><div class="line">[root@docker ~]<span class="comment"># service docker status</span></div><div class="line">docker (pid 24216) 正在运行...</div></pre></td></tr></table></figure>
<h3 id="centos7-上安装"><a href="#centos7-上安装" class="headerlink" title="centos7 上安装"></a>centos7 上安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># yum install -y docker</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># systemctl start docker</span></div></pre></td></tr></table></figure>
<h2 id="3-Docker-镜像管理"><a href="#3-Docker-镜像管理" class="headerlink" title="3.Docker 镜像管理"></a>3.Docker 镜像管理</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;从docker.com获取centos镜像 docker pull centos</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker pull centos </span></div><div class="line">Using default tag: latest</div><div class="line">Trying to pull repository docker.io/library/centos ... </div><div class="line">latest: Pulling from docker.io/library/centos</div><div class="line">45a2e645736c: Pull complete </div><div class="line">Digest: sha256:c577af3197aacedf79c5a204cd7f493c8e07ffbce7f88f7600bf19c688c38799</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> docker.io/centos:latest</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker images</strong> 查看本地都有哪些镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY       TAG    IMAGE ID     CREATED       SIZE</div><div class="line">docker.io/centos latest 67591570dd29 5 weeks ago   191.8 MB</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker tag centos yanyi</strong> 为centos镜像设置标签为yanyi</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker tag centos yanyi</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再使用docker images查看会多出来一行，改行的image id和centos的一样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY       TAG      IMAGE ID     CREATED     SIZE</div><div class="line">docker.io/centos latest 67591570dd29 5 weeks ago 191.8 MB</div><div class="line">yanyi            latest 67591570dd29 5 weeks ago 191.8 MB</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker search [image-name]</strong> 从docker仓库搜索docker镜像，后面是关键词</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker search centos</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run -t -i centos /bin/bash</strong> 用下载到的镜像开启容器，<strong>-i</strong>表示让容器的标准输入打开，<strong>-t</strong>表示分配一个伪终端，要把-i -t 放到镜像名字前面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -t -i centos /bin/bash</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;当该镜像发生修改后，我们可以把该镜像提交重新生成一个新版本进行在本地。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/05.png?raw=true" alt="05"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker ps</strong> 查看运行的容器，加上<strong>-a</strong>选项可以查看没有运行的容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker ps</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID IMAGE   COMMAND     CREATED       STATUS                         PORTS NAMES</div><div class="line">6e35c7590c0e centos  <span class="string">"/bin/bash"</span> 2 minutes ago Exited (0) About a minute ago        desperate_jepsen</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker rmi centos</strong> 用来删除指定镜像， 其中后面的参数可以是tag，如果是tag时，实际上是删除该tag，只要该镜像还有其他tag，就不会删除该镜像。当后面的参数为镜像ID时，则会彻底删除整个镜像，连通所有标签一同删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker rmi yanyi</span></div><div class="line">Untagged: yanyi:latest</div><div class="line">Untagged: docker.io/centos@sha256:c577af3197aacedf79c5a204cd7f493c8e07ffbce7f88f7600bf19c688c38799</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tag 是可以更改的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY       TAG    IMAGE ID     CREATED     SIZE</div><div class="line">docker.io/centos latest 67591570dd29 5 weeks ago 191.8 MB</div><div class="line">[root@docker ~]<span class="comment"># docker tag centos centos:yanyi</span></div><div class="line">[root@docker ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY       TAG    IMAGE ID     CREATED     SIZE</div><div class="line">centos           yanyi   67591570dd29 5 weeks ago 191.8 MB</div><div class="line">docker.io/centos latest 67591570dd29 5 weeks ago 191.8 MB</div></pre></td></tr></table></figure>
<h2 id="4-docker-镜像使用容器生成新的镜像"><a href="#4-docker-镜像使用容器生成新的镜像" class="headerlink" title="4.docker 镜像使用容器生成新的镜像"></a>4.docker 镜像使用容器生成新的镜像</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker ps</strong> 可以查看运行的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明现在没有运行的镜像，用 <strong>docker ps -a</strong> 查看没有运行的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker ps -a</span></div><div class="line">CONTAINER ID  IMAGE   COMMAND     CREATED      STATUS                   PORTS  NAMES</div><div class="line">6e35c7590c0e  centos  <span class="string">"/bin/bash"</span> 36 hours ago Exited (0) 36 hours ago         desperate_jepsen</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;运行没有运行的镜像，命令 <strong>docker start <container id=""></container></strong> CONTAINER ID可以只输入前3位</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker start 6e3</span></div><div class="line">6e3</div><div class="line">[root@docker ~]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID  IMAGE   COMMAND      CREATED      STATUS        PORTS   NAMES</div><div class="line">6e35c7590c0e  entos  <span class="string">"/bin/bash"</span>  36 hours ago  Up 9 seconds            desperate_jepsen</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;进入运行镜像，命令 <strong>docker exec -it <container id=""> /bin/bash</container></strong> <container id="">也可以只输入前3位</container></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]# docker exec -i -t 6e3 /bin/bash</div><div class="line">[root@6e35c7590c0e /]#</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在镜像中可以执行一些命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@914ff4a5efee /]<span class="comment"># yum install -y net-tools wget</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以查看镜像版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@914ff4a5efee /]<span class="comment"># cat /etc/redhat-release </span></div><div class="line">CentOS Linux release 7.3.1611 (Core)</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@914ff4a5efee /]<span class="comment"># uname -a</span></div><div class="line">Linux 914ff4a5efee 3.10.0-514.el7.x86_64 <span class="comment">#1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></div></pre></td></tr></table></figure>
<h3 id="Docker-基于已有镜像的容器创建镜像"><a href="#Docker-基于已有镜像的容器创建镜像" class="headerlink" title="Docker 基于已有镜像的容器创建镜像"></a>Docker 基于已有镜像的容器创建镜像</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;运行docker run后，进入到该容器中，我们做一些变更，比如安装一些东西，然后针对这个容器进行创建新的镜像</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker commit -m “change somth”  -a “somebody info”  container_id （通过docker ps -a获取id） 新镜像名字</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker commit -m "centos_with_nettools_and_wget" -a "yanyi" 914 centos_with_net</span></div><div class="line">sha256:230c1f5d9646084a345b40f75d5eca5d62f4bf7cde8ba03d26a5b161057da55b</div><div class="line">[root@docker ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY      TAG    IMAGE ID     CREATED        SIZE</div><div class="line">centos_with_net latest 230c1f5d9646 14 seconds ago 262.7 MB</div><div class="line">centos          latest 67591570dd29 5 weeks ago    191.8 MB</div><div class="line">centos          yanyi  67591570dd29 5 weeks ago    191.8 MB</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这个命令有点像svn的提交，-m 加一些改动信息，-a 指定作者相关信息  914这一串为容器id，再后面为新镜像的名字</p>
<h2 id="5-Docker-基于本地模板导入创建镜像"><a href="#5-Docker-基于本地模板导入创建镜像" class="headerlink" title="5.Docker 基于本地模板导入创建镜像"></a>5.Docker 基于本地模板导入创建镜像</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;模块获取，可以直接在网上下载一个模块<a href="https://openvz.org/Download/template/precreated" target="_blank" rel="external">https://openvz.org/Download/template/precreated</a> 可惜速度并不快，若下载了一个centos的模板 centos-6-x86_64-minimal.tar.gz 那么导入该镜像的命令为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># cat centos-6-x86_64-minimal.tar.gz |docker import - centos-6-x86_64</span></div><div class="line">sha256:601270b7e8af4f738fc5d22c0c6b9aa653ebfa917e9a5dcc371a894ed17cb7a1</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把现有镜像，导出为一个文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker save -o centos_with_net.tar 230c1f5d9646</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;还可以用该文件恢复本地镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker load --input centos_with_net.tar</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker load &lt; centos_with_net.tar</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker push image_name</strong> 可以把自己的镜像传到dockerhub官方网站上去，但前提是需要先注册一个用户</p>
<h2 id="6-Docker-容器管理"><a href="#6-Docker-容器管理" class="headerlink" title="6.Docker 容器管理"></a>6.Docker 容器管理</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker create -it centos</strong> 这样可以创建一个容器，但该容器并没有启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker create -i -t centos</span></div><div class="line">15cb91256d663c18dea652145b5e970220d0295879bbd8647db276eff36a1a76</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker start container_id</strong> 启动容器后，可以使用 docker ps  查看到，有start 就有stop，和restart</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker start 15cb91256d66</span></div><div class="line">15cb91256d66</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;之前我们使用的<strong>docker run</strong> 相当于先create再start</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker attach</strong> 可以进入一个后台运行的容器，比如 <strong>docker attach container_id</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker attach 15cb91256d66</span></div><div class="line">[root@15cb91256d66 /]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;但是attach命令不算好用，比如我们想要退出终端，就得exit了，这样容器也就退出了，还有一种方法<strong>docker exec -i -t container_id /bin/bash</strong> #可以临时打开一个虚拟终端，并且exit后，容器依然运行着</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -i -t 15cb91256d66 /bin/bash</span></div><div class="line">[root@15cb91256d66 /]<span class="comment">#</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -i -t centos-6-x86_64 /bin/bash</span></div><div class="line">[root@2983f5289991 /]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样进入了一个虚拟终端里面，我们可以运行一些命令，使用命令exit或者ctrl d 退出该bash，当退出后这个容器也会停止。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run -d</strong> 可以让容器在后台运行</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -d centos_with_net bash -c "while :; do echo 123; sleep 1; done "</span></div><div class="line">9afe4cdb5e63604a12045b104fa26008c84267665f27bf2bedebe5e6432b814f</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;停止镜像 <strong>docker stop container_id</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker stop 9afe</span></div><div class="line">9afe</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run –name web -itd centos bash</strong>  –name 给容器自定义名字</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -i -t -d --name web centos bash</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker logs 可以获取到容器的运行历史信息，用法如下<strong>docker logs container_id</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker logs 9afe</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker rm  container_id</strong> #container_id是ps的时候查看到的，这样就可以把所有container删除。如果是运行的容器，可以加-f</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker rm 9afe4cdb5e63</span></div><div class="line">9afe4cdb5e63</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果是运行的容器，可以加-f</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID IMAGE  COMMAND     CREATED       STATUS    PORTS NAMES</div><div class="line">6e35c7590c0e centos <span class="string">"/bin/bash"</span> 2 days ago Up 4 seconds       desperate_jepsen</div><div class="line">[root@docker ~]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</div><div class="line">6e35c7590c0e centos <span class="string">"/bin/bash"</span> 2 days ago Up 7 seconds desperate_jepsen</div><div class="line">[root@docker ~]<span class="comment"># docker rm -f 6e35c7590c0e </span></div><div class="line">6e35c7590c0e</div><div class="line">[root@docker ~]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run –rm -it centos bash -c “sleep 30”</strong> #–rm 可以让容器退出后直接删除，在这里命令执行完容器就会退出，不能和-d一起使用 </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker export container_id &gt; file.tar 导出容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID IMAGE  COMMAND     CREATED         STATUS    PORTS    NAMES</div><div class="line">c42f598d215e centos <span class="string">"bash"</span>      16 hours ago Up 9 seconds            web</div><div class="line">914ff4a5efee centos <span class="string">"/bin/bash"</span> 27 hours ago Up 15 seconds high_mccarthy</div><div class="line">[root@docker ~]<span class="comment"># docker export c42f &gt; yanyi_centos.tar</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;可以迁移到其他机器上，需要导入<strong>cat file.tar |docker import - yanyi_centos</strong>#这样会生成yanyi_centos的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># cat yanyi_centos.tar | docker import - yanyi_centos</span></div><div class="line">sha256:7092ed59698a2c1fbff09f883bb525d6d5fea78bbf96885ad5780459ca5bd06d</div><div class="line">[root@docker ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY   TAG    IMAGE ID    CREATED             SIZE</div><div class="line">yanyi_centos latest 7092ed59698a About a minute ago 191.8 MB</div></pre></td></tr></table></figure>
<h2 id="7-Docker-仓库管理"><a href="#7-Docker-仓库管理" class="headerlink" title="7.Docker 仓库管理"></a>7.Docker 仓库管理</h2><h3 id="下载-registry-镜像"><a href="#下载-registry-镜像" class="headerlink" title="下载 registry 镜像"></a>下载 registry 镜像</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker pull registry #下载registry 镜像，registy为docker官方提供的一个镜像，我们可以用它来创建本地的docker私有仓库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker pull registry:0.6.7</span></div><div class="line">Trying to pull repository docker.io/library/registry ... </div><div class="line">0.6.7: Pulling from docker.io/library/registry</div><div class="line">a3ed95caeb02: Pull complete </div><div class="line">b744ac11e87c: Pull complete </div><div class="line">df38afb9684e: Pull complete </div><div class="line">0018b940d299: Pull complete </div><div class="line">0f24c060f901: Pull complete </div><div class="line">95ce9ef4df17: Pull complete </div><div class="line">89843edaf725: Pull complete </div><div class="line">d1350903a0ac: Pull complete </div><div class="line">a8f3ba806716: Pull complete </div><div class="line">edeb8014d2ad: Pull complete </div><div class="line">d0b78626245e: Pull complete </div><div class="line">Digest: sha256:b48ecc989fd0b79a16c2bfe59df5354e3fe85b562ef9f7361eac4bcd19585f5d</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> docker.io/registry:0.6.7</div></pre></td></tr></table></figure>
<h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run -d -p 5000:5000 registy</strong> #以registry镜像启动容器，监听5000端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -d -p 5000:5000 registry</span></div><div class="line">00361bd4d3390430d61db003b7375208e82902e4bb855e5cebfb210da743121f</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;curl 127.0.0.1:5000 #可以访问它</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># curl 127.0.0.1:5000 </span></div><div class="line"><span class="string">"docker-registry server (dev)"</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># telnet 127.0.0.1 5000</span></div><div class="line">Trying 127.0.0.1...</div><div class="line">Connected to 127.0.0.1.</div><div class="line">Escape character is <span class="string">'^]'</span>.</div><div class="line">Connection closed by foreign host.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下面我们来把其中一个<strong>镜像上传到私有仓库</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker tag docker.io/busybox 192.168.0.96:5000/busybox</strong> #标记一下tag，必须要带有私有仓库的ip:port </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker tag docker.io/busybox 192.168.0.96:5000/busybox</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker push 192.168.0.96:5000/busybox</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker push 192.168.0.96:5000/busybox</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;此时报错了类似如下</p>
<ul>
<li>cnetos 6</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Error response from daemon: invalid registry endpoint https://192.168.0.96:5000/v0/: unable to ping registry endpoint https://192.168.0.96:5000/v0/</div><div class="line">v2 ping attempt failed with error: Get https://192.168.0.96:5000/v2/: EOF</div><div class="line">v1 ping attempt failed with error: Get https://192.168.0.96:5000/v1/_ping: EOF. If this private registry supports only HTTP or HTTPS with an unknown CA certificate, please add `--insecure-registry 192.168.0.96:5000` to the daemon<span class="string">'s arguments. In the case of HTTPS, if you have access to the registry'</span>s CA certificate, no need <span class="keyword">for</span> the flag; simply place the CA certificate at /etc/docker/certs.d/192.168.0.96:5000/ca.crt</div></pre></td></tr></table></figure>
<ul>
<li>centos 7</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">The push refers to a repository [192.168.0.96:5000/busybox]</div><div class="line">unable to ping registry endpoint https://192.168.0.96:5000/v0/</div><div class="line">v2 ping attempt failed with error: Get https://192.168.0.96:5000/v2/: EOF</div><div class="line">v1 ping attempt failed with error: Get https://192.168.0.96:5000/v1/_ping: EOF</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这是因为Docker从1.3.X之后，与docker registry交互默认使用的是https，然而此处搭建的私有仓库只提供http服务，所以当与私有仓库交互时就会报上面的错误。为了解决这个问题需要在启动docker server时增加启动参数为默认使用http访问。解决该问题的方法为：</p>
<ul>
<li>centos 6</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># vim /etc/init.d/docker</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把 $exec -d $other_args 改为<br>$exec -d –insecure-registry 192.168.0.96:5000 $other_args</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/06.png?raw=true" alt="06"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;改为</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/07.png?raw=true" alt="07"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后重启docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># service docker restart</span></div></pre></td></tr></table></figure>
<ul>
<li>centos 7</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># vim /etc/sysconfig/docker</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;加上 ADD_REGISTRY=’–add-registry 192.168.0.96:5000’ 和 INSECURE_REGISTRY=’–insecure-registry 192.168.0.96:5000’</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/08.png?raw=true" alt="08"></p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/09.png?raw=true" alt="09"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后重启docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># systemctl restart docker</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再启动registry容器 <strong>docker start registry_container_id</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker start 00361bd4d339</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再次把镜像上传私有仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker push 192.168.0.96:5000/busybox</span></div><div class="line">The push refers to a repository [192.168.0.96:5000/busybox]</div><div class="line">38ac8d0f5bb3: Pushed </div><div class="line">latest: digest: sha256:2efce9f5b0cb8815d192ae634b4c87943d0f0b873d98487ee98f8ed0504bd572 size: 527</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查看私有仓库里面的所有镜像命令（版本不同命令不一样）</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;curl <a href="http://192.168.0.96:5000/v1/search" target="_blank" rel="external">http://192.168.0.96:5000/v1/search</a>  </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;curl <a href="http://192.168.0.96:5000/v2/_catalog" target="_blank" rel="external">http://192.168.0.96:5000/v2/_catalog</a> #最近版本（33.28m）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># curl http://192.168.0.96:5000/v2/_catalog</span></div><div class="line">&#123;<span class="string">"repositories"</span>:[<span class="string">"busybox"</span>]&#125;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;curl <a href="http://192.168.0.96:5000/v2/image_name/tags/list" target="_blank" rel="external">http://192.168.0.96:5000/v2/image_name/tags/list</a> #最近版本（33.28m）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># curl http://192.168.0.96:5000/v2/busybox/tags/list </span></div><div class="line">&#123;<span class="string">"name"</span>:<span class="string">"busybox"</span>,<span class="string">"tags"</span>:[<span class="string">"latest"</span>]&#125;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker search 192.168.0.96:5000 </p>
<h2 id="8-Docker-数据管理"><a href="#8-Docker-数据管理" class="headerlink" title="8.Docker 数据管理"></a>8.Docker 数据管理</h2><h3 id="挂载本地的目录到容器里"><a href="#挂载本地的目录到容器里" class="headerlink" title="挂载本地的目录到容器里"></a>挂载本地的目录到容器里</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run -tid -v /data/:/data centos bash</strong> #-v 用来指定挂载目录，:前面的/data/为本地目录，:后面的/data/为容器里的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># mkdir /data/</span></div><div class="line">[root@docker ~]<span class="comment"># docker run -itd -v /data/:/data1 centos bash</span></div><div class="line">cdb5c8a578d5f720df7a263a41d84c22118696f9e5dae7591f539fb4f83ecb16</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;测试，本地 data 目录下创建文件在容器内查看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># touch /data/1.txt</span></div><div class="line">[root@docker ~]<span class="comment"># echo asdjfklasdjfklasdjf &gt; /data/1.txt</span></div><div class="line">[root@docker ~]<span class="comment"># cat /data/1.txt</span></div><div class="line">asdjfklasdjfklasdjf</div><div class="line">[root@docker ~]<span class="comment"># docker exec -it cdb5 bash</span></div><div class="line">[root@cdb5c8a578d5 /]<span class="comment"># ls /data1/</span></div><div class="line">1.txt</div><div class="line">[root@cdb5c8a578d5 /]<span class="comment"># cat /data1/1.txt</span></div><div class="line">asdjfklasdjfklasdjf</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;容器创建文件，在本地目录查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@cdb5c8a578d5 /]<span class="comment"># touch /data1/2.txt</span></div><div class="line">[root@cdb5c8a578d5 /]<span class="comment"># exit</span></div><div class="line">[root@docker ~]<span class="comment"># ls /data/</span></div><div class="line">1.txt 2.txt</div></pre></td></tr></table></figure>
<h3 id="挂载数据卷"><a href="#挂载数据卷" class="headerlink" title="挂载数据卷"></a>挂载数据卷</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;其实我们挂载目录的时候，可以指定容器name，如果不指定就随机定义了。比如上面我们没有指定，它就生成了一个名字为angry_bell，这个名字可以使用命令 docker ps 看最右侧一列 docker run -itd –volumes-from angry_bell centos bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd --volumes-from angry_bell centos bash</span></div><div class="line">e36d478d9253a4758b28fb3a3bc5596781b4e572797aee2623bfcf5f50d6492d</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样，我们使用 centos 镜像创建了新的容器，并且使用了 angry_bell 容器的数据卷。我们可以在新容器的数据卷下创建文件，然后去 angry_bell 容器里查看。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it e36 bash</span></div><div class="line">[root@e36d478d9253 /]<span class="comment"># ls /data1</span></div><div class="line">1.txt 2.txt</div><div class="line">[root@e36d478d9253 /]<span class="comment"># touch /data1/3.txt</span></div><div class="line">[root@e36d478d9253 /]<span class="comment"># exit</span></div><div class="line">[root@docker ~]<span class="comment"># docker exec -it cdb bash</span></div><div class="line">[root@cdb5c8a578d5 /]<span class="comment"># ls /data1/</span></div><div class="line">1.txt 2.txt 3.txt</div></pre></td></tr></table></figure>
<h3 id="定义数据卷容器"><a href="#定义数据卷容器" class="headerlink" title="定义数据卷容器"></a>定义数据卷容器</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;有时候，我们需要多个容器之间相互共享数据，类似于linux里面的NFS，所以就可以搭建一个专门的数据卷容器，然后其他容器直接挂载该数据卷。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先建立数据卷容器</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run -itd -v /data/ –name centos_testvol centos bash</strong>  #注意这里的/data/是容器的/data目录，并非本地的/data/目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd -v /data/ --name centos_testvol centos bash</span></div><div class="line">cfe772a30a89886d9603e84f3078052a39f6119d8b9561752d5d2eb83b245835</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后让其他容器挂载该数据卷 <strong>docker run -itd –volumes-from centos_testvol centos bash</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd --volumes-from centos_testvol centos bash</span></div><div class="line">d3cd4e6611e18226ceb4f4622bd55c534fb313865566cc7819556b3a1a53e530</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查看是否成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it d3c bash</span></div><div class="line">[root@d3cd4e6611e1 /]<span class="comment"># ls /data</span></div><div class="line">[root@d3cd4e6611e1 /]<span class="comment"># mkdir /data/test</span></div><div class="line">[root@d3cd4e6611e1 /]<span class="comment"># touch /data/test/1.txt</span></div><div class="line">[root@d3cd4e6611e1 /]<span class="comment"># exit</span></div><div class="line">[root@docker ~]<span class="comment"># docker exec -it centos_testvol bash </span></div><div class="line">[root@cfe772a30a89 /]<span class="comment"># ls /data</span></div><div class="line"><span class="built_in">test</span></div><div class="line">[root@cfe772a30a89 /]<span class="comment"># ls /data/test</span></div><div class="line">1.txt</div></pre></td></tr></table></figure>
<h3 id="Docker-数据管理-数据卷的备份与恢复"><a href="#Docker-数据管理-数据卷的备份与恢复" class="headerlink" title="Docker 数据管理 - 数据卷的备份与恢复"></a>Docker 数据管理 - 数据卷的备份与恢复</h3><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># mkdir /vol_data_backup</span></div><div class="line">[root@docker ~]<span class="comment"># docker run -itd --volumes-from centos_testvol -v /vol_data_backup/:/backup centos bash </span></div><div class="line">b246db616639574e1d6fe5ceb3534337df71676af3362d1b4dfd3b627523be30</div><div class="line">[root@docker ~]<span class="comment"># docker exec -it b246 bash</span></div><div class="line">[root@b246db616639 /]<span class="comment"># tar cvf /backup/data.tar /data/</span></div><div class="line">tar: Removing leading `/<span class="string">' from member names</span></div><div class="line"><span class="string">/data/</span></div><div class="line"><span class="string">/data/test/</span></div><div class="line"><span class="string">/data/test/1.txt</span></div><div class="line"><span class="string">[root@b246db616639 /]# ls /backup</span></div><div class="line"><span class="string">data.tar</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以直接执行命令：<strong>docker run –volumes-from centos_testvol -v  /vol_data_backup/:/backup centos tar cvf  /backup/data.tar /data/</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run --volumes-from centos_testvol -v /vol_data_backup/:/backup centos tar cvf /backup/data.tar /data/</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明：首先我们需要使用testvol数据卷新开一个容器，同时我们还需要把本地的/vol_data_backup/目录挂载到该容器的/backup下，这样在容器中/backup目录里面新建的文件，我们就可以直接在/vol_data_backup/目录中看到了。 然后再把/data/目录下面的文件打包到成data.tar文件放到/backup目录下面。</p>
<h4 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h4><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;思路： 先新建一个数据卷容器，再建一个新的容器并挂载该数据卷容器，然后再把tar包解包。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;新建数据卷容器：<strong>docker run -itd -v /data/ –name centos_testvol2 centos bash</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd -v /data/ --name centos_testvol2 centos bash</span></div><div class="line">00e733d06ece150b114490a36f0a751bed4f43de9aaede13e74331fcdeb87518</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;挂载数据卷新建容器，并解包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd --volumes-from centos_testvol2 -v /vol_data_backup/:/backup centos bash</span></div><div class="line">3f9a5887e0dac36b9bd29c5e0925a27d627b39f1945bed66d471e8bccc0cde70</div><div class="line">[root@docker ~]<span class="comment"># docker exec -it 3f9a bash</span></div><div class="line">[root@3f9a5887e0da /]<span class="comment"># tar xvf /backup/data.tar</span></div><div class="line">data/</div><div class="line">data/<span class="built_in">test</span>/</div><div class="line">data/<span class="built_in">test</span>/1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以执行命令：<strong>docker run –volumes-from centos_testvol2 -v /vol_data_backup/:/backup centos tar xvf /backup/data.tar</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run --volumes-from centos_testvol2 -v /vol_data_backup/:/backup centos tar xvf /backup/data.tar</span></div></pre></td></tr></table></figure>
<h2 id="9-Docker-网络管理-四种网络模式"><a href="#9-Docker-网络管理-四种网络模式" class="headerlink" title="9.Docker 网络管理 - 四种网络模式"></a>9.Docker 网络管理 - 四种网络模式</h2><h3 id="host模式"><a href="#host模式" class="headerlink" title="host模式"></a>host模式</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;host模式，使用docker run时使用–net=host指定</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker使用的网络实际上和宿主机一样，在容器内看到的网卡ip是宿主机上的ip</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -it --rm --net=host centos_with_net bash</span></div><div class="line">[root@docker /]<span class="comment"># ifconfig</span></div><div class="line">docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</div><div class="line">         inet 172.17.0.1 netmask 255.255.0.0 broadcast 0.0.0.0</div><div class="line">         inet6 fe80::42:69ff:fe81:dca8 prefixlen 64 scopeid 0x20&lt;link&gt;</div><div class="line">         ether 02:42:69:81:dc:a8 txqueuelen 0 (Ethernet)</div><div class="line">         RX packets 1551 bytes 79846 (77.9 KiB)</div><div class="line">         RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">         TX packets 1642 bytes 8892494 (8.4 MiB)</div><div class="line">         TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div><div class="line"></div><div class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</div><div class="line">       inet 192.168.0.96 netmask 255.255.255.0 broadcast 192.168.0.255</div><div class="line">       inet6 fe80::b5f:e696:2650:f930 prefixlen 64 scopeid 0x20&lt;link&gt;</div><div class="line">       ether 00:0c:29:5a:19:a5 txqueuelen 1000 (Ethernet)</div><div class="line">       RX packets 14059 bytes 9848234 (9.3 MiB)</div><div class="line">       RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">       TX packets 5604 bytes 576835 (563.3 KiB)</div><div class="line">       TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div><div class="line">[root@docker /]<span class="comment"># exit</span></div><div class="line">[root@docker ~]<span class="comment"># ifconfig</span></div><div class="line">docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</div><div class="line">         inet 172.17.0.1 netmask 255.255.0.0 broadcast 0.0.0.0</div><div class="line">         inet6 fe80::42:69ff:fe81:dca8 prefixlen 64 scopeid 0x20&lt;link&gt;</div><div class="line">         ether 02:42:69:81:dc:a8 txqueuelen 0 (Ethernet)</div><div class="line">         RX packets 1551 bytes 79846 (77.9 KiB)</div><div class="line">         RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">         TX packets 1642 bytes 8892494 (8.4 MiB)</div><div class="line">         TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div><div class="line"></div><div class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</div><div class="line">       inet 192.168.0.96 netmask 255.255.255.0 broadcast 192.168.0.255</div><div class="line">       inet6 fe80::b5f:e696:2650:f930 prefixlen 64 scopeid 0x20&lt;link&gt;</div><div class="line">       ether 00:0c:29:5a:19:a5 txqueuelen 1000 (Ethernet)</div><div class="line">       RX packets 14084 bytes 9850194 (9.3 MiB)</div><div class="line">       RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">       TX packets 5620 bytes 584957 (571.2 KiB)</div><div class="line">       TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div></pre></td></tr></table></figure>
<h3 id="container模式"><a href="#container模式" class="headerlink" title="container模式"></a>container模式</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;container模式，使用–net=container:container_id/container_name</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;多个容器使用共同的网络，看到的ip是一样的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it c07 /bin/bash</span></div><div class="line">[root@c076b8953e9d /]<span class="comment"># ifconfig</span></div><div class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</div><div class="line">      inet 172.17.0.3 netmask 255.255.0.0 broadcast 0.0.0.0</div><div class="line">      inet6 fe80::42:acff:fe11:3 prefixlen 64 scopeid 0x20&lt;link&gt;</div><div class="line">      ether 02:42:ac:11:00:03 txqueuelen 0 (Ethernet)</div><div class="line">      RX packets 66 bytes 5364 (5.2 KiB)</div><div class="line">      RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">      TX packets 8 bytes 648 (648.0 B)</div><div class="line">      TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div><div class="line"></div><div class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt; mtu 65536</div><div class="line">    inet 127.0.0.1 netmask 255.0.0.0</div><div class="line">    inet6 ::1 prefixlen 128 scopeid 0x10&lt;host&gt;</div><div class="line">    loop txqueuelen 1 (Local Loopback)</div><div class="line">    RX packets 0 bytes 0 (0.0 B)</div><div class="line">    RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">    TX packets 0 bytes 0 (0.0 B)</div><div class="line">    TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div><div class="line"></div><div class="line">[root@c076b8953e9d /]<span class="comment"># exit</span></div><div class="line">[root@docker ~]<span class="comment"># docker run -it --rm --net=container:c076 centos_with_net bash</span></div><div class="line">[root@c076b8953e9d /]<span class="comment"># ifconfig</span></div><div class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</div><div class="line">      inet 172.17.0.3 netmask 255.255.0.0 broadcast 0.0.0.0</div><div class="line">      inet6 fe80::42:acff:fe11:3 prefixlen 64 scopeid 0x20&lt;link&gt;</div><div class="line">      ether 02:42:ac:11:00:03 txqueuelen 0 (Ethernet)</div><div class="line">      RX packets 66 bytes 5364 (5.2 KiB)</div><div class="line">      RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">      TX packets 8 bytes 648 (648.0 B)</div><div class="line">      TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div><div class="line"></div><div class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt; mtu 65536</div><div class="line">    inet 127.0.0.1 netmask 255.0.0.0</div><div class="line">    inet6 ::1 prefixlen 128 scopeid 0x10&lt;host&gt;</div><div class="line">    loop txqueuelen 1 (Local Loopback)</div><div class="line">    RX packets 0 bytes 0 (0.0 B)</div><div class="line">    RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">    TX packets 0 bytes 0 (0.0 B)</div><div class="line">    TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div></pre></td></tr></table></figure>
<h3 id="none模式"><a href="#none模式" class="headerlink" title="none模式"></a>none模式</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;none模式，使用–net=none指定</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这种模式下，不会配置任何网络</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -it --rm --net=none centos_with_net bash</span></div><div class="line">[root@069e635bea5f /]<span class="comment"># ifconfig</span></div><div class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt; mtu 65536</div><div class="line">    inet 127.0.0.1 netmask 255.0.0.0</div><div class="line">    inet6 ::1 prefixlen 128 scopeid 0x10&lt;host&gt;</div><div class="line">    loop txqueuelen 1 (Local Loopback)</div><div class="line">    RX packets 0 bytes 0 (0.0 B)</div><div class="line">    RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">    TX packets 0 bytes 0 (0.0 B)</div><div class="line">    TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div></pre></td></tr></table></figure>
<h3 id="bridge模式"><a href="#bridge模式" class="headerlink" title="bridge模式"></a>bridge模式</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bridge模式，使用–net=bridge指定</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;默认模式，不用指定默认就是这种网络模式。这种模式会为每个容器分配一个独立的   Network Namespace。类似于vmware的nat网络模式。同一个宿主机上的所有容器会在同一 个网段下，相互之间是可以通信的。</p>
<h2 id="10-Docker-网络管理-外部访问容器"><a href="#10-Docker-网络管理-外部访问容器" class="headerlink" title="10.Docker 网络管理 - 外部访问容器"></a>10.Docker 网络管理 - 外部访问容器</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先使用centos镜像新建一个容器，然后在该容器中安装httpd服务，并启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it c076 /bin/bash</span></div><div class="line">[root@c076b8953e9d /]<span class="comment"># yum install httpd</span></div><div class="line">[root@c076b8953e9d /]<span class="comment"># /usr/sbin/httpd</span></div><div class="line">AH00558: httpd: Could not reliably determine the server<span class="string">'s fully qualified domain name, using 172.17.0.3. Set the '</span>ServerName<span class="string">' directive globally to suppress this message</span></div><div class="line"><span class="string">[root@c076b8953e9d /]# ps aux |grep httpd</span></div><div class="line"><span class="string">root    92 0.1 0.1  221920  3452  ?  Ss 12:57 0:00 /usr/sbin/httpd</span></div><div class="line"><span class="string">apache  93 0.0 0.1  221920  2944  ?  S  12:57 0:00 /usr/sbin/httpd</span></div><div class="line"><span class="string">apache  94 0.0 0.1  221920  2944  ?  S  12:57 0:00 /usr/sbin/httpd</span></div><div class="line"><span class="string">apache  95 0.0 0.1  221920  2944  ?  S  12:57 0:00 /usr/sbin/httpd</span></div><div class="line"><span class="string">apache  96 0.0 0.1  221920  2944  ?  S  12:57 0:00 /usr/sbin/httpd</span></div><div class="line"><span class="string">apache  97 0.0 0.1  221920  2944  ?  S  12:57 0:00 /usr/sbin/httpd</span></div><div class="line"><span class="string">root   101 0.0 0.0    9032   656  ?  S+ 12:57 0:00 grep --color=auto httpd</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再把该容器导成一个新的镜像（centos_httpd)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker commit -m "centos_httpd" -a "yanyi" c076 centos_httpd</span></div><div class="line">sha256:12fb12486cfe16f66686b55e6c6365c5ecac3211fd97720f9e6e3350da757ed6</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后再使用新镜像创建容器，并指定端口映射 </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker run -itd -p 5123:80 centos_httpd bash</strong>  #-p 可以指定端口映射，本例中将容器的80端口映射为本地的5123端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd -p 5123:80 centos_httpd bash</span></div><div class="line">bbb931e95f37c4202634afa285fbc70c762c3a2a292b0a7655a08ed807ebee43</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>docker exec -it container_id  bash</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it bbb9 bash</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动httpd： httpd -k start </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@bbb931e95f37 /]<span class="comment"># httpd -k start</span></div><div class="line">AH00558: httpd: Could not reliably determine the server<span class="string">'s fully qualified domain name, using 172.17.0.11. Set the '</span>ServerName<span class="string">' directive globally to suppress this message</span></div><div class="line"><span class="string">[root@bbb931e95f37 /]# ps aux |grep httpd</span></div><div class="line"><span class="string">root   29 0.0 0.1 221920 3456 ? Ss 13:09 0:00 httpd -k start</span></div><div class="line"><span class="string">apache 30 0.0 0.1 221920 2940 ? S  13:09 0:00 httpd -k start</span></div><div class="line"><span class="string">apache 31 0.0 0.1 221920 2940 ? S  13:09 0:00 httpd -k start</span></div><div class="line"><span class="string">apache 32 0.0 0.1 221920 2940 ? S  13:09 0:00 httpd -k start</span></div><div class="line"><span class="string">apache 33 0.0 0.1 221920 2940 ? S  13:09 0:00 httpd -k start</span></div><div class="line"><span class="string">apache 34 0.0 0.1 221920 2940 ? S  13:09 0:00 httpd -k start</span></div><div class="line"><span class="string">root   36 0.0 0.0   9032  656 ? S+ 13:10 0:00 grep --color=auto httpd</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编辑1.html： vim /var/www/html/1.html 随便写点东西</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@bbb931e95f37 /]<span class="comment"># vim /var/www/html/1.html</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@bbb931e95f37 /]<span class="comment"># curl localhost/1.html</span></div><div class="line">yanyi</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;退出该容器：exit</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;测试： curl 127.0.0.1:5123/1.html </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@bbb931e95f37 /]<span class="comment"># exit</span></div><div class="line">[root@docker ~]<span class="comment"># curl 127.0.0.1:5123/1.html</span></div><div class="line">yanyi</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-p后面也支持IP:port:ip:port 的格式，比如</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-p 127.0.0.1:8080:80 </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以不写本地的端口，只写ip，这样会随意分配一个端口</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-p 127.0.0.1::80 </p>
<h2 id="11-Docker-网络管理-–-容器互联"><a href="#11-Docker-网络管理-–-容器互联" class="headerlink" title="11.Docker 网络管理 – 容器互联"></a>11.Docker 网络管理 – 容器互联</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下载一个mysql镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker pull mysql</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;新建一个容器，命名为db</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -it -d -p 13306:3306 --name db mysql bash</span></div><div class="line">53247dfe72258636e13b133ee082645cacd48ab6abc4e14442566250c6cd3c24</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在新建一个web容器，并和db互联</p>
<p>docker run -it -d -p 12308:80 –name web –link db:db centos-httpd bash</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在web上运行env命令可以查看到关于db的环境变量</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;因 pull 的 mydql 是  Ubuntu 版本，则重新制作 centos 版本</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;centos7 yum 没有 mysql-server ，则创建 centos6 容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd centos-6-x86 bash</span></div><div class="line">3a40c6cd247c6c7083caf2579935fb497fef6b8ca021097766b2d2585ce0642a</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;yum 安装 mysql-server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it 3a4 bash</span></div><div class="line">[root@3a40c6cd247c /]<span class="comment"># yum install -y mysql.server</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;保存镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@3a40c6cd247c /]<span class="comment"># exit</span></div><div class="line">[root@docker ~]<span class="comment"># docker commit -m "centos-6-mysql" -a "yanyi" 3a40 centos6-mysql</span></div><div class="line">sha256:7cf0e61cef00084ad7792b8a336490c8d3a53819cc1fa1c1fc8071c8f2f8f8de</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;新建一个容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd -p 13306:3306 centos6-mysql bash</span></div><div class="line">777952322ff56b7c3ab4126e41a4a83a105c04fd785b7d52916d5b8e4a57c17a</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;再新建一个 web 容器，并和 mysql 容器互联。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd -p 18080:80 --name web --link elegant_liskov:db centos_httpd bash </span></div><div class="line">d6ec87f1e233256d11fff15d70ce602c1e9163686f4ef128e90bce3ac31fa816</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在web上运行env命令可以查看到关于db的环境变量</p>
<h2 id="12-Docker-网络管理"><a href="#12-Docker-网络管理" class="headerlink" title="12.Docker 网络管理"></a>12.Docker 网络管理</h2><h3 id="配置桥接网络-centos7"><a href="#配置桥接网络-centos7" class="headerlink" title="配置桥接网络(centos7)"></a>配置桥接网络(centos7)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为了使本地网络中的机器和Docker容器更方便的通信，我们经常会有将Docker容器配置到和主机同一网段的需求。这个需求其实很容易实现，我们只要将Docker容器和宿主机的网卡桥接起来，再给Docker容器配上IP就可以了。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;安装 brctl 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># yum install bridge-utils</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编辑网卡配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># cd /etc/sysconfig/network-scripts/</span></div><div class="line">[root@docker network-scripts]<span class="comment"># cp ifcfg-ens33 ifcfg-br0</span></div><div class="line">[root@docker network-scripts]<span class="comment"># vim ifcfg-ens33</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;配置 ifcfg-ens33 #增加BRIDGE=br0，删除IPADDR,NETMASK,GATEWAY,DNS1</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/10.png?raw=true" alt="10"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;配置 ifcfg-br0 #修改DEVICE为br0,Type为Bridge,把eth0的网络设置设置到这里来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># vim ifcfg-br0</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/11.png?raw=true" alt="11"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;重启相关服务，以及关闭相关服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># systemctl stop NetworkManager</span></div><div class="line">[root@docker network-scripts]<span class="comment"># systemctl disable NetworkManager</span></div><div class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/NetworkManager.service.</div><div class="line">Removed symlink /etc/systemd/system/dbus-org.freedesktop.NetworkManager.service.</div><div class="line">Removed symlink /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service.</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># systemctl restart network</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;br0 正常启动，能够正常访问该机器即可，再用下面命令查看有即可： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># brctl show </span></div><div class="line">bridge name    bridge id             STP enabled     interfaces</div><div class="line">br0            8000.000c295a19a5     yes             ens33</div><div class="line">docker0        8000.0242c3f92b21     no</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改docker配置文件，修改桥接的网卡以及IP分配范围</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># vim /etc/sysconfig/docker</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;将：OPTIONS=’–selinux-enabled’</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/12.png?raw=true" alt="12"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改为：OPTIONS=’–selinux-enabled -b=br0 –fixed-cidr=192.168.0.198/26’</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/13.png?raw=true" alt="13"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;重新启动docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># systemctl stop docker.service</span></div><div class="line">[root@docker network-scripts]<span class="comment"># systemctl start docker.service</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;新建 docker 容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd centos7 bash</span></div><div class="line">6cb69dbd31dd3845fc0467c436942d3cf3c08b035b24d26f43433e7c761e0043</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;进入容器，查看 IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it 6cb6 bash</span></div><div class="line">[root@6cb69dbd31dd /]<span class="comment"># ifconfig</span></div><div class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500</div><div class="line">      inet 192.168.0.192 netmask 255.255.255.0 broadcast 0.0.0.0</div><div class="line">      inet6 fe80::42:c0ff:fea8:c0 prefixlen 64 scopeid 0x20&lt;link&gt;</div><div class="line">      ether 02:42:c0:a8:00:c0 txqueuelen 0 (Ethernet)</div><div class="line">      RX packets 1880 bytes 8921311 (8.5 MiB)</div><div class="line">      RX errors 0 dropped 0 overruns 0 frame 0</div><div class="line">      TX packets 1671 bytes 116955 (114.2 KiB)</div><div class="line">      TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</div></pre></td></tr></table></figure>
<h3 id="Docker-网络管理-–-配置桥接网络-centos6"><a href="#Docker-网络管理-–-配置桥接网络-centos6" class="headerlink" title="Docker 网络管理 – 配置桥接网络(centos6)"></a>Docker 网络管理 – 配置桥接网络(centos6)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># cd /etc/sysconfig/network-scripts/</span></div><div class="line">[root@docker network-scripts]<span class="comment"># cp ifcfg-eth0 ifcfg-br0</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;配置 ifcfg-eth0 #增加BRIDGE=br0，删除IPADDR,NETMASK,GATEWAY,DNS1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># vim ifcfg-eth0</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/14.png?raw=true" alt="14"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;配置 ifcfg-br0 #修改DEVICE为br0,Type为Bridge,把eth0的网络设置设置到这里来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># vim ifcfg-br0</span></div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/15.png?raw=true" alt="15"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker network-scripts]<span class="comment"># service network restat</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;安装 git</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># yum install -y git</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;安装pipwork:  git clone <a href="https://github.com/jpetazzo/pipework" target="_blank" rel="external">https://github.com/jpetazzo/pipework</a>;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># git clone https://github.com/jpetazzo/pipework</span></div><div class="line">Initialized empty Git repository <span class="keyword">in</span> /root/pipework/.git/</div><div class="line">remote: Counting objects: 489, <span class="keyword">done</span>.</div><div class="line">remote: Total 489 (delta 0), reused 0 (delta 0), pack-reused 489</div><div class="line">Receiving objects: 100% (489/489), 167.74 KiB | 28 KiB/s, <span class="keyword">done</span>.</div><div class="line">Resolving deltas: 100% (258/258), <span class="keyword">done</span>.</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># cp ~/pipework/pipework /usr/local/bin/</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;开启一个容器: docker run -itd –net=none –name yanyi centos6-httpd bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker run -itd --net=none --name yanyi centos6-httpd bash</span></div><div class="line"> e558b8afb9fc781334fdec93b7b23103bde8bda2a46d2ed14f5b6668d9b99e05</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rpm -Uvh <a href="https://repos.fedorapeople.org/openstack/EOL/openstack-grizzly/epel-6/iproute-2.6.32-130.el6ost.netns.2.x86_64.rpm" target="_blank" rel="external">https://repos.fedorapeople.org/openstack/EOL/openstack-grizzly/epel-6/iproute-2.6.32-130.el6ost.netns.2.x86_64.rpm</a> #不安会报错Object “netns” is unknown, try “ip help”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># rpm -Uvh https://repos.fedorapeople.org/openstack/EOL/openstack-grizzly/epel-6/iproute-2.6.32-130.el6ost.netns.2.x86_64.rpm</span></div><div class="line">Retrieving https://repos.fedorapeople.org/openstack/EOL/openstack-grizzly/epel-6/iproute-2.6.32-130.el6ost.netns.2.x86_64.rpm</div><div class="line">warning: /var/tmp/rpm-tmp.fja3UU: Header V4 RSA/SHA1 Signature, key ID d97b3247: NOKEY</div><div class="line">Preparing... <span class="comment">########################################### [100%]</span></div><div class="line"> 1:iproute <span class="comment">########################################### [100%]</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;给容器配置一个 IP ：pipework br0 yanyi 192.168.0.199/24@192.168.0.1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># pipework br0 yanyi 192.168.0.199/24@192.168.0.1</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;进入容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker exec -it yanyi bash</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;进去后ifconfig查看就可以看到新添加的ip</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/16.png?raw=true" alt="16"></p>
<h2 id="13-dockerfile-格式"><a href="#13-dockerfile-格式" class="headerlink" title="13. dockerfile 格式"></a>13. dockerfile 格式</h2><h3 id="Dockerfile创建镜像-–-Dockerfile格式"><a href="#Dockerfile创建镜像-–-Dockerfile格式" class="headerlink" title="Dockerfile创建镜像 – Dockerfile格式"></a>Dockerfile创建镜像 – Dockerfile格式</h3><ul>
<li>FROM   #指定基于哪个基础镜像</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式 FROM <image> 或者  FROM <image>:<tag>，  比如</tag></image></image></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">FROM centos</div><div class="line">FROM centos:latest</div></pre></td></tr></table></figure>
<ul>
<li>MAINTAINER  #指定作者信息</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式  MAINTAIN <name> ，比如</name></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MAINTAINER  yanyi  hcldir@qq.com</div></pre></td></tr></table></figure>
<ul>
<li>RUN   #镜像操作指令</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式为 RUN <command>  或者 RUN [“executable”, “param1”, “param2”]，比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">RUN  yum install  httpd</div><div class="line">RUN [<span class="string">"/bin/bash"</span>, <span class="string">"-c"</span>, <span class="string">"echo hello"</span>]</div></pre></td></tr></table></figure>
<ul>
<li>CMD  # 三种格式：<ul>
<li>CMD [“executable”, “param1”, “param2”]</li>
<li>CMD command param1 param2</li>
<li>CMD [“param1”, “param2”]</li>
</ul>
</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;RUN和CMD看起来挺像，但是CMD用来指定容器启动时用到的命令，只能有一条。比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CMD [<span class="string">"/bin/bash"</span>, <span class="string">"/usr/local/nginx/sbin/nginx"</span>, <span class="string">"-c"</span>,  <span class="string">"/usr/local/nginx/conf/nginx.conf"</span>]</div></pre></td></tr></table></figure>
<ul>
<li>EXPOSE  </li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式为 EXPOSE <port> [<port>…] , 比如</port></port></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXPOSE 22 80 8443</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这个用来指定要映射出去的端口，比如容器内部我们启动了sshd和nginx，所以我们需要把22和80端口暴漏出去。这个需要配合-P（大写）来工作，也就是说在启动容器时，需要加上-P，让它自动分配。如果想指定具体的端口，也可以使用-p（小写）来指定。</p>
<ul>
<li>ENV  </li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式 ENV  <key> <value>, 比如  </value></key></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ENV PATH /usr/<span class="built_in">local</span>/mysql/bin:<span class="variable">$PATH</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;它主要是为后续的RUN指令提供一个环境变量，我们也可以定义一些自定义的变量</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ENV MYSQL_version 5.6</p>
<ul>
<li>ADD  格式 add <src> <dest></dest></src></li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;将本地的一个文件或目录拷贝到容器的某个目录里。 其中src为Dockerfile所在目录的相对路径，它也可以是一个url。比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ADD &lt;conf/vhosts&gt; &lt;/usr/<span class="built_in">local</span>/nginx/conf&gt;</div></pre></td></tr></table></figure>
<ul>
<li>COPY  </li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式同add</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用方法和add一样，不同的是，它不支持url</p>
<ul>
<li>ENTRYPOINT  格式类似CMD</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;容器启动时要执行的命令，它和CMD很像，也是只有一条生效，如果写多个只有最后一条有效。和CMD不同是：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;CMD 是可以被 docker run 指令覆盖的，而ENTRYPOINT不能覆盖。比如，容器名字为yanyi</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;我们在Dockerfile中指定如下CMD：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CMD [“/bin/<span class="built_in">echo</span>”, “<span class="built_in">test</span> ”]</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动容器的命令是  docker run yanyi 这样会输出 test</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;假如启动容器的命令是 docker run -it yanyi  /bin/bash  什么都不会输出</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ENTRYPOINT不会被覆盖，而且会比CMD或者docker run指定的命令要靠前执行</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ENTRYPOINT [“echo”, “test”]</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker run -it yanyi  123</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;则会输入 test  123 ，这相当于要执行命令  echo test  123 </p>
<ul>
<li>VOLUME</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式  VOLUME [“/data”]</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建一个可以从本地主机或其他容器挂载的挂载点。</p>
<ul>
<li>USER  </li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式 USER daemon</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;指定运行容器的用户</p>
<ul>
<li>WORKDIR  </li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式 WORKDIR  /path/to/workdir</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为后续的RUN、CMD或者ENTRYPOINT指定工作目录</p>
<h2 id="14-dockerfile-示例-安装-nginx"><a href="#14-dockerfile-示例-安装-nginx" class="headerlink" title="14. dockerfile 示例-安装 nginx"></a>14. dockerfile 示例-安装 nginx</h2><h3 id="Dockerfile创建镜像-–-Dockerfile示例"><a href="#Dockerfile创建镜像-–-Dockerfile示例" class="headerlink" title="Dockerfile创建镜像 – Dockerfile示例"></a>Dockerfile创建镜像 – Dockerfile示例</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;先下载nginx的配置文件 wget <a href="http://www.apelearn.com/study_v2/.nginx_conf" target="_blank" rel="external">http://www.apelearn.com/study_v2/.nginx_conf</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># wget http://www.apelearn.com/study_v2/.nginx_conf</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建 Dockerfile</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># vim Dockerfile</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">############################################################</span></div><div class="line"><span class="comment"># Dockerfile to build Nginx Installed Containers</span></div><div class="line"><span class="comment"># Based on CentOS</span></div><div class="line"><span class="comment">############################################################</span></div><div class="line"><span class="comment"># Set the base image to CentOS</span></div><div class="line">FROM centos6</div><div class="line"><span class="comment"># File Author / Maintainer</span></div><div class="line">MAINTAINER yanyi hcldir@qq.com</div><div class="line"></div><div class="line"><span class="comment"># Install necessary tools</span></div><div class="line">RUN yum install -y pcre-devel wget net-tools gcc</div><div class="line">RUN yum install -y zlib zlib-devel make</div><div class="line">RUN yum install -y openssl-devel</div><div class="line"><span class="comment"># Install Nginx</span></div><div class="line">ADD http://nginx.org/download/nginx-1.8.0.tar.gz .</div><div class="line">RUN tar zxvf nginx-1.8.0.tar.gz</div><div class="line">RUN mkdir -p /usr/<span class="built_in">local</span>/nginx</div><div class="line">RUN <span class="built_in">cd</span> nginx-1.8.0 &amp;&amp; ./configure --prefix=/usr/<span class="built_in">local</span>/nginx &amp;&amp; make &amp;&amp; make install</div><div class="line">RUN rm -fv /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</div><div class="line">COPY .nginx_conf /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</div><div class="line"></div><div class="line"><span class="comment"># Expose ports</span></div><div class="line">EXPOSE 80</div><div class="line"><span class="comment"># Set the default command to execute</span></div><div class="line"><span class="comment"># when creating a new container</span></div><div class="line">ENTRYPOINT /usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/Docker/17.png?raw=true" alt="17"></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;创建镜像：docker build -t centos_nginx  .</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker build -t centos-nginx .</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;docker  images 可以看到我们新建的镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@docker ~]<span class="comment"># docker images</span></div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Hadoop/7. 【Hadoop】HDFS的运行原理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Hadoop/7. 【Hadoop】HDFS的运行原理/" class="article-date">
  	<time datetime="2017-09-02T18:02:06.166Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Hadoop/7. 【Hadoop】HDFS的运行原理/">
        【Hadoop】HDFS的运行原理
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>HDFS</strong>（Hadoop Distributed File System ）Hadoop分布式文件系统。是根据google发表的论文翻版的。论文为GFS（Google File System）Google 文件系统（中文，英文）。</p>
<h3 id="HDFS有很多特点："><a href="#HDFS有很多特点：" class="headerlink" title="HDFS有很多特点："></a>HDFS有很多特点：</h3><ol>
<li>保存多个副本，且提供容错机制，副本丢失或宕机自动恢复。默认存3份。</li>
<li>运行在廉价的机器上。</li>
<li>适合大数据的处理。多大？多小？HDFS默认会将文件分割成block，64M为1个block。然后将block按键值对存储在HDFS上，并将键值对的映射存到内存中。如果小文件太多，那内存的负担会很重。</li>
</ol>
<p><img src="https://github.com/hcldirgit/image/blob/master/HDFS%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/01.jpeg?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如上图所示，HDFS也是按照Master和Slave的结构。分NameNode、SecondaryNameNode、DataNode这几个角色。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>NameNode</strong>：是Master节点，是大领导。管理数据块映射；处理客户端的读写请求；配置副本策略；管理HDFS的名称空间；</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>SecondaryNameNode</strong>：是一个小弟，分担大哥namenode的工作量；是NameNode的冷备份；合并fsimage和fsedits然后再发给namenode。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>DataNode</strong>：Slave节点，奴隶，干活的。负责存储client发来的数据块block；执行数据块的读写操作。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>热备份</strong>：b是a的热备份，如果a坏掉。那么b马上运行代替a的工作。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>冷备份</strong>：b是a的冷备份，如果a坏掉。那么b不能马上代替a工作。但是b上存储a的一些信息，减少a坏掉之后的损失。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>fsimage</strong>:元数据镜像文件（文件系统的目录树。）</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>edits</strong>：元数据的操作日志（针对文件系统做的修改操作记录）</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>namenode内存中存储的是=fsimage+edits</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;SecondaryNameNode负责定时默认1小时，从namenode上，获取fsimage和edits来进行合并，然后再发送给namenode。减少namenode的工作量。</p>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><h3 id="写操作："><a href="#写操作：" class="headerlink" title="写操作："></a>写操作：</h3><p><img src="https://github.com/hcldirgit/image/blob/master/HDFS%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/02.jpeg?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;有一个文件FileA，100M大小。Client将FileA写入到HDFS上。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HDFS按默认配置。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HDFS分布在三个机架上Rack1，Rack2，Rack3。</p>
<ol>
<li><p>Client将FileA按64M分块。分成两块，block1和Block2;</p>
</li>
<li><p>Client向nameNode发送写数据请求，如图<code>蓝色虚线</code>①——&gt;。</p>
</li>
<li><p>NameNode节点，记录block信息。并返回可用的DataNode，如<code>粉色虚线</code>②———&gt;。</p>
</li>
</ol>
<p>Block1: host2,host1,host3<br>Block2: host7,host8,host4</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;原理：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NameNode具有RackAware机架感知功能，这个可以配置。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;若client为DataNode节点，那存储block时，规则为：副本1，同client的节点上；副本2，不同机架节点上；副本3，同第二个副本机架的另一个节点上；其他副本随机挑选。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;若client不为DataNode节点，那存储block时，规则为：副本1，随机选择一个节点上；副本2，不同副本1，机架上；副本3，同副本2相同的另一个节点上；其他副本随机挑选。</p>
<ol>
<li>client向DataNode发送block1；发送过程是以流式写入。</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;流式写入过程，</p>
<ul>
<li>1.将64M的block1按64k的package划分;</li>
<li>2.然后将第一个package发送给host2;</li>
<li>3.host2接收完后，将第一个package发送给host1，同时client想host2发送第二个package；</li>
<li>4.host1接收完第一个package后，发送给host3，同时接收host2发来的第二个package。</li>
<li>5.以此类推，如图红线实线所示，直到将block1发送完毕。</li>
<li>6.host2,host1,host3向NameNode，host2向Client发送通知，说“消息发送完了”。如图粉红颜色实线所示。</li>
<li>7.client收到host2发来的消息后，向namenode发送消息，说我写完了。这样就真完成了。如图黄色粗实线</li>
<li>8.发送完block1后，再向host7，host8，host4发送block2，如图蓝色实线所示。</li>
<li>9.发送完block2后，host7,host8,host4向NameNode，host7向Client发送通知，如图浅绿色实线所示。</li>
<li>10.client向NameNode发送消息，说我写完了，如图黄色粗实线。。。这样就完毕了。</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>分析</strong>，通过写过程，我们可以了解到：</p>
<ul>
<li>写1T文件，我们需要3T的存储，3T的网络流量贷款。</li>
<li>在执行读或写的过程中，NameNode和DataNode通过HeartBeat进行保存通信，确定DataNode活着。如果发现DataNode死掉了，就将死掉的DataNode上的数据，放到其他节点去。读取时，要读其他节点去。</li>
<li>挂掉一个节点，没关系，还有其他节点可以备份；甚至，挂掉某一个机架，也没关系；其他机架上，也有备份。</li>
</ul>
<h2 id="读操作："><a href="#读操作：" class="headerlink" title="读操作："></a>读操作：</h2><p><img src="https://github.com/hcldirgit/image/blob/master/HDFS%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86/03.jpeg?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;读操作就简单一些了，如图所示，client要从datanode上，读取FileA。而FileA由block1和block2组成。 </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;那么，读操作流程为：</p>
<ol>
<li><p>client向namenode发送读请求。</p>
</li>
<li><p>namenode查看Metadata信息，返回fileA的block的位置。<br>block1:host2,host1,host3<br>block2:host7,host8,host4    </p>
</li>
<li><p>block的位置是有先后顺序的，先读block1，再读block2。而且block1去host2上读取；然后block2，去host7上读取；</p>
</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;上面例子中，client位于机架外，那么如果client位于机架内某个DataNode上，例如,client是host6。那么读取的时候，遵循的规律是：<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>优选读取本机架上的数据</strong>。</p>
<h2 id="HDFS中常用到的命令"><a href="#HDFS中常用到的命令" class="headerlink" title="HDFS中常用到的命令"></a>HDFS中常用到的命令</h2><h3 id="1、hadoop-fs"><a href="#1、hadoop-fs" class="headerlink" title="1、hadoop fs"></a>1、hadoop fs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">hadoop fs -ls /  </div><div class="line">hadoop fs -lsr  </div><div class="line">hadoop fs -mkdir /user/hadoop  </div><div class="line">hadoop fs -put a.txt /user/hadoop/  </div><div class="line">hadoop fs -get /user/hadoop/a.txt /  </div><div class="line">hadoop fs -cp src dst  </div><div class="line">hadoop fs -mv src dst  </div><div class="line">hadoop fs -cat /user/hadoop/a.txt  </div><div class="line">hadoop fs -rm /user/hadoop/a.txt  </div><div class="line">hadoop fs -rmr /user/hadoop/a.txt  </div><div class="line">hadoop fs -text /user/hadoop/a.txt  </div><div class="line">hadoop fs -copyFromLocal localsrc dst <span class="comment">#与hadoop fs -put功能类似。  </span></div><div class="line">hadoop fs -moveFromLocal localsrc dst <span class="comment">#将本地文件上传到hdfs，同时删除本地文件。</span></div></pre></td></tr></table></figure>
<h3 id="2、hadoop-fsadmin"><a href="#2、hadoop-fsadmin" class="headerlink" title="2、hadoop fsadmin"></a>2、hadoop fsadmin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hadoop dfsadmin -report  </div><div class="line">hadoop dfsadmin -safemode enter | leave | get | <span class="built_in">wait</span>  </div><div class="line">hadoop dfsadmin -setBalancerBandwidth 1000</div></pre></td></tr></table></figure>
<h3 id="3、hadoop-fsck"><a href="#3、hadoop-fsck" class="headerlink" title="3、hadoop fsck"></a>3、hadoop fsck</h3><h3 id="4、start-balancer-sh"><a href="#4、start-balancer-sh" class="headerlink" title="4、start-balancer.sh"></a>4、start-balancer.sh</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hadoop/">Hadoop</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/31/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="page-number" href="/page/31/">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/">33</a><a class="page-number" href="/page/34/">34</a><span class="space">&hellip;</span><a class="page-number" href="/page/63/">63</a><a class="extend next" rel="next" href="/page/33/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 失落的乐章
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    

<script>
	var yiliaConfig = {
		fancybox: ,
		mathjax: ,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



  </div>
</body>
</html>