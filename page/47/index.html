<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>失落的乐章</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="失落的乐章的Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="失落的乐章">
<meta property="og:url" content="https://hcldirgit.github.io/page/47/index.html">
<meta property="og:site_name" content="失落的乐章">
<meta property="og:description" content="失落的乐章的Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="失落的乐章">
<meta name="twitter:description" content="失落的乐章的Blog">
  
    <link rel="alternative" href="/atom.xml" title="失落的乐章" type="application/atom+xml">
  
  
    <link rel="icon" href="https://github.com/hcldirgit/image/blob/master/0.png?raw=true">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85415703-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">失落的乐章</a></h1>
		</hgroup>

		
		<p class="header-subtitle">技术面前，永远都是学生。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Ansible/" style="font-size: 10.42px;">Ansible</a> <a href="/tags/Apache/" style="font-size: 18.33px;">Apache</a> <a href="/tags/Cacti/" style="font-size: 11.67px;">Cacti</a> <a href="/tags/DNS/" style="font-size: 13.33px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/FTP/" style="font-size: 11.25px;">FTP</a> <a href="/tags/Git/" style="font-size: 10.83px;">Git</a> <a href="/tags/HA集群/" style="font-size: 11.67px;">HA集群</a> <a href="/tags/Hadoop/" style="font-size: 12.5px;">Hadoop</a> <a href="/tags/Jenkins/" style="font-size: 10.42px;">Jenkins</a> <a href="/tags/LAMP/" style="font-size: 19.58px;">LAMP</a> <a href="/tags/LNMP/" style="font-size: 17.08px;">LNMP</a> <a href="/tags/LVS/" style="font-size: 16.67px;">LVS</a> <a href="/tags/Linux/" style="font-size: 19.17px;">Linux</a> <a href="/tags/Linux命令/" style="font-size: 20px;">Linux命令</a> <a href="/tags/Linux安全/" style="font-size: 14.17px;">Linux安全</a> <a href="/tags/Memcached/" style="font-size: 11.25px;">Memcached</a> <a href="/tags/MongoDB/" style="font-size: 15.42px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 17.5px;">MySQL</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/Nagios/" style="font-size: 11.67px;">Nagios</a> <a href="/tags/Nginx/" style="font-size: 17.92px;">Nginx</a> <a href="/tags/OpenStack/" style="font-size: 11.25px;">OpenStack</a> <a href="/tags/Php/" style="font-size: 14.58px;">Php</a> <a href="/tags/Puppet/" style="font-size: 11.25px;">Puppet</a> <a href="/tags/Python/" style="font-size: 14.58px;">Python</a> <a href="/tags/Redis/" style="font-size: 16.25px;">Redis</a> <a href="/tags/Resin/" style="font-size: 10px;">Resin</a> <a href="/tags/Saltstack/" style="font-size: 10px;">Saltstack</a> <a href="/tags/Samba/" style="font-size: 12.08px;">Samba</a> <a href="/tags/Squid/" style="font-size: 14.58px;">Squid</a> <a href="/tags/Tomcat/" style="font-size: 13.75px;">Tomcat</a> <a href="/tags/Zabbix/" style="font-size: 15.83px;">Zabbix</a> <a href="/tags/haproxy/" style="font-size: 12.5px;">haproxy</a> <a href="/tags/keepalived/" style="font-size: 12.92px;">keepalived</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/shell练习/" style="font-size: 18.75px;">shell练习</a> <a href="/tags/正则表达式/" style="font-size: 12.92px;">正则表达式</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">失落的乐章</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">失落的乐章</h1>
			</hgroup>
			
			<p class="header-subtitle">技术面前，永远都是学生。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-2. Linux 命令/46. Linux 命令- top" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/46. Linux 命令- top/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.254Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/46. Linux 命令- top/">
        Linux 命令- top
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;top命令是Linux下常用的性能分析工具，能够实时显示系统中各个进程的资源占用状况，类似于Windows的任务管理器。下面详细介绍它的使用方法。top是一个动态显示过程,即可以通过用户按键来不断刷新当前状态.如果在前台执行该命令,它将独占前台,直到用户终止该程序为止.比较准确的说,top命令提供了实时的对系统处理器的状态监视.它将显示系统中CPU最“敏感”的任务列表.该命令可以按CPU使用.内存使用和执行时间对任务进行排序；而且该命令的很多特性都可以通过交互式命令或者在个人定制文件中进行设定.</p>
<h2 id="1．命令格式"><a href="#1．命令格式" class="headerlink" title="1．命令格式"></a>1．命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top [参数]</div></pre></td></tr></table></figure>
<h2 id="2．命令功能"><a href="#2．命令功能" class="headerlink" title="2．命令功能"></a>2．命令功能</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;显示当前系统正在执行的进程的相关信息，包括进程ID、内存占用率、CPU占用率等</p>
<h2 id="3．命令参数"><a href="#3．命令参数" class="headerlink" title="3．命令参数"></a>3．命令参数</h2><ul>
<li>-b 批处理</li>
<li>-c 显示完整的治命令</li>
<li>-I 忽略失效过程</li>
<li>-s 保密模式</li>
<li>-S 累积模式</li>
<li>-i&lt;时间&gt; 设置间隔时间</li>
<li>-u&lt;用户名&gt; 指定用户名</li>
<li>-p&lt;进程号&gt; 指定进程</li>
<li>-n&lt;次数&gt; 循环显示的次数</li>
</ul>
<h2 id="4．使用实例"><a href="#4．使用实例" class="headerlink" title="4．使用实例"></a>4．使用实例</h2><h3 id="实例1：显示进程信息"><a href="#实例1：显示进程信息" class="headerlink" title="实例1：显示进程信息"></a>实例1：显示进程信息</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">[root@TG1704 <span class="built_in">log</span>]<span class="comment"># top</span></div><div class="line">top - 14:06:23 up 70 days, 16:44,  2 users,  load average: 1.25, 1.32, 1.35</div><div class="line">Tasks: 206 total,   1 running, 205 sleeping,   0 stopped,   0 zombie</div><div class="line">Cpu(s):  5.9%us,  3.4%sy,  0.0%ni, 90.4%id,  0.0%wa,  0.0%hi,  0.2%si,  0.0%st</div><div class="line">Mem:  32949016k total, 14411180k used, 18537836k free,   169884k buffers</div><div class="line">Swap: 32764556k total,        0k used, 32764556k free,  3612636k cached</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                </div><div class="line">28894 root      22   0 1501m 405m  10m S 52.2  1.3   2534:16 java                                                                   </div><div class="line">18249 root      18   0 3201m 1.9g  11m S 35.9  6.0 569:39.41 java                                                                   </div><div class="line"> 2808 root      25   0 3333m 1.0g  11m S 24.3  3.1 526:51.85 java                                                                   </div><div class="line">25668 root      23   0 3180m 704m  11m S 14.0  2.2 360:44.53 java                                                                   </div><div class="line">  574 root      25   0 3168m 611m  10m S 12.6  1.9 556:59.63 java                                                                   </div><div class="line"> 1599 root      20   0 3237m 1.9g  11m S 12.3  6.2 262:01.14 java                                                                   </div><div class="line"> 1008 root      21   0 3147m 842m  10m S  0.3  2.6   4:31.08 java                                                                   </div><div class="line">13823 root      23   0 3031m 2.1g  10m S  0.3  6.8 176:57.34 java                                                                   </div><div class="line">28218 root      15   0 12760 1168  808 R  0.3  0.0   0:01.43 top                                                                    </div><div class="line">29062 root      20   0 1241m 227m  10m S  0.3  0.7   2:07.32 java                                                                   </div><div class="line">    1 root      15   0 10368  684  572 S  0.0  0.0   1:30.85 init                                                                   </div><div class="line">    2 root      RT  -5     0    0    0 S  0.0  0.0   0:01.01 migration/0                                                            </div><div class="line">    3 root      34  19     0    0    0 S  0.0  0.0   0:00.00 ksoftirqd/0                                                            </div><div class="line">    4 root      RT  -5     0    0    0 S  0.0  0.0   0:00.00 watchdog/0                                                             </div><div class="line">    5 root      RT  -5     0    0    0 S  0.0  0.0   0:00.80 migration/1                                                            </div><div class="line">    6 root      34  19     0    0    0 S  0.0  0.0   0:00.00 ksoftirqd/1                                                            </div><div class="line">    7 root      RT  -5     0    0    0 S  0.0  0.0   0:00.00 watchdog/1                                                             </div><div class="line">    8 root      RT  -5     0    0    0 S  0.0  0.0   0:20.59 migration/2                                                            </div><div class="line">    9 root      34  19     0    0    0 S  0.0  0.0   0:00.09 ksoftirqd/2                                                            </div><div class="line">   10 root      RT  -5     0    0    0 S  0.0  0.0   0:00.00 watchdog/2                                                             </div><div class="line">   11 root      RT  -5     0    0    0 S  0.0  0.0   0:23.66 migration/3                                                            </div><div class="line">   12 root      34  19     0    0    0 S  0.0  0.0   0:00.03 ksoftirqd/3                                                            </div><div class="line">   13 root      RT  -5     0    0    0 S  0.0  0.0   0:00.00 watchdog/3                                                             </div><div class="line">   14 root      RT  -5     0    0    0 S  0.0  0.0   0:20.29 migration/4                                                            </div><div class="line">   15 root      34  19     0    0    0 S  0.0  0.0   0:00.07 ksoftirqd/4                                                            </div><div class="line">   16 root      RT  -5     0    0    0 S  0.0  0.0   0:00.00 watchdog/4                                                             </div><div class="line">   17 root      RT  -5     0    0    0 S  0.0  0.0   0:23.07 migration/5                                                            </div><div class="line">   18 root      34  19     0    0    0 S  0.0  0.0   0:00.07 ksoftirqd/5                                                            </div><div class="line">   19 root      RT  -5     0    0    0 S  0.0  0.0   0:00.00 watchdog/5                                                             </div><div class="line">   20 root      RT  -5     0    0    0 S  0.0  0.0   0:17.16 migration/6                                                            </div><div class="line">   21 root      34  19     0    0    0 S  0.0  0.0   0:00.05 ksoftirqd/6                                                            </div><div class="line">   22 root      RT  -5     0    0    0 S  0.0  0.0   0:00.00 watchdog/6                                                             </div><div class="line">   23 root      RT  -5     0    0    0 S  0.0  0.0   0:58.28 migration/7</div></pre></td></tr></table></figure>
<h4 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h4><h5 id="统计信息区："><a href="#统计信息区：" class="headerlink" title="统计信息区："></a>统计信息区：</h5><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;前五行是当前系统情况整体的统计信息区。下面我们看每一行信息的具体意义。</p>
<h6 id="第一行，任务队列信息，同-uptime-命令的执行结果，具体参数说明情况如下："><a href="#第一行，任务队列信息，同-uptime-命令的执行结果，具体参数说明情况如下：" class="headerlink" title="第一行，任务队列信息，同 uptime 命令的执行结果，具体参数说明情况如下："></a>第一行，任务队列信息，同 uptime 命令的执行结果，具体参数说明情况如下：</h6><ul>
<li>14:06:23 — 当前系统时间</li>
<li>up 70 days, 16:44 — 系统已经运行了70天16小时44分钟（在这期间系统没有重启过的吆！）</li>
<li>2 users — 当前有2个用户登录系统</li>
<li>load average: 1.15, 1.42, 1.44 — load average后面的三个数分别是1分钟、5分钟、15分钟的负载情况。</li>
<li>load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。       </li>
</ul>
<h6 id="第二行，Tasks-—-任务（进程），具体信息说明如下："><a href="#第二行，Tasks-—-任务（进程），具体信息说明如下：" class="headerlink" title="第二行，Tasks — 任务（进程），具体信息说明如下："></a>第二行，Tasks — 任务（进程），具体信息说明如下：</h6><ul>
<li>系统现在共有206个进程，其中处于运行中的有1个，205个在休眠（sleep），stoped状态的有0个，zombie状态（僵尸）的有0个。</li>
</ul>
<h6 id="第三行，cpu状态信息，具体属性说明如下："><a href="#第三行，cpu状态信息，具体属性说明如下：" class="headerlink" title="第三行，cpu状态信息，具体属性说明如下："></a>第三行，cpu状态信息，具体属性说明如下：</h6><ul>
<li>5.9%us — 用户空间占用CPU的百分比。      </li>
<li>3.4% sy — 内核空间占用CPU的百分比。      </li>
<li>0.0% ni — 改变过优先级的进程占用CPU的百分比      </li>
<li>90.4% id — 空闲CPU百分比      </li>
<li>0.0% wa — IO等待占用CPU的百分比      </li>
<li>0.0% hi — 硬中断（Hardware IRQ）占用CPU的百分比      </li>
<li>0.2% si — 软中断（Software Interrupts）占用CPU的百分比      </li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>备注：在这里CPU的使用比率和windows概念不同，需要理解linux系统用户空间和内核空间的相关知识！</strong></p>
<h6 id="第四行-内存状态，具体信息如下："><a href="#第四行-内存状态，具体信息如下：" class="headerlink" title="第四行,内存状态，具体信息如下："></a>第四行,内存状态，具体信息如下：</h6><ul>
<li>32949016k total — 物理内存总量（32GB）      </li>
<li>14411180k used — 使用中的内存总量（14GB）      </li>
<li>18537836k free — 空闲内存总量（18GB）      </li>
<li>169884k buffers — 缓存的内存量 （169M）</li>
</ul>
<h6 id="第五行，swap交换分区信息，具体信息说明如下："><a href="#第五行，swap交换分区信息，具体信息说明如下：" class="headerlink" title="第五行，swap交换分区信息，具体信息说明如下："></a>第五行，swap交换分区信息，具体信息说明如下：</h6><ul>
<li>32764556k total — 交换区总量（32GB）            </li>
<li>0k used — 使用的交换区总量（0K）      </li>
<li>32764556k free — 空闲交换区总量（32GB）          </li>
<li>3612636k cached — 缓冲的交换区总量（3.6GB）      </li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>备注</strong>：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量。纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心。      </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果出于习惯去计算可用内存数，这里有个近似的计算公式：第四行的free + 第四行的buffers + 第五行的cached，按这个公式此台服务器的可用内存：18537836k +169884k +3612636k = 22GB左右。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。</p>
<h6 id="第六行，空行。"><a href="#第六行，空行。" class="headerlink" title="第六行，空行。"></a>第六行，空行。</h6><h6 id="第七行以下：各进程（任务）的状态监控，项目列信息说明如下："><a href="#第七行以下：各进程（任务）的状态监控，项目列信息说明如下：" class="headerlink" title="第七行以下：各进程（任务）的状态监控，项目列信息说明如下："></a>第七行以下：各进程（任务）的状态监控，项目列信息说明如下：</h6><ul>
<li>PID — 进程id      </li>
<li>USER — 进程所有者             </li>
<li>PR — 进程优先级        </li>
<li>NI — nice值。负值表示高优先级，正值表示低优先级       </li>
<li>VIRT — 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES          </li>
<li>RES — 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA          </li>
<li>SHR — 共享内存大小，单位kb      </li>
<li>S — 进程状态。D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程      </li>
<li>%CPU — 上次更新到现在的CPU时间占用百分比      </li>
<li>%MEM — 进程使用的物理内存百分比      </li>
<li>TIME+ — 进程使用的CPU时间总计，单位1/100秒      </li>
<li>COMMAND — 进程名称（命令名/命令行）</li>
</ul>
<h5 id="其他使用技巧："><a href="#其他使用技巧：" class="headerlink" title="其他使用技巧："></a>其他使用技巧：</h5><h6 id="1-多U多核CPU监控"><a href="#1-多U多核CPU监控" class="headerlink" title="1.多U多核CPU监控"></a>1.多U多核CPU监控</h6><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在top基本视图中，按键盘数字“1”，可监控每个逻辑CPU的状况：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-top/01.jpg?raw=true" alt="">     </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;观察上图，服务器有16个逻辑CPU，实际上是4个物理CPU。再按数字键1，就会返回到top基本视图界面。</p>
<h6 id="2-高亮显示当前运行进程"><a href="#2-高亮显示当前运行进程" class="headerlink" title="2.高亮显示当前运行进程"></a>2.高亮显示当前运行进程</h6><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;敲击键盘“b”（打开/关闭加亮效果），top的视图变化如下：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-top/02.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;发现进程id为2570的“top”进程被加亮了，top进程就是视图第二行显示的唯一的运行态（runing）的那个进程，可以通过敲击“y”键关闭或打开运行态进程的加亮效果。</p>
<h6 id="3-进程字段排序"><a href="#3-进程字段排序" class="headerlink" title="3.进程字段排序"></a>3.进程字段排序</h6><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;默认进入top时，各进程是按照CPU的占用量来排序的，在下图中进程ID为28894的java进程排在第一（cpu占用142%），进程ID为574的java进程排在第二（cpu占用16%）。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-top/03.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;敲击键盘“x”（打开/关闭排序列的加亮效果），top的视图变化如下：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-top/04.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;可以看到，top默认的排序列是“%CPU”。</p>
<h6 id="4-通过”shift-gt-”或”shift-lt-”可以向右或左改变排序列"><a href="#4-通过”shift-gt-”或”shift-lt-”可以向右或左改变排序列" class="headerlink" title="4. 通过”shift + &gt;”或”shift + &lt;”可以向右或左改变排序列"></a>4. 通过”shift + &gt;”或”shift + &lt;”可以向右或左改变排序列</h6><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下图是按一次”shift + &gt;”的效果图,视图现在已经按照%MEM来排序。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-top/05.png?raw=true" alt=""></p>
<h3 id="实例2：显示-完整命令"><a href="#实例2：显示-完整命令" class="headerlink" title="实例2：显示 完整命令"></a>实例2：显示 完整命令</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top -c</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-top/06.png?raw=true" alt=""></p>
<h3 id="实例3：显示指定的进程信息"><a href="#实例3：显示指定的进程信息" class="headerlink" title="实例3：显示指定的进程信息"></a>实例3：显示指定的进程信息</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top -p 574</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-top/07.png?raw=true" alt=""></p>
<h2 id="5-top交互命令"><a href="#5-top交互命令" class="headerlink" title="5.top交互命令"></a>5.top交互命令</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在top 命令执行过程中可以使用的一些交互命令。这些命令都是单字母的，如果在命令行中使用了s 选项， 其中一些命令可能会被屏蔽。</p>
<ul>
<li>h 显示帮助画面，给出一些简短的命令总结说明</li>
<li>k 终止一个进程。</li>
<li>i 忽略闲置和僵死进程。这是一个开关式命令。</li>
<li>q 退出程序</li>
<li>r 重新安排一个进程的优先级别</li>
<li>S 切换到累计模式</li>
<li>s 改变两次刷新之间的延迟时间（单位为s），如果有小数，就换算成m s。输入0值则系统将不断刷新，默认值是5 s</li>
<li>f或者F 从当前显示中添加或者删除项目</li>
<li>o或者O 改变显示项目的顺序</li>
<li>l 切换显示平均负载和启动时间信息</li>
<li>m 切换显示内存信息</li>
<li>t 切换显示进程和CPU状态信息</li>
<li>c 切换显示命令名称和完整命令行</li>
<li>M 根据驻留内存大小进行排序</li>
<li>P 根据CPU使用百分比大小进行排序</li>
<li>T 根据时间/累计时间进行排序</li>
<li>W 将当前设置写入~/.toprc文件中 </li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/20. find 命令之 exec" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/20. find 命令之 exec/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.253Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/20. find 命令之 exec/">
        find 命令之 exec
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;find是我们很常用的一个Linux命令，但是我们一般查找出来的并不仅仅是看看而已，还会有进一步的操作，这个时候exec的作用就显现出来了。</p>
<h2 id="exec解释："><a href="#exec解释：" class="headerlink" title="exec解释："></a>exec解释：</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-exec  参数后面跟的是command命令，它的终止是以;为结束标志的，所以这句命令后面的分号是不可缺少的，考虑到各个系统中分号会有不同的意义，所以前面加反斜杠。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;{}   花括号代表前面find查找出来的文件名。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用find时，只要把想要的操作写在一个文件里，就可以用exec来配合find查找，很方便的。在有些操作系统中只允许-exec选项执行诸如l s或ls -l这样的命令。大多数用户使用这一选项是为了查找旧文件并删除它们。建议在真正执行rm命令删除文件之前，最好先用ls命令看一下，确认它们是所要删除的文件。 exec选项后面跟随着所要执行的命令或脚本，然后是一对儿{ }，一个空格和一个\，最后是一个分号。为了使用exec选项，必须要同时使用print选项。如果验证一下find命令，会发现该命令只输出从当前路径起的相对路径及文件名。</p>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><h3 id="实例1：ls-l-命令放在-find-命令的-exec-选项中"><a href="#实例1：ls-l-命令放在-find-命令的-exec-选项中" class="headerlink" title="实例1：ls -l 命令放在 find 命令的 -exec 选项中"></a>实例1：ls -l 命令放在 find 命令的 -exec 选项中</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find . -<span class="built_in">type</span> d -<span class="built_in">exec</span> ls -l &#123;&#125; \;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find . -type f -exec ls -l &#123;&#125; \; </span></div><div class="line">-rw-r--r-- 1 root root 127 10-28 16:51 ./log2014.log</div><div class="line">-rw-r--r-- 1 root root 0 10-28 14:47 ./test4/log3-2.log</div><div class="line">-rw-r--r-- 1 root root 0 10-28 14:47 ./test4/log3-3.log</div><div class="line">-rw-r--r-- 1 root root 0 10-28 14:47 ./test4/log3-1.log</div><div class="line">-rw-r--r-- 1 root root 33 10-28 16:54 ./log2013.log</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 ./log2012.log</div><div class="line">-rw-r--r-- 1 root root 25 10-28 17:02 ./log.log</div><div class="line">-rw-r--r-- 1 root root 37 10-28 17:07 ./log.txt</div><div class="line">-rw-r--r-- 1 root root 0 10-28 14:47 ./test3/log3-2.log</div><div class="line">-rw-r--r-- 1 root root 0 10-28 14:47 ./test3/log3-3.log</div><div class="line">-rw-r--r-- 1 root root 0 10-28 14:47 ./test3/log3-1.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;上例中，find 命令匹配到了当前目录下的所有普通文件，并在 -exec 选项中使用 ls -l 命令将他们列出来。</p>
<h3 id="实例2：在目录中查找更改时间在-n-日以前的文件并删除它们"><a href="#实例2：在目录中查找更改时间在-n-日以前的文件并删除它们" class="headerlink" title="实例2：在目录中查找更改时间在 n 日以前的文件并删除它们"></a>实例2：在目录中查找更改时间在 n 日以前的文件并删除它们</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find . -<span class="built_in">type</span> f -mtime +14 -<span class="built_in">exec</span> rm &#123;&#125; \;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">总计 328</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 log2012.log</div><div class="line">-rw-r--r-- 1 root root     33 10-28 16:54 log2013.log</div><div class="line">-rw-r--r-- 1 root root    127 10-28 16:51 log2014.log</div><div class="line">lrwxrwxrwx 1 root root      7 10-28 15:18 log_link.log -&gt; log.log</div><div class="line">-rw-r--r-- 1 root root     25 10-28 17:02 log.log</div><div class="line">-rw-r--r-- 1 root root     37 10-28 17:07 log.txt</div><div class="line">drwxr-xr-x 6 root root   4096 10-27 01:58 scf</div><div class="line">drwxrwxrwx 2 root root   4096 10-28 14:47 test3</div><div class="line">drwxrwxrwx 2 root root   4096 10-28 14:47 test4</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find . -type f -mtime +14 -exec rm &#123;&#125; \;</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">总计 312</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 log2012.log</div><div class="line">lrwxrwxrwx 1 root root      7 10-28 15:18 log_link.log -&gt; log.log</div><div class="line">drwxr-xr-x 6 root root   4096 10-27 01:58 scf</div><div class="line">drwxrwxrwx 2 root root   4096 11-12 19:32 test3</div><div class="line">drwxrwxrwx 2 root root   4096 11-12 19:32 test4</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在 shell 中用任何方式删除文件之前，应当先查看相应的文件，一定要小心！当使用诸如 mv 或 rm 命令时，可以使用 -exec 选项的安全模式。它将在对每个匹配到的文件进行操作之前提示你。</p>
<h3 id="实例3：在目录中查找更改时间在-n-日以前的文件并删除它们，在删除之前先给出提示"><a href="#实例3：在目录中查找更改时间在-n-日以前的文件并删除它们，在删除之前先给出提示" class="headerlink" title="实例3：在目录中查找更改时间在 n 日以前的文件并删除它们，在删除之前先给出提示"></a>实例3：在目录中查找更改时间在 n 日以前的文件并删除它们，在删除之前先给出提示</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find . -name <span class="string">"*.log"</span> -mtime +5 -ok rm &#123;&#125; \;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">总计 312</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 log2012.log</div><div class="line">lrwxrwxrwx 1 root root      7 10-28 15:18 log_link.log -&gt; log.log</div><div class="line">drwxr-xr-x 6 root root   4096 10-27 01:58 scf</div><div class="line">drwxrwxrwx 2 root root   4096 11-12 19:32 test3</div><div class="line">drwxrwxrwx 2 root root   4096 11-12 19:32 test4</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find . -name "*.log" -mtime +5 -ok rm &#123;&#125; \;</span></div><div class="line">&lt; rm ... ./log_link.log &gt; ? y</div><div class="line">&lt; rm ... ./log2012.log &gt; ? n</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">总计 312</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 log2012.log</div><div class="line">drwxr-xr-x 6 root root   4096 10-27 01:58 scf</div><div class="line">drwxrwxrwx 2 root root   4096 11-12 19:32 test3</div><div class="line">drwxrwxrwx 2 root root   4096 11-12 19:32 test4</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在上例中，find 命令在当前目录中查找所有文件名以 .log 结尾、更改时间在5日以上的文件，并删除它们，只不过在删除之前先给出提示。按 y 键删除文件，按 n 键不删除。</p>
<h3 id="实例4：-exec-中使用-grep-命令"><a href="#实例4：-exec-中使用-grep-命令" class="headerlink" title="实例4：-exec 中使用 grep  命令"></a>实例4：-exec 中使用 grep  命令</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find /etc -name <span class="string">"passwd*"</span> -<span class="built_in">exec</span> grep <span class="string">"root"</span> &#123;&#125; \;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find /etc -name "passwd*" -exec grep "root" &#123;&#125; \;</span></div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;任何形式的命令都可以在 -exec 选项中使用。在上例中使用 grep 命令。find 命令首先匹配所有文件名为 “passwd” 的文件，例如：passwd、passwd.old、paaswd.bak，然后执行 grep 命令看看在这些文件中是否存在一个 root 用户。</p>
<h3 id="实例5：查找文件移动到指定目录"><a href="#实例5：查找文件移动到指定目录" class="headerlink" title="实例5：查找文件移动到指定目录"></a>实例5：查找文件移动到指定目录</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find . -name <span class="string">"*.log"</span> -<span class="built_in">exec</span> mv &#123;&#125; .. \;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">总计 12drwxr-xr-x 6 root root 4096 10-27 01:58 scf</div><div class="line">drwxrwxr-x 2 root root 4096 11-12 22:49 test3</div><div class="line">drwxrwxr-x 2 root root 4096 11-12 19:32 test4</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd test3/</span></div><div class="line">[root@localhost test3]<span class="comment"># ll</span></div><div class="line">总计 304</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 log2012.log</div><div class="line">-rw-r--r-- 1 root root     61 11-12 22:44 log2013.log</div><div class="line">-rw-r--r-- 1 root root      0 11-12 22:25 log2014.log</div><div class="line">[root@localhost test3]<span class="comment"># find . -name "*.log" -exec mv &#123;&#125; .. \;</span></div><div class="line">[root@localhost test3]<span class="comment"># ll</span></div><div class="line">总计 0[root@localhost test3]<span class="comment"># cd ..</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">总计 316</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 log2012.log</div><div class="line">-rw-r--r-- 1 root root     61 11-12 22:44 log2013.log</div><div class="line">-rw-r--r-- 1 root root      0 11-12 22:25 log2014.log</div><div class="line">drwxr-xr-x 6 root root   4096 10-27 01:58 scf</div><div class="line">drwxrwxr-x 2 root root   4096 11-12 22:50 test3</div><div class="line">drwxrwxr-x 2 root root   4096 11-12 19:32 test4</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h3 id="实例6：用-exec-选项执行-cp-命令"><a href="#实例6：用-exec-选项执行-cp-命令" class="headerlink" title="实例6：用 exec 选项执行 cp 命令"></a>实例6：用 exec 选项执行 cp 命令</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find . -name <span class="string">"*.log"</span> -<span class="built_in">exec</span> cp &#123;&#125; test3 \;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@localhost test3]<span class="comment"># ll</span></div><div class="line">总计 0[root@localhost test3]<span class="comment"># cd ..</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">总计 316</div><div class="line">-rw-r--r-- 1 root root 302108 11-03 06:19 log2012.log</div><div class="line">-rw-r--r-- 1 root root     61 11-12 22:44 log2013.log</div><div class="line">-rw-r--r-- 1 root root      0 11-12 22:25 log2014.log</div><div class="line">drwxr-xr-x 6 root root   4096 10-27 01:58 scf</div><div class="line">drwxrwxr-x 2 root root   4096 11-12 22:50 test3</div><div class="line">drwxrwxr-x 2 root root   4096 11-12 19:32 test4</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># find . -name "*.log" -exec cp &#123;&#125; test3 \;</span></div><div class="line">cp: “./test3/log2014.log” 及 “test3/log2014.log” 为同一文件</div><div class="line">cp: “./test3/log2013.log” 及 “test3/log2013.log” 为同一文件</div><div class="line">cp: “./test3/log2012.log” 及 “test3/log2012.log” 为同一文件</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd test3</span></div><div class="line">[root@localhost test3]<span class="comment"># ll</span></div><div class="line">总计 304</div><div class="line">-rw-r--r-- 1 root root 302108 11-12 22:54 log2012.log</div><div class="line">-rw-r--r-- 1 root root     61 11-12 22:54 log2013.log</div><div class="line">-rw-r--r-- 1 root root      0 11-12 22:54 log2014.log</div><div class="line">[root@localhost test3]<span class="comment">#</span></div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/73. Linux 命令- yum" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/73. Linux 命令- yum/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.253Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/73. Linux 命令- yum/">
        Linux 命令- yum
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;yum（ Yellow dog Updater, Modified）是一个在Fedora和RedHat以及SUSE中的Shell前端软件包管理器。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;基於RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软体包，无须繁琐地一次次下载、安装。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;yum提供了查找、安装、删除某一个、一组甚至全部软件包的命令，而且命令简洁而又好记。</p>
<h2 id="yum-语法"><a href="#yum-语法" class="headerlink" title="yum 语法"></a>yum 语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum [options] [<span class="built_in">command</span>] [package ...]</div></pre></td></tr></table></figure>
<ul>
<li>options：可选，选项包括-h（帮助），-y（当安装过程提示选择全部为”yes”），-q（不显示安装的过程）等等。</li>
<li>command：要进行的操作。</li>
<li>package操作的对象。</li>
</ul>
<h2 id="yum常用命令"><a href="#yum常用命令" class="headerlink" title="yum常用命令"></a>yum常用命令</h2><ul>
<li>列出所有可更新的软件清单命令：yum check-update</li>
<li>更新所有软件命令：yum update</li>
<li>仅安装指定的软件命令：yum install <package_name></package_name></li>
<li>仅更新指定的软件命令：yum update <package_name></package_name></li>
<li>列出所有可安裝的软件清单命令：yum list</li>
<li>删除软件包命令：yum remove <package_name></package_name></li>
<li>查找软件包 命令：yum search <keyword></keyword></li>
<li>清除缓存命令:<ul>
<li>yum clean packages: 清除缓存目录下的软件包</li>
<li>yum clean headers: 清除缓存目录下的 headers</li>
<li>yum clean oldheaders: 清除缓存目录下旧的 headers</li>
<li>yum clean, yum clean all (= yum clean packages; yum clean oldheaders) :清除缓存目录下的软件包及旧的headers</li>
</ul>
</li>
</ul>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><h3 id="实例1：安装-pam-devel"><a href="#实例1：安装-pam-devel" class="headerlink" title="实例1：安装 pam-devel"></a>实例1：安装 pam-devel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># yum install pam-devel</span></div><div class="line">Setting up Install Process</div><div class="line">Parsing package install arguments</div><div class="line">Resolving Dependencies  &lt;==先检查软件的属性相依问题</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package pam-devel.i386 0:0.99.6.2-4.el5 <span class="built_in">set</span> to be updated</div><div class="line">--&gt; Processing Dependency: pam = 0.99.6.2-4.el5 <span class="keyword">for</span> package: pam-devel</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package pam.i386 0:0.99.6.2-4.el5 <span class="built_in">set</span> to be updated</div><div class="line">filelists.xml.gz          100% |=========================| 1.6 MB    00:05</div><div class="line">filelists.xml.gz          100% |=========================| 138 kB    00:00</div><div class="line">-&gt; Finished Dependency Resolution</div><div class="line">……(省略)</div></pre></td></tr></table></figure>
<h3 id="实例2-移除-pam-devel"><a href="#实例2-移除-pam-devel" class="headerlink" title="实例2:移除 pam-devel"></a>实例2:移除 pam-devel</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># yum remove pam-devel</span></div><div class="line">Setting up Remove Process</div><div class="line">Resolving Dependencies  &lt;==同样的，先解决属性相依的问题</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package pam-devel.i386 0:0.99.6.2-4.el5 <span class="built_in">set</span> to be erased</div><div class="line">--&gt; Finished Dependency Resolution</div><div class="line"></div><div class="line">Dependencies Resolved</div><div class="line"></div><div class="line">=============================================================================</div><div class="line"> Package                 Arch       Version          Repository        Size</div><div class="line">=============================================================================</div><div class="line">Removing:</div><div class="line"> pam-devel               i386       0.99.6.2-4.el5   installed         495 k</div><div class="line"></div><div class="line">Transaction Summary</div><div class="line">=============================================================================</div><div class="line">Install      0 Package(s)</div><div class="line">Update       0 Package(s)</div><div class="line">Remove       1 Package(s)  &lt;==还好，并没有属性相依的问题，单纯移除一个软件</div><div class="line"></div><div class="line">Is this ok [y/N]: y</div><div class="line">Downloading Packages:</div><div class="line">Running rpm_check_debug</div><div class="line">Running Transaction Test</div><div class="line">Finished Transaction Test</div><div class="line">Transaction Test Succeeded</div><div class="line">Running Transaction</div><div class="line">  Erasing   : pam-devel                    <span class="comment">######################### [1/1]</span></div><div class="line"></div><div class="line">Removed: pam-devel.i386 0:0.99.6.2-4.el5</div><div class="line">Complete!</div></pre></td></tr></table></figure>
<h3 id="实例3-利用-yum-的功能，找出以-pam-为开头的软件名称有哪些？"><a href="#实例3-利用-yum-的功能，找出以-pam-为开头的软件名称有哪些？" class="headerlink" title="实例3:利用 yum 的功能，找出以 pam 为开头的软件名称有哪些？"></a>实例3:利用 yum 的功能，找出以 pam 为开头的软件名称有哪些？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@www ~]<span class="comment"># yum list pam*</span></div><div class="line">Installed Packages</div><div class="line">pam.i386                  0.99.6.2-3.27.el5      installed</div><div class="line">pam_ccreds.i386           3-5                    installed</div><div class="line">pam_krb5.i386             2.2.14-1               installed</div><div class="line">pam_passwdqc.i386         1.0.2-1.2.2            installed</div><div class="line">pam_pkcs11.i386           0.5.3-23               installed</div><div class="line">pam_smb.i386              1.1.7-7.2.1            installed</div><div class="line">Available Packages &lt;==底下则是『可升级』的或『未安装』的</div><div class="line">pam.i386                  0.99.6.2-4.el5         base</div><div class="line">pam-devel.i386            0.99.6.2-4.el5         base</div><div class="line">pam_krb5.i386             2.2.14-10              base</div></pre></td></tr></table></figure>
<h2 id="国内-yum-源"><a href="#国内-yum-源" class="headerlink" title="国内 yum 源"></a>国内 yum 源</h2><h3 id="阿里yum源安装"><a href="#阿里yum源安装" class="headerlink" title="阿里yum源安装"></a>阿里yum源安装</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;阿里云与yum源是国内最好的yum源之一。</p>
<h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</div></pre></td></tr></table></figure>
<h4 id="下载新的CentOS-Base-repo-到-etc-yum-repos-d"><a href="#下载新的CentOS-Base-repo-到-etc-yum-repos-d" class="headerlink" title="下载新的CentOS-Base.repo 到/etc/yum.repos.d/"></a>下载新的CentOS-Base.repo 到/etc/yum.repos.d/</h4><h5 id="CentOS-5"><a href="#CentOS-5" class="headerlink" title="CentOS 5"></a>CentOS 5</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo</div></pre></td></tr></table></figure>
<h5 id="CentOS-6"><a href="#CentOS-6" class="headerlink" title="CentOS 6"></a>CentOS 6</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</div></pre></td></tr></table></figure>
<h5 id="CentOS-7"><a href="#CentOS-7" class="headerlink" title="CentOS 7"></a>CentOS 7</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</div></pre></td></tr></table></figure>
<h3 id="之后运行yum-makecache生成缓存"><a href="#之后运行yum-makecache生成缓存" class="headerlink" title="之后运行yum makecache生成缓存"></a>之后运行yum makecache生成缓存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum clean all</div><div class="line">yum makecache</div></pre></td></tr></table></figure>
<h3 id="网易yum源安装"><a href="#网易yum源安装" class="headerlink" title="网易yum源安装"></a>网易yum源安装</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;网易（163）yum源是国内最好的yum源之一 ，无论是速度还是软件版本，都非常的不错。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;将yum源设置为163 yum，可以提升软件包安装和更新的速度，同时避免一些常见软件版本无法找到。</p>
<h4 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h4><h5 id="首先备份-etc-yum-repos-d-CentOS-Base-repo"><a href="#首先备份-etc-yum-repos-d-CentOS-Base-repo" class="headerlink" title="首先备份/etc/yum.repos.d/CentOS-Base.repo"></a>首先备份/etc/yum.repos.d/CentOS-Base.repo</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</div></pre></td></tr></table></figure>
<h5 id="下载对应版本repo文件-放入-etc-yum-repos-d-操作前请做好相应备份"><a href="#下载对应版本repo文件-放入-etc-yum-repos-d-操作前请做好相应备份" class="headerlink" title="下载对应版本repo文件, 放入/etc/yum.repos.d/(操作前请做好相应备份)"></a>下载对应版本repo文件, 放入/etc/yum.repos.d/(操作前请做好相应备份)</h5><ul>
<li>CentOS5 ：<a href="http://mirrors.163.com/.help/CentOS5-Base-163.repo" target="_blank" rel="external">http://mirrors.163.com/.help/CentOS5-Base-163.repo</a></li>
<li>CentOS6 ：<a href="http://mirrors.163.com/.help/CentOS6-Base-163.repo" target="_blank" rel="external">http://mirrors.163.com/.help/CentOS6-Base-163.repo</a></li>
</ul>
<h5 id="运行以下命令生成缓存"><a href="#运行以下命令生成缓存" class="headerlink" title="运行以下命令生成缓存"></a>运行以下命令生成缓存</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum clean all</div><div class="line">yum makecache</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;除了阿里和网易之外，国内还有其他不错的yum源，比如中科大和搜狐。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;中科大的yum源，安装方法查看：<a href="https://lug.ustc.edu.cn/wiki/mirrors/help/centos" target="_blank" rel="external">https://lug.ustc.edu.cn/wiki/mirrors/help/centos</a></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sohu的yum源安装方法查看: <a href="http://mirrors.sohu.com/help/centos.html" target="_blank" rel="external">http://mirrors.sohu.com/help/centos.html</a></p>
<h2 id="配置本地yum仓库"><a href="#配置本地yum仓库" class="headerlink" title="配置本地yum仓库"></a>配置本地yum仓库</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;实现此案例需要按照如下步骤进行。</p>
<h3 id="步骤一：搭建一个本地Yum，将RHEL6光盘手动挂载到-media"><a href="#步骤一：搭建一个本地Yum，将RHEL6光盘手动挂载到-media" class="headerlink" title="步骤一：搭建一个本地Yum，将RHEL6光盘手动挂载到/media"></a>步骤一：搭建一个本地Yum，将RHEL6光盘手动挂载到/media</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;命令操作如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># mount /dev/cdrom /media/</span></div><div class="line">mount: block device /dev/sr0 is write-protected, mounting <span class="built_in">read</span>-only</div><div class="line">[root@localhost ~]<span class="comment"># mount | tail -1</span></div><div class="line">/dev/sr0 on /media <span class="built_in">type</span> iso9660 (ro)</div></pre></td></tr></table></figure>
<h3 id="步骤二：将本地设置为客户端，进行Yum验证"><a href="#步骤二：将本地设置为客户端，进行Yum验证" class="headerlink" title="步骤二：将本地设置为客户端，进行Yum验证"></a>步骤二：将本地设置为客户端，进行Yum验证</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Yum客户端需编辑配置文件，命令操作如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /etc/yum.repos.d/         //必须在这个路径下</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># ls                  //此路径下事先有配置文件的模板</span></div><div class="line">rhel-source.repo</div><div class="line"></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># cp rhel-source.repo rhel6.repo //配置文件必须以.repo结尾</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># vim rhel6.repo</span></div><div class="line">[rhel-6]                                     //中括号里内容要求唯一，但不要出现特殊字符</div><div class="line">name=Red Hat Enterprise Linux 6           //此为描述信息，可以看情况填写</div><div class="line">baseurl=file:///media/                     //此项为yum软件仓库位置，指向光盘挂载点</div><div class="line">enabled=1                                   //此项为是否开启，1为开启0为不开启</div><div class="line">gpgcheck=1                                  //此项为是否检查签名，1为监测0为不检测</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release  //签名认证信息的路径</div><div class="line"></div><div class="line">[root@localhost /]<span class="comment"># yum repolist</span></div><div class="line">Loaded plugins: product-id, refresh-packagekit, security, subscription-manager</div><div class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</div><div class="line">rhel-6                                            | 3.9 kB     00:00 ... </div><div class="line">rhel-6/primary_db                                  | 3.1 MB     00:00 ... </div><div class="line">repo id             repo name                                     status</div><div class="line">rhel-6              Red Hat Enterprise Linux 6                    3,690</div><div class="line">repolist: 3,690</div></pre></td></tr></table></figure>
<h2 id="yum安装“epel”扩展源"><a href="#yum安装“epel”扩展源" class="headerlink" title="yum安装“epel”扩展源"></a>yum安装“epel”扩展源</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用yum安装rpm包时，经常遇到一些包没有，这时候你可以尝试安装epel的扩展源，这里有很多系统不自带的rpm包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum install -y epel-release</span></div><div class="line">[root@localhost ~]<span class="comment"># yum list</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;你会发现最右侧出现很多epel的rpm包。</p>
<h3 id="阿里云扩展源："><a href="#阿里云扩展源：" class="headerlink" title="阿里云扩展源："></a>阿里云扩展源：</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -P /etc/yum.repos.d/ http://mirrors.aliyun.com/repo/epel-6.repo</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以rpm安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://mirrors.zju.edu.cn/epel/6/x86_64/epel-release-6-8.noarch.rpm</div></pre></td></tr></table></figure>
<h2 id="Remi源"><a href="#Remi源" class="headerlink" title="Remi源"></a>Remi源</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;安装REMI仓库之前，需要启用EPEL仓库，因为REMI中的一些包依赖于EPEL仓库</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在CentOS 7上:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm --import http://rpms.famillecollet.com/RPM-GPG-KEY-remi</div><div class="line">rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在CentOS 6上:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm --import http://rpms.famillecollet.com/RPM-GPG-KEY-remi</div><div class="line">rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;默认地，REMI是禁用的。要检查REMI是否已经成功安装，使用这个命令。你会看到几个REMI仓库，比如remi、remi-php55和remi-php56。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum repolist disabled|grep remi</div></pre></td></tr></table></figure>
<h3 id="从REMI仓库中安装一个包"><a href="#从REMI仓库中安装一个包" class="headerlink" title="从REMI仓库中安装一个包"></a>从REMI仓库中安装一个包</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如上所述，最好保持禁用REMI仓库，只有在需要的时候再启用。<br>要搜索或安装REMI仓库中的包，使用这些命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum --enablerepo=remi search &lt;keyword&gt;</div><div class="line">yum --enablerepo=remi install &lt;package-name&gt;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<a href="http://rpms.famillecollet.com/" target="_blank" rel="external">Remi下载地址</a></p>
<ul>
<li>列出可用: yum repolist enabled</li>
<li>列出禁用: yum repolist disabled</li>
<li>列出所有(默认): yum repolist all</li>
<li>列出一个 repo 源(remi) 中可用的包 </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum --disablerepo=<span class="string">"*"</span> --enablerepo=<span class="string">"ksplice-uptrack"</span> list available</div></pre></td></tr></table></figure>
<h2 id="yum保留下载个rpm包"><a href="#yum保留下载个rpm包" class="headerlink" title="yum保留下载个rpm包"></a>yum保留下载个rpm包</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;可以设置使yum保留已经下载的rpm包，供以后升级或重新安装时使用。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改/etc/yum.conf即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[main]</div><div class="line">cachedir=/home/soft1/yumcache</div><div class="line">keepcache=1</div><div class="line">debuglevel=2</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;chchedir是放置下载的包的地方，可以修改为自己想放置的位置。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;keepcache为1时表示保存已经下载的rpm包。</p>
<h3 id="yum如何下载rpm包到本地"><a href="#yum如何下载rpm包到本地" class="headerlink" title="yum如何下载rpm包到本地"></a>yum如何下载rpm包到本地</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先要安装一个小插件，<code>yum-plugin-downloadonly.noarch</code> ，不知道包名用 <code>yum -list |grep download</code>搜索</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y yum-plugin-downloadonly.noarch</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后就可以下载了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install vte  --downloadonly --downloaddir=/tmp</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;下载vte到指定/tmp下</div><div class="line"></div><div class="line">&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;如果已安装过的包这个小插件默认是不能下载的,我们可以用 reinstall 下载，如下图例：</div><div class="line"></div><div class="line">![](https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-yum/01.png?raw=true)</div><div class="line"></div><div class="line">```bash</div><div class="line">yum reinstall vim --downloadonly --downloaddir=/tmp</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/linux%E5%91%BD%E4%BB%A4-yum/02.png?raw=true" alt=""></p>
<h2 id="yum配置"><a href="#yum配置" class="headerlink" title="yum配置"></a>yum配置</h2><h3 id="etc-yum-conf配置详解："><a href="#etc-yum-conf配置详解：" class="headerlink" title="/etc/yum.conf配置详解："></a>/etc/yum.conf配置详解：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">cachedir=/var/cache/yum         <span class="comment">#yum下载的RPM包的缓存目录</span></div><div class="line">keepcache=0              <span class="comment">#缓存是否保存，1保存，0不保存。</span></div><div class="line">debuglevel=2             <span class="comment">#调试级别(0-10)，默认为2(具体调试级别的应用，我也不了解)。</span></div><div class="line">logfile=/var/<span class="built_in">log</span>/yum.log         <span class="comment">#yum的日志文件所在的位置</span></div><div class="line">exactarch=1             <span class="comment">#在更新的时候，是否允许更新不同版本的RPM包，比如是否在i386上更新i686 </span></div><div class="line">                                   的RPM包。</div><div class="line">obsoletes=1            <span class="comment">#这是一个update的参数，具体请参阅yum(8)，简单的说就是相当于upgrade，                  允许更新陈旧的RPM包。</span></div><div class="line">gpgcheck=1            <span class="comment">#是否检查GPG(GNU Private Guard)，一种密钥方式签名。</span></div><div class="line">plugins=1                <span class="comment">#是否允许使用插件，默认是0不允许，但是我们一般会用yum-fastestmirror这</span></div><div class="line">                                  个插件。</div><div class="line">installonly_limit=3        <span class="comment">#允许保留多少个内核包。</span></div><div class="line">exclude=selinux*          <span class="comment">#屏蔽不想更新的RPM包，可用通配符，多个RPM包之间使用空格分离。</span></div><div class="line"></div><div class="line">/etc/yum.repos.d/ *.repo</div><div class="line">[fedora]      <span class="comment">#方括号里面的是软件源的名称，将被yum取得并识别</span></div><div class="line">name=Fedora <span class="variable">$releasever</span> - <span class="variable">$basearch</span>   <span class="comment">#这里也定义了软件 仓库的名称，通常是为了方便阅读配置文件，一般没什么作用，$releasever变量定义了发行版本，通常是8，9，10等数字，$basearch变 量定义了系统的架构，可以是i386、x86_64、ppc等值，这两个变量根据当前系统的版本架构不同而有不同的取值，这可以方便yum升级的时候选择 适合当前系统的软件包，以下同……</span></div><div class="line">failovermethod=priority   <span class="comment">#failovermethod 有两个值可以选择，priority是默认值，表示从列出的baseurl中顺序选择镜像服务器地址，roundrobin表示在列出的服务器中随机选择</span></div><div class="line">exclude=compiz* *compiz* fusion-icon* <span class="comment">#exclude这个选项是后来我自己加上去的，用来禁止这个软件仓库中的某些软件包的安装和更新，可以使用通配符，并以空格分隔，可以视情况需要自行添加</span></div><div class="line"><span class="comment">#baseurl=http://download.fedoraproject.org/pub/fedora/linux/releases/$releasever/Everything/$basearch/os/</span></div><div class="line"><span class="comment">#上面的一行baseurl第一个字符是'#'表示该行已经被注释，将不会被读取，这一行的意思是指定一个baseurl（源的镜像服务器地址）</span></div><div class="line"><span class="comment">#mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&amp;arch=$basearch</span></div><div class="line"><span class="comment">#上面的这一行是指定一个镜像服务器的地址列表，通常是开启的，本例中加了注释符号禁用了，我们可以试试，将$releasever和$basearch替换成自己对应的版本和架构，例如10和i386，在浏览器中打开，我们就能看到一长串镜可用的镜像服务器地址列表。</span></div><div class="line">选择自己访问速度较快的镜像服务器地址复制并粘贴到repo文件中，我们就能获得较快的更新速度了，格式如下baseurl所示：</div><div class="line">baseurl=</div><div class="line">ftp://ftp.sfc.wide.ad.jp/pub/Linux/Fedora/releases/10/Everything/i386/os</div><div class="line">http://ftp.chg.ru/pub/Linux/fedora/linux/releases/10/Everything/i386/os</div><div class="line">http://ftp.yz.yamagata-u.ac.jp/pub/linux/fedora/linux/releases/10/Everything/i386/os</div><div class="line">http://mirror.nus.edu.sg/fedora/releases/10/Everything/i386/os</div><div class="line">http://mirror.yandex.ru/fedora/linux/releases/10/Everything/i386/os</div><div class="line">http://ftp.twaren.net/Linux/Fedora/linux/releases/10/Everything/i386/os</div><div class="line">http://ftp.itu.edu.tr/Mirror/Fedora/linux/releases/10/Everything/i386/os</div><div class="line">enabled=1 <span class="comment">#这个选项表示这个repo中定义的源是启用的，0为禁用</span></div><div class="line">gpgcheck=1 <span class="comment">#这个选项表示这个repo中下载的rpm将进行gpg的校验，已确定rpm包的来源是有效和安全的</span></div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-fedora-<span class="variable">$basearch</span> <span class="comment">#定义用于校验的gpg密钥</span></div></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/43. Linux 命令- ps" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/43. Linux 命令- ps/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.252Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/43. Linux 命令- ps/">
        Linux 命令- ps
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Linux中的ps命令是Process Status的缩写。ps命令用来列出系统中当前运行的那些进程。ps命令列出的是当前那些进程的快照，就是执行ps命令的那个时刻的那些进程，如果想要动态的显示进程信息，就可以使用top命令。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;要对进程进行监测和控制，首先必须要了解当前进程的情况，也就是需要查看当前进程，而 ps 命令就是最基本同时也是非常强大的进程查看命令。使用该命令可以确定有哪些进程正在运行和运行的状态、进程是否结束、进程有没有僵死、哪些进程占用了过多的资源等等。总之大部分信息都是可以通过执行该命令得到的。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ps 为我们提供了进程的一次性的查看，它所提供的查看结果并不动态连续的；如果想对进程时间监控，应该用 top 工具。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kill 命令用于杀死进程。</p>
<ul>
<li><p><strong>inux上进程有5种状态:</strong> </p>
<ul>
<li>运行(正在运行或在运行队列中等待) </li>
<li>中断(休眠中, 受阻, 在等待某个条件的形成或接受到信号) </li>
<li>不可中断(收到信号不唤醒和不可运行, 进程必须等待直到有中断发生) </li>
<li>僵死(进程已终止, 但进程描述符存在, 直到父进程调用wait4()系统调用后释放) </li>
<li>停止(进程收到SIGSTOP, SIGSTP, SIGTIN, SIGTOU信号后停止运行运行) </li>
</ul>
</li>
<li><p><strong>ps工具标识进程的5种状态码:</strong> </p>
<ul>
<li>D 不可中断 uninterruptible sleep (usually IO) </li>
<li>R 运行 runnable (on run queue) </li>
<li>S 中断 sleeping </li>
<li>T 停止 traced or stopped </li>
<li>Z 僵死 a defunct (”zombie”) process </li>
</ul>
</li>
</ul>
<h2 id="1．命令格式"><a href="#1．命令格式" class="headerlink" title="1．命令格式"></a>1．命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps[参数]</div></pre></td></tr></table></figure>
<h2 id="2．命令功能"><a href="#2．命令功能" class="headerlink" title="2．命令功能"></a>2．命令功能</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;用来显示当前进程的状态</p>
<h2 id="3．命令参数"><a href="#3．命令参数" class="headerlink" title="3．命令参数"></a>3．命令参数</h2><ul>
<li>a  显示所有进程</li>
<li>-a 显示同一终端下的所有程序</li>
<li>-A 显示所有进程</li>
<li>c  显示进程的真实名称</li>
<li>-N 反向选择</li>
<li>-e 等于“-A”</li>
<li>e  显示环境变量</li>
<li>f  显示程序间的关系</li>
<li>-H 显示树状结构</li>
<li>r  显示当前终端的进程</li>
<li>T  显示当前终端的所有程序</li>
<li>u  指定用户的所有进程</li>
<li>-au 显示较详细的资讯</li>
<li>-aux 显示所有包含其他使用者的行程 </li>
<li>-C&lt;命令&gt; 列出指定命令的状况</li>
<li>–lines&lt;行数&gt; 每页显示的行数</li>
<li>–width&lt;字符数&gt; 每页显示的字符数</li>
<li>–help 显示帮助信息</li>
<li>–version 显示版本显示</li>
</ul>
<h2 id="4．使用实例"><a href="#4．使用实例" class="headerlink" title="4．使用实例"></a>4．使用实例</h2><h3 id="实例1：显示所有进程信息"><a href="#实例1：显示所有进程信息" class="headerlink" title="实例1：显示所有进程信息"></a>实例1：显示所有进程信息</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -A</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps -A</span></div><div class="line">  PID TTY          TIME CMD</div><div class="line">    1 ?        00:00:00 init</div><div class="line">    2 ?        00:00:01 migration/0</div><div class="line">    3 ?        00:00:00 ksoftirqd/0</div><div class="line">    4 ?        00:00:01 migration/1</div><div class="line">    5 ?        00:00:00 ksoftirqd/1</div><div class="line">    6 ?        00:29:57 events/0</div><div class="line">    7 ?        00:00:00 events/1</div><div class="line">    8 ?        00:00:00 khelper</div><div class="line">   49 ?        00:00:00 kthread</div><div class="line">   54 ?        00:00:00 kblockd/0</div><div class="line">   55 ?        00:00:00 kblockd/1</div><div class="line">   56 ?        00:00:00 kacpid</div><div class="line">  217 ?        00:00:00 cqueue/0</div><div class="line">  ……省略部分结果</div></pre></td></tr></table></figure>
<h3 id="实例2：显示指定用户信息"><a href="#实例2：显示指定用户信息" class="headerlink" title="实例2：显示指定用户信息"></a>实例2：显示指定用户信息</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -u root</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps -u root</span></div><div class="line">  PID TTY          TIME CMD</div><div class="line">    1 ?        00:00:00 init</div><div class="line">    2 ?        00:00:01 migration/0</div><div class="line">    3 ?        00:00:00 ksoftirqd/0</div><div class="line">    4 ?        00:00:01 migration/1</div><div class="line">    5 ?        00:00:00 ksoftirqd/1</div><div class="line">    6 ?        00:29:57 events/0</div><div class="line">    7 ?        00:00:00 events/1</div><div class="line">    8 ?        00:00:00 khelper</div><div class="line">   49 ?        00:00:00 kthread</div><div class="line">   54 ?        00:00:00 kblockd/0</div><div class="line">   55 ?        00:00:00 kblockd/1</div><div class="line">   56 ?        00:00:00 kacpid</div><div class="line">    ……省略部分结果</div></pre></td></tr></table></figure>
<h3 id="实例3：显示所有进程信息，连同命令行"><a href="#实例3：显示所有进程信息，连同命令行" class="headerlink" title="实例3：显示所有进程信息，连同命令行"></a>实例3：显示所有进程信息，连同命令行</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -ef</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps -ef</span></div><div class="line">UID        PID  PPID  C STIME TTY          TIME CMD</div><div class="line">root         1     0  0 Nov02 ?        00:00:00 init [3]                  </div><div class="line">root         2     1  0 Nov02 ?        00:00:01 [migration/0]</div><div class="line">root         3     1  0 Nov02 ?        00:00:00 [ksoftirqd/0]</div><div class="line">root         4     1  0 Nov02 ?        00:00:01 [migration/1]</div><div class="line">root         5     1  0 Nov02 ?        00:00:00 [ksoftirqd/1]</div><div class="line">root         6     1  0 Nov02 ?        00:29:57 [events/0]</div><div class="line">root         7     1  0 Nov02 ?        00:00:00 [events/1]</div><div class="line">root         8     1  0 Nov02 ?        00:00:00 [khelper]</div><div class="line">root        49     1  0 Nov02 ?        00:00:00 [kthread]</div><div class="line">root        54    49  0 Nov02 ?        00:00:00 [kblockd/0]</div><div class="line">root        55    49  0 Nov02 ?        00:00:00 [kblockd/1]</div><div class="line">root        56    49  0 Nov02 ?        00:00:00 [kacpid]</div><div class="line">……省略部分结果</div></pre></td></tr></table></figure>
<h3 id="实例4：-ps-与grep-常用组合用法，查找特定进程"><a href="#实例4：-ps-与grep-常用组合用法，查找特定进程" class="headerlink" title="实例4： ps 与grep 常用组合用法，查找特定进程"></a>实例4： ps 与grep 常用组合用法，查找特定进程</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -ef|grep ssh</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps -ef|grep ssh</span></div><div class="line">root      2720     1  0 Nov02 ?        00:00:00 /usr/sbin/sshd</div><div class="line">root     17394  2720  0 14:58 ?        00:00:00 sshd: root@pts/0 </div><div class="line">root     17465 17398  0 15:57 pts/0    00:00:00 grep ssh</div></pre></td></tr></table></figure>
<h3 id="实例5：将目前属于您自己这次登入的-PID-与相关信息列示出来"><a href="#实例5：将目前属于您自己这次登入的-PID-与相关信息列示出来" class="headerlink" title="实例5：将目前属于您自己这次登入的 PID 与相关信息列示出来"></a>实例5：将目前属于您自己这次登入的 PID 与相关信息列示出来</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -l</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps -l</span></div><div class="line">F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD</div><div class="line">4 S     0 17398 17394  0  75   0 - 16543 <span class="built_in">wait</span>   pts/0    00:00:00 bash</div><div class="line">4 R     0 17469 17398  0  77   0 - 15877 -      pts/0    00:00:00 ps</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong> </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;各相关信息的意义：</p>
<ul>
<li><p>F 代表这个程序的旗标 (flag)， 4 代表使用者为 super user</p>
</li>
<li><p>S 代表这个程序的状态 (STAT)，关于各 STAT 的意义将在内文介绍</p>
</li>
<li><p>UID 程序被该 UID 所拥有</p>
</li>
<li><p>PID 就是这个程序的 ID ！</p>
</li>
<li><p>PPID 则是其上级父程序的ID</p>
</li>
<li><p>C CPU 使用的资源百分比</p>
</li>
<li><p>PRI 这个是 Priority (优先执行序) 的缩写</p>
</li>
<li><p>NI 这个是 Nice 值，在下一小节我们会持续介绍</p>
</li>
<li><p>ADDR 这个是 kernel function，指出该程序在内存的那个部分。如果是个 running的程序，一般就是 “-“</p>
</li>
<li><p>SZ 使用掉的内存大小</p>
</li>
<li><p>WCHAN 目前这个程序是否正在运作当中，若为 - 表示正在运作</p>
</li>
<li><p>TTY 登入者的终端机位置</p>
</li>
<li><p>TIME 使用掉的 CPU 时间。</p>
</li>
<li><p>CMD 所下达的指令为何</p>
</li>
<li><p>在预设的情况下， ps 仅会列出与目前所在的 bash shell 有关的 PID 而已，所以， 当我使用 ps -l 的时候，只有三个 PID。</p>
</li>
</ul>
<h3 id="实例6：列出目前所有的正在内存当中的程序"><a href="#实例6：列出目前所有的正在内存当中的程序" class="headerlink" title="实例6：列出目前所有的正在内存当中的程序"></a>实例6：列出目前所有的正在内存当中的程序</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps aux</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps aux</span></div><div class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</div><div class="line">root         1  0.0  0.0  10368   676 ?        Ss   Nov02   0:00 init [3]                  </div><div class="line">root         2  0.0  0.0      0     0 ?        S&lt;   Nov02   0:01 [migration/0]</div><div class="line">root         3  0.0  0.0      0     0 ?        SN   Nov02   0:00 [ksoftirqd/0]</div><div class="line">root         4  0.0  0.0      0     0 ?        S&lt;   Nov02   0:01 [migration/1]</div><div class="line">root         5  0.0  0.0      0     0 ?        SN   Nov02   0:00 [ksoftirqd/1]</div><div class="line">root         6  0.0  0.0      0     0 ?        S&lt;   Nov02  29:57 [events/0]</div><div class="line">root         7  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [events/1]</div><div class="line">root         8  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [khelper]</div><div class="line">root        49  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kthread]</div><div class="line">root        54  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kblockd/0]</div><div class="line">root        55  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kblockd/1]</div><div class="line">root        56  0.0  0.0      0     0 ?        S&lt;   Nov02   0:00 [kacpid]</div><div class="line">……省略部分结果</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<ul>
<li><p>USER：该 process 属于那个使用者账号的</p>
</li>
<li><p>PID ：该 process 的号码</p>
</li>
<li><p>%CPU：该 process 使用掉的 CPU 资源百分比</p>
</li>
<li><p>%MEM：该 process 所占用的物理内存百分比</p>
</li>
<li><p>VSZ ：该 process 使用掉的虚拟内存量 (Kbytes)</p>
</li>
<li><p>RSS ：该 process 占用的固定的内存量 (Kbytes)</p>
</li>
<li><p>TTY ：该 process 是在那个终端机上面运作，若与终端机无关，则显示 ?，另外， tty1-tty6 是本机上面的登入者程序，若为 pts/0 等等的，则表示为由网络连接进主机的程序。</p>
</li>
<li><p>STAT：该程序目前的状态，主要的状态有</p>
</li>
<li><p>R ：该程序目前正在运作，或者是可被运作</p>
</li>
<li><p>S ：该程序目前正在睡眠当中 (可说是 idle 状态)，但可被某些讯号 (signal) 唤醒。</p>
</li>
<li><p>T ：该程序目前正在侦测或者是停止了</p>
</li>
<li><p>Z ：该程序应该已经终止，但是其父程序却无法正常的终止他，造成 zombie (疆尸) 程序的状态</p>
</li>
<li><p>START：该 process 被触发启动的时间</p>
</li>
<li><p>TIME ：该 process 实际使用 CPU 运作的时间</p>
</li>
<li><p>COMMAND：该程序的实际指令</p>
</li>
</ul>
<h3 id="实例7：列出类似程序树的程序显示"><a href="#实例7：列出类似程序树的程序显示" class="headerlink" title="实例7：列出类似程序树的程序显示"></a>实例7：列出类似程序树的程序显示</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -axjf</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>*输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps -axjf</span></div><div class="line">Warning: bad syntax, perhaps a bogus <span class="string">'-'</span>? See /usr/share/doc/procps-3.2.7/FAQ</div><div class="line"> PPID   PID  PGID   SID TTY      TPGID STAT   UID   TIME COMMAND</div><div class="line">    0     1     1     1 ?           -1 Ss       0   0:00 init [3]                  </div><div class="line">    1     2     1     1 ?           -1 S&lt;       0   0:01 [migration/0]</div><div class="line">    1     3     1     1 ?           -1 SN       0   0:00 [ksoftirqd/0]</div><div class="line">    1     4     1     1 ?           -1 S&lt;       0   0:01 [migration/1]</div><div class="line">    1     5     1     1 ?           -1 SN       0   0:00 [ksoftirqd/1]</div><div class="line">    1     6     1     1 ?           -1 S&lt;       0  29:58 [events/0]</div><div class="line">    1     7     1     1 ?           -1 S&lt;       0   0:00 [events/1]</div><div class="line">    1     8     1     1 ?           -1 S&lt;       0   0:00 [khelper]</div><div class="line">    1    49     1     1 ?           -1 S&lt;       0   0:00 [kthread]</div><div class="line">   49    54     1     1 ?           -1 S&lt;       0   0:00  \_ [kblockd/0]</div><div class="line">   49    55     1     1 ?           -1 S&lt;       0   0:00  \_ [kblockd/1]</div><div class="line">   49    56     1     1 ?           -1 S&lt;       0   0:00  \_ [kacpid]</div></pre></td></tr></table></figure>
<h3 id="实例8：找出与-cron-与-syslog-这两个服务有关的-PID-号码"><a href="#实例8：找出与-cron-与-syslog-这两个服务有关的-PID-号码" class="headerlink" title="实例8：找出与 cron 与 syslog 这两个服务有关的 PID 号码"></a>实例8：找出与 cron 与 syslog 这两个服务有关的 PID 号码</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pa aux|egrep <span class="string">'(cron|syslog)'</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps aux | egrep '(cron|syslog)'</span></div><div class="line">root      2682  0.0  0.0  83384  2000 ?        Sl   Nov02   0:00 /sbin/rsyslogd -i /var/run/syslogd.pid -c 5</div><div class="line">root      2735  0.0  0.0  74812  1140 ?        Ss   Nov02   0:00 crond</div><div class="line">root     17475  0.0  0.0  61180   832 pts/0    S+   16:27   0:00 egrep (cron|syslog)</div><div class="line">[root@localhost test6]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h3 id="其他实例："><a href="#其他实例：" class="headerlink" title="其他实例："></a>其他实例：</h3><h4 id="1-可以用-管道和-more-连接起来分页查看"><a href="#1-可以用-管道和-more-连接起来分页查看" class="headerlink" title="1. 可以用 | 管道和 more 连接起来分页查看"></a>1. 可以用 | 管道和 more 连接起来分页查看</h4><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -aux |more</div></pre></td></tr></table></figure>
<h4 id="2-把所有进程显示出来，并输出到ps001-txt文件"><a href="#2-把所有进程显示出来，并输出到ps001-txt文件" class="headerlink" title="2. 把所有进程显示出来，并输出到ps001.txt文件"></a>2. 把所有进程显示出来，并输出到ps001.txt文件</h4><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -aux &gt; ps001.txt</div></pre></td></tr></table></figure>
<h4 id="3-输出指定的字段"><a href="#3-输出指定的字段" class="headerlink" title="3. 输出指定的字段"></a>3. 输出指定的字段</h4><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps -o pid,ppid,pgrp,session,tpgid,comm</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost test6]<span class="comment"># ps -o pid,ppid,pgrp,session,tpgid,comm</span></div><div class="line">  PID  PPID  PGRP  SESS TPGID COMMAND</div><div class="line">17398 17394 17398 17398 17478 bash</div><div class="line">17478 17398 17478 17398 17478 ps</div><div class="line">[root@localhost test6]<span class="comment">#</span></div></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/85. Linux 命令- rsync" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/85. Linux 命令- rsync/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.251Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/85. Linux 命令- rsync/">
        Linux 命令- rsync
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rsync从字面上的意思可以理解为remote sync （远程同步）这样可以理解的更深刻一些。Rsync不仅可以远程同步数据（类似于scp），当然还可以本地同步数据（类似于cp），但不同于cp或scp的一点是，rsync不像cp/scp一样会覆盖以前的数据（如果数据已经存在），它会先判断已经存在的数据和新数据有什么不同，只有不同时才会把不同的部分覆盖掉。如果Linux没有rsync命令使用yum安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y rsync</div></pre></td></tr></table></figure>
<h2 id="命令语法"><a href="#命令语法" class="headerlink" title="命令语法"></a>命令语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">rsync [OPTION]... SRC DEST </div><div class="line">rsync [OPTION]... SRC [USER@]host:DEST </div><div class="line">rsync [OPTION]... [USER@]HOST:SRC DEST </div><div class="line">rsync [OPTION]... [USER@]HOST::SRC DEST </div><div class="line">rsync [OPTION]... SRC [USER@]HOST::DEST </div><div class="line">rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST]</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;对应以上六种命令格式，rsync有六种不同的工作模式：</p>
<ol>
<li>拷贝本地文件。当SRC和DES路径信息都不包含有单个冒号 <code>:</code> 分隔符时就启动这种工作模式。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -a /data/backup</div></pre></td></tr></table></figure>
<ol>
<li>使用一个远程shell程序（如rsh、ssh）来实现将本地机器的内容拷贝到远程机器。当DST路径地址包含单个冒号 <code>:</code> 分隔符时启动该模式。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -avz *.c foo:src</div></pre></td></tr></table></figure>
<ol>
<li>使用一个远程shell程序（如rsh、ssh）来实现将远程机器的内容拷贝到本地机器。当SRC地址路径包含单个冒号 <code>:</code>  分隔符时启动该模式。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -avz foo:src/bar /data</div></pre></td></tr></table></figure>
<ol>
<li>从远程rsync服务器中拷贝文件到本地。当SRC路径信息包含“::”分隔符时启动该模式。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -av root@192.168.78.192::www /databack</div></pre></td></tr></table></figure>
<ol>
<li>从本地机器拷贝文件到远程rsync服务器中。当DST路径信息包含“::”分隔符十启动该模式。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -av /databack root@192.168.78.192::www</div></pre></td></tr></table></figure>
<ol>
<li>列远程机的文件列表。类似于rsync传输，不过主要在命令中省略掉本机信息即可</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -v rsync://192.168.78.192/www</div></pre></td></tr></table></figure>
<h2 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h2><ul>
<li>-v, –verbose 详细模式输出。 </li>
<li>-q, –quiet 精简输出模式。 </li>
<li>-c, –checksum 打开校验开关，强制对文件传输进行校验。 </li>
<li>-a, –archive 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD。 </li>
<li>-r, –recursive 对子目录以递归模式处理。 </li>
<li>-R, –relative 使用相对路径信息。 </li>
<li>-b, –backup 创建备份，也就是对于目的已经存在有同样的文件名时，将老的文件重新命名为~filename。可以使用–suffix选项来指定不同的备份文件前缀。 </li>
<li>–backup-dir 将备份文件(如~filename)存放在在目录下。 </li>
<li>-suffix=SUFFIX 定义备份文件前缀。 </li>
<li>-u, –update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件，不覆盖更新的文件。 </li>
<li>-l, –links 保留软链结。 </li>
<li>-L, –copy-links 想对待常规文件一样处理软链结。 </li>
<li>–copy-unsafe-links 仅仅拷贝指向SRC路径目录树以外的链结。 </li>
<li>–safe-links 忽略指向SRC路径目录树以外的链结。 </li>
<li>-H, –hard-links 保留硬链结。 </li>
<li>-p, –perms 保持文件权限。 </li>
<li>-o, –owner 保持文件属主信息。 </li>
<li>-g, –group 保持文件属组信息。 </li>
<li>-D, –devices 保持设备文件信息。 </li>
<li>-t, –times 保持文件时间信息。 </li>
<li>-S, –sparse 对稀疏文件进行特殊处理以节省DST的空间。 </li>
<li>-n, –dry-run现实哪些文件将被传输。 </li>
<li>-w, –whole-file 拷贝文件，不进行增量检测。 </li>
<li>-x, –one-file-system 不要跨越文件系统边界。 </li>
<li>-B, –block-size=SIZE 检验算法使用的块尺寸，默认是700字节。 </li>
<li>-e, –rsh=command 指定使用rsh、ssh方式进行数据同步。 </li>
<li>–rsync-path=PATH 指定远程服务器上的rsync命令所在路径信息。 </li>
<li>-C, –cvs-exclude 使用和CVS一样的方法自动忽略文件，用来排除那些不希望传输的文件。 </li>
<li>–existing 仅仅更新那些已经存在于DST的文件，而不备份那些新创建的文件。 </li>
<li>–delete 删除那些DST中SRC没有的文件。 </li>
<li>–delete-excluded 同样删除接收端那些被该选项指定排除的文件。 </li>
<li>–delete-after 传输结束以后再删除。 </li>
<li>–ignore-errors 及时出现IO错误也进行删除。 </li>
<li>–max-delete=NUM 最多删除NUM个文件。 -</li>
<li>-partial 保留那些因故没有完全传输的文件，以是加快随后的再次传输。 </li>
<li>–force 强制删除目录，即使不为空。 </li>
<li>–numeric-ids 不将数字的用户和组id匹配为用户名和组名。 </li>
<li>–timeout=time ip超时时间，单位为秒。 </li>
<li>-I, –ignore-times 不跳过那些有同样的时间和长度的文件。 </li>
<li>–size-only 当决定是否要备份文件时，仅仅察看文件大小而不考虑文件时间。 </li>
<li>–modify-window=NUM 决定文件是否时间相同时使用的时间戳窗口，默认为0。 </li>
<li>-T –temp-dir=DIR 在DIR中创建临时文件。 </li>
<li>–compare-dest=DIR 同样比较DIR中的文件来决定是否需要备份。 </li>
<li>-P 等同于 –partial。 </li>
<li>–progress 显示备份过程。 </li>
<li>-z, –compress 对备份的文件在传输时进行压缩处理。 </li>
<li>–exclude=PATTERN 指定排除不需要传输的文件模式。 </li>
<li>–include=PATTERN 指定不排除而需要传输的文件模式。 </li>
<li>–exclude-from=FILE 排除FILE中指定模式的文件。 </li>
<li>–include-from=FILE 不排除FILE指定模式匹配的文件。 </li>
<li>–version 打印版本信息。 </li>
<li>–address 绑定到特定的地址。 </li>
<li>–config=FILE 指定其他的配置文件，不使用默认的rsyncd.conf文件。 </li>
<li>–port=PORT 指定其他的rsync服务端口。 </li>
<li>–blocking-io 对远程shell使用阻塞IO。 </li>
<li>-stats 给出某些文件的传输状态。 </li>
<li>–progress 在传输时现实传输过程。 </li>
<li>–log-format=formAT 指定日志文件格式。 </li>
<li>–password-file=FILE 从FILE中得到密码。 </li>
<li>–bwlimit=KBPS 限制I/O带宽，KBytes per second。 </li>
<li>-h, –help 显示帮助信息。</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;常用选项：-a、-v、–delete、–exclude</p>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;试验准备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># mkdir rsync</span></div><div class="line">[root@localhost ~]<span class="comment"># cd rsync</span></div><div class="line">[root@localhost rsync]<span class="comment"># mkdir test1</span></div><div class="line">[root@localhost rsync]<span class="comment"># cd test1</span></div><div class="line">[root@localhost test1]<span class="comment"># touch 1 2 3</span></div><div class="line">[root@localhost test1]<span class="comment"># ln -s /root/123.txt ./123.txt</span></div><div class="line">[root@localhost test1]<span class="comment"># ls -l</span></div><div class="line">总用量 0</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 1</div><div class="line">lrwxrwxrwx 1 root root 13 6月 10 12:59 123.txt -&gt; /root/123.txt</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 2</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 3</div><div class="line">[root@localhost test1]<span class="comment"># cd ..</span></div></pre></td></tr></table></figure>
<h3 id="实例1：使用-a选项"><a href="#实例1：使用-a选项" class="headerlink" title="实例1：使用-a选项"></a>实例1：使用-a选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rsync -a test1 test2</span></div><div class="line">[root@localhost rsync]<span class="comment"># ls test2</span></div><div class="line">test1</div><div class="line">[root@localhost rsync]<span class="comment"># ls test2/test1/</span></div><div class="line">1 123.txt 2 3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这里有一个问题，就是本来想把test1目录直接拷贝成test2目录，可结果rsync却新建了test2目录，然后把test1目录放到了test2目录中。为了避免这样的情况，可以这样做：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rm -rf test2</span></div><div class="line">[root@localhost rsync]<span class="comment"># rsync -a test1/ test2/</span></div><div class="line">[root@localhost rsync]<span class="comment"># ls -l test2/</span></div><div class="line">总用量 0</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 1</div><div class="line">lrwxrwxrwx 1 root root 13 6月 10 12:59 123.txt -&gt; /root/123.txt</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 2</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;加个斜杠就可以了，所以建议在使用rsync备份目录时要养成加斜杠的习惯。-a选项表示以递归方式传输文件，并保持所有属性，等同于-rlptgoD。-a选项后面可以跟一个 <code>--no-OPTION</code> 这个表示关闭 -rlptgoD中的某一个，例如，<code>-a--no-l</code> 等同于 -rptgoD。下面看一看-l选项的作用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rsync -av --no-l test1/ test2/</span></div><div class="line">sending incremental file list</div><div class="line">created directory test2</div><div class="line">./</div><div class="line">1</div><div class="line">skipping non-regular file <span class="string">"123.txt"</span></div><div class="line">2</div><div class="line">3</div><div class="line"></div><div class="line">sent 200 bytes received 72 bytes 544.00 bytes/sec</div><div class="line">total size is 13 speedup is 0.05</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用-v选项看起来方便，上例跳过了非普通文件123.txt，其实123.txt是一个软连接文件，如果不使用-l选项则不理会软连接文件的。虽然加上-l选项会把软连接文件给拷贝过去，但是软连接的目标文件却没有拷贝过去。</p>
<h3 id="实例2：使用-L选项"><a href="#实例2：使用-L选项" class="headerlink" title="实例2：使用-L选项"></a>实例2：使用-L选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rsync -avL test1/ test2/</span></div><div class="line">sending incremental file list</div><div class="line">created directory test2</div><div class="line">./</div><div class="line">1</div><div class="line">123.txt</div><div class="line">2</div><div class="line">3</div><div class="line"></div><div class="line">sent 231 bytes received 91 bytes 644.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div><div class="line">[root@localhost rsync]<span class="comment"># ls -l test2/</span></div><div class="line">总用量 0</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 1</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:39 123.txt</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 2</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;加上-L选项就可以把SRC中软连接的目标文件给拷贝到DST。</p>
<h3 id="实例3：使用-u选项"><a href="#实例3：使用-u选项" class="headerlink" title="实例3：使用-u选项"></a>实例3：使用-u选项</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先查看一下test1/1和test2/1的创建时间（肯定是一样的），然后使用touch修改一下test2/1的创建时间（此时test2/1要比test1/1的创建时间晚了一些），如果不加-u选项的话，会把test2/1的创建时间编程和test1/1的创建时间一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># ll test1/1 test2/1</span></div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 test1/1</div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 test2/1</div><div class="line">root@localhost rsync]<span class="comment"># touch test2/1</span></div><div class="line">[root@localhost rsync]<span class="comment"># ll test2/1</span></div><div class="line">-rw-r--r-- 1 root root 0 6月 10 13:20 test2/1</div><div class="line">[root@localhost rsync]<span class="comment"># rsync -a test1/1 test2/</span></div><div class="line">[root@localhost rsync]<span class="comment"># ll test2/1</span></div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 test2/1</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;加上-u选项后，不会再把test1/1同步为test2/1了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># touch test2/1</span></div><div class="line">[root@localhost rsync]<span class="comment"># ll test2/1</span></div><div class="line">-rw-r--r-- 1 root root 0 6月 10 13:31 test2/1</div><div class="line">[root@localhost rsync]<span class="comment"># rsync -avu test1/ test2/</span></div><div class="line">sending incremental file list</div><div class="line">./</div><div class="line">123.txt -&gt; /root/123.txt</div><div class="line"></div><div class="line">sent 100 bytes received 18 bytes 236.00 bytes/sec</div><div class="line">total size is 13 speedup is 0.11</div><div class="line">[root@localhost rsync]<span class="comment"># ll test2/1</span></div><div class="line">-rw-r--r-- 1 root root 0 6月 10 13:31 test2/1</div><div class="line">[root@localhost rsync]<span class="comment"># ll test1/1</span></div><div class="line">-rw-r--r-- 1 root root 0 6月 10 12:58 test1/1</div></pre></td></tr></table></figure>
<h3 id="实例4：使用-–delete选项"><a href="#实例4：使用-–delete选项" class="headerlink" title="实例4：使用 –delete选项"></a>实例4：使用 –delete选项</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先删除test1/123.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rm -f test1/123.txt</span></div><div class="line">[root@localhost rsync]<span class="comment"># ls test1/</span></div><div class="line">1 2 3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后把test1/目录同步到test2/目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rsync -av test1/ test2/</span></div><div class="line">sending incremental file list</div><div class="line">./</div><div class="line">1</div><div class="line"></div><div class="line">sent 94 bytes received 34 bytes 256.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div><div class="line">[root@localhost rsync]<span class="comment"># ls test2/</span></div><div class="line">1 123.txt 2 3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;test2/目录并没有删除掉123.txt，下面加上 <code>--delete</code> 选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rsync -av --delete test1/ test2/</span></div><div class="line">sending incremental file list</div><div class="line">deleting 123.txt</div><div class="line"></div><div class="line">sent 52 bytes received 12 bytes 128.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div><div class="line">[root@localhost rsync]<span class="comment"># ls test2/</span></div><div class="line">1 2 3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;test2/目录里的123.txt也被删除了，这就是 <code>--delete</code> 选项的用处。还有一种情况就是如果在DST增加了文件了，而SRC当中没有这些文件，同步时加上 <code>--delete</code> 选项后同样会删除新增的文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># touch test2/4</span></div><div class="line">[root@localhost rsync]<span class="comment"># ls test1/</span></div><div class="line">1 2 3</div><div class="line">[root@localhost rsync]<span class="comment"># ls test2/</span></div><div class="line">1 2 3 4</div><div class="line">[root@localhost rsync]<span class="comment"># rsync -a --delete test1/ test2/</span></div><div class="line">[root@localhost rsync]<span class="comment"># ls test1/</span></div><div class="line">1 2 3</div><div class="line">[root@localhost rsync]<span class="comment"># ls test2/</span></div><div class="line">1 2 3</div></pre></td></tr></table></figure>
<h3 id="实例5：使用-–exclude选项"><a href="#实例5：使用-–exclude选项" class="headerlink" title="实例5：使用 –exclude选项"></a>实例5：使用 –exclude选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[[root@localhost rsync]<span class="comment"># touch test1/4</span></div><div class="line">[root@localhost rsync]<span class="comment"># rsync -a --exclude="4" test1/ test2/</span></div><div class="line">[root@localhost rsync]<span class="comment"># ls test1/</span></div><div class="line">1 2 3 4</div><div class="line">[root@localhost rsync]<span class="comment"># ls test2/</span></div><div class="line">1 2 3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;另外还可以使用匹配字符 *</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># touch test1/1.txt test1/2.txt</span></div><div class="line">[root@localhost rsync]<span class="comment"># ls test1/</span></div><div class="line">1 1.txt 2 2.txt 3 4</div><div class="line">[root@localhost rsync]<span class="comment"># rsync -a --progress --exclude="*.txt" test1/ test2/</span></div><div class="line">sending incremental file list</div><div class="line">./</div><div class="line">4</div><div class="line">0 100% 0.00kB/s 0:00:00 (xfer<span class="comment">#1, to-check=0/5)</span></div><div class="line"></div><div class="line">sent 104 bytes received 34 bytes 276.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div><div class="line">[root@localhost rsync]<span class="comment"># ls test2/</span></div><div class="line">1 2 3 4</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;上例中，连带着使用了 <code>--progress</code> 选项，这个主要是用来观察rsync同步过程的状态的。简单总结一下，平时使用rsync同步数据的时候，使用-a选项基本上就可以达到想要的效果了，只是有时候会有个别的需求，会用到 <code>-a --no-OPTION</code> , <code>-u</code> , <code>-L</code> , <code>--delete</code> , <code>--exclude</code> 以及 <code>--progress</code> 这些选项。</p>
<h3 id="实例6：ssh隧道方式"><a href="#实例6：ssh隧道方式" class="headerlink" title="实例6：ssh隧道方式"></a>实例6：ssh隧道方式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">root@localhost rsync]<span class="comment"># rsync -avL test1/ www@192.168.0.101:/tmp/test2/</span></div><div class="line">www@192.168.0.101<span class="string">'s password:</span></div><div class="line"><span class="string">sending incremental file list</span></div><div class="line"><span class="string">created directory /tmp/test2</span></div><div class="line"><span class="string">./</span></div><div class="line"><span class="string">1</span></div><div class="line"><span class="string">1.txt</span></div><div class="line"><span class="string">2</span></div><div class="line"><span class="string">2.txt</span></div><div class="line"><span class="string">3</span></div><div class="line"><span class="string">4</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">sent 327 bytes received 129 bytes 182.40 bytes/sec</span></div><div class="line"><span class="string">total size is 0 speedup is 0.00</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这种方式是通过ssh拷贝数据，需要输入192.168.0.101那台机器www账户的密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@localhost rsync]<span class="comment"># rsync -avL www@192.168.0.101:/tmp/test2/ ./test3/</span></div><div class="line">www@192.168.0.101<span class="string">'s password:</span></div><div class="line"><span class="string">receiving incremental file list</span></div><div class="line"><span class="string">created directory ./test3</span></div><div class="line"><span class="string">./</span></div><div class="line"><span class="string">1</span></div><div class="line"><span class="string">1.txt</span></div><div class="line"><span class="string">2</span></div><div class="line"><span class="string">2.txt</span></div><div class="line"><span class="string">3</span></div><div class="line"><span class="string">4</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">sent 128 bytes received 351 bytes 38.32 bytes/sec</span></div><div class="line"><span class="string">total size is 0 speedup is 0.00</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;以上两种凡是如果写到脚背里，备份起来就有麻烦了，因为要输入密码，脚本本来就是自动的，不可能做到。但是不代表没有解决办法。那微是统计过密钥验证，密钥不设立密码就ok了。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在操作以前先设置主机信息：192.168.0.10（主机名yanyi-1）和192.168.0.101（主机名yanyi），需要从yanyi-1拷贝数据到yanyi上。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先确认一下yanyi-1上是否有这个文件 <code>/root/.ssh/id_rsa.pub</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># ssh-keygen</span></div><div class="line">Generating public/private rsa key pair.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果Linux不存在这个文件，按如下方法生成：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># ssh-keygen</span></div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</div><div class="line">Enter same passphrase again:</div><div class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</div><div class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">3b:74:af:e8:08:ac:99:30:3f:ef:84:7a:a0:a6:3d:89 root@Aming-1</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在这个过程中会有一些交互的过程，它首先提示要输入这个密钥的密码，出于安全考虑应该定义个密码，但是目的就是为了自动化同步数据，所以这里不输入任何密码，直接按回车，即密码为空。最后则生成了私钥 <code>/root/.ssh/id_rsa</code> 和公钥文件 <code>/root/.ssh/id_rsa.pub</code></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;把公钥文件的内容拷贝到目标机器上：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@yanyi-1 ~]<span class="comment"># cat .ssh/id_rsa.pub</span></div><div class="line">ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA5SPyJ/kliGTAMUan/GCN325VS8jMxvOn4uQoLU/NqBpCI3MrmvSucv6EAzxx1J2uOssW08el06LG+cUwXmm5mkqDRBV6C9qNnR/bVV5vr3QsUwbKPr7fdyJvruQWWR7cSL+mjP0SYmG2Qy2JcM3hl1IZArzC6yeUnq2Gwbax8LgbZE3XfRfOYdimwyh5Tfft7yLYipWc37k+oRUWkI3mW7PalsOlfQhxrLD/lS891y6RdSbGxMJWPoV0KMFbVh+uJgyAXpeuWl+F+/iuQPzb6w3h4pWI31bvbsE9BU82jSzHYEjpq3SN2MJN2vaLs5a0mVpm9zka/h4ITFB8Uy1iSQ== root@yanyi-1</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;复制主机yanyi-1的 <code>/root/.ssh/id_rsa.pub</code> 文件内容，并粘贴到主机yanyi的 <code>/home/www/.ssh/authorized_keys</code> 中:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># vim /home/www/.ssh/authorized_keys</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这一步也许会遇到/home/www/.ssh目录不存在的问题，可以手动创建，并修改目录权限为700，也可以执行 <code>ssh-krygen</code> 命令生成这个目录。保存/home/www/.ssh/authorized_keys文件后，再到主机yanyi-1上执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># ssh www@192.168.0.101</span></div><div class="line">Last login: Wed Jun 12 12:24:34 2013 from 192.168.0.10</div><div class="line">[www@yanyi ~]$</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;现在不用输入密码也可以登录主机yanyi了。下面先用yanyi主机退出来，再从主机yanyi-1上执行rsync命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># rsync -av rsync/test1/ www@192.168.0.101:/tmp/test4/</span></div><div class="line">sending incremental file list</div><div class="line">created directory /tmp/test4</div><div class="line">./</div><div class="line">1</div><div class="line">1.txt</div><div class="line">2</div><div class="line">2.txt</div><div class="line">3</div><div class="line">4</div><div class="line"></div><div class="line">sent 327 bytes received 129 bytes 912.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div></pre></td></tr></table></figure>
<h3 id="实例7：后台服务方式"><a href="#实例7：后台服务方式" class="headerlink" title="实例7：后台服务方式"></a>实例7：后台服务方式</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这种方式可以理解成，在远程主机上建立一个rsync的服务器，在服务器上匹配好rsync的各种应用，然后本机作为rsync的一个客户端去连接远程的rsync服务器。</p>
<h4 id="1、建立并配置rsync的配置文件-etc-rsyncd-conf"><a href="#1、建立并配置rsync的配置文件-etc-rsyncd-conf" class="headerlink" title="1、建立并配置rsync的配置文件 /etc/rsyncd.conf"></a>1、建立并配置rsync的配置文件 /etc/rsyncd.conf</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]# vim /etc/rsyncd.conf</div><div class="line"><span class="meta">#</span><span class="bash">port=873</span></div><div class="line">log file=/var/log/rsync.log</div><div class="line">pid file=/var/run/rsyncd.pid</div><div class="line"><span class="meta">#</span><span class="bash">address=192.168.0.10</span></div><div class="line"></div><div class="line">[test]</div><div class="line">path=/root/rsync</div><div class="line">use chroot=true</div><div class="line">max connections=4</div><div class="line">read only=no</div><div class="line">list=true</div><div class="line">uid=root</div><div class="line">gid=root</div><div class="line">auth users=test</div><div class="line">secrets file=/etc/rsyncd.passwd</div><div class="line">hosts allow=192.168.0.101</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;其中配置文件分为两部分：全局置部分和模块配置部分。全局部分就是几个参数而已，就像rsyncd.conf中port、log file、pid file、address这些都属于全局配置。而 [test]以下部分就是模块配置部分了。一个配置文件中可以有多个模块，模块名自定义，格式就像rsyncd.conf中的这样。其实模块中的一些参数例如，use chroot、max connections、uid、gid、auth users、secrets file以及hosts allow都恶意可配置成全局的参数。当然给出的参数并不是所有的，可以通过 <code>man rsyncd.conf</code> 获得更多信息。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下面简单解释一下这些参数的意义 ：</p>
<ul>
<li>port 指定在哪个端口启动rsyncd服务，默认是873</li>
<li>log file 指定日志文件</li>
<li>pid file 指定pid文件，这个文件的作用涉及到服务的启动以及停止等进程管理操作</li>
<li>address 指定启动rsyncd服务的IP，假如你的机器有多个IP，就可以指定其中一个启动rsyncd服务，默认是在全部IP上启动</li>
<li>[test] 指定模块名，自定义</li>
<li>path 指定数据存放的路径</li>
<li>use chroot true|false 默认是true，意思是在传输文件以前首先chroot到path参数所指  定的目录下。这样做的原因是实现额外的安全防护，但是缺点是需要以roots权限，并且不能备份指向外部的符号连接所指向的目录文件。默认情况下chroot值为true，如果数据当中有软连接文件的话建议设置成false。</li>
<li>max connections 指定最大的连接数，默认是0即没有限制</li>
<li>read only ture|false 如果为true则不能上传到该模块指定的路径下</li>
<li>list 指定当用户查询该服务器上的可用模块时，该模块是否被列出，设定为true则列出，false则隐藏</li>
<li>uid/gid 指定传输文件时，以哪个用户/组的身份传输</li>
<li>auth users 指定传输时要使用的用户名</li>
<li>secrets file 指定密码文件，该参数连同上面的参数如果不指定则不使用密码验证，注  意该密码文件的权限一定要是600</li>
<li>hosts allow 指定被允许连接该模块的主机，可以是IP或者网段，如果是多个，之间用空格隔开</li>
</ul>
<h4 id="2、编辑secrets-file，保存后要赋予600权限，如果权限不对，不能完成同步"><a href="#2、编辑secrets-file，保存后要赋予600权限，如果权限不对，不能完成同步" class="headerlink" title="2、编辑secrets file，保存后要赋予600权限，如果权限不对，不能完成同步"></a>2、编辑secrets file，保存后要赋予600权限，如果权限不对，不能完成同步</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># cat /etc/rsyncd.passwd</span></div><div class="line"><span class="built_in">test</span>:test123</div><div class="line">[root@yanyi-1 ~]<span class="comment"># chmod 600 /etc/rsyncd.passwd</span></div></pre></td></tr></table></figure>
<h4 id="3、启动rsync服务"><a href="#3、启动rsync服务" class="headerlink" title="3、启动rsync服务"></a>3、启动rsync服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># rsync --daemon --config=/etc/rsyncd.conf</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;启动后，可以查看一下日志，并查看端口是否启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># cat /var/log/rsync.log</span></div><div class="line">[root@yanyi-1 ~]<span class="comment"># netstat -lnp |grep 873</span></div><div class="line">tcp 0 0 0.0.0.0:873 0.0.0.0:* LISTEN 12066/rsync</div><div class="line">tcp 0 0 :::873 :::* LISTEN 12066/rsync</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果想开机启动，把 <code>rsync --daemon --config=/etc/rsyncd.conf</code> 写入到 <code>/etc/rc.d/rc.local</code> 文件中。</p>
<h4 id="4、到另一台机器上测试"><a href="#4、到另一台机器上测试" class="headerlink" title="4、到另一台机器上测试"></a>4、到另一台机器上测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># rsync -avL test@192.168.0.10::test/test1/ /tmp/test5/</span></div><div class="line">Password:</div><div class="line">receiving incremental file list</div><div class="line">created directory /tmp/test5</div><div class="line">./</div><div class="line">1</div><div class="line">1.txt</div><div class="line">2</div><div class="line">2.txt</div><div class="line">3</div><div class="line">4</div><div class="line"></div><div class="line">sent 143 bytes received 354 bytes 994.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;刚提到有一个选项叫做 <code>use chroot</code> 默认为true，如果为true，同步的文件中有软连接，则会有问题。首先在主机yanyi-1的/root/rsync/test1/目录下创建一个软连接文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># ln -s /root/test.txt rsync/test1/test.txt</span></div><div class="line">[root@yanyi-1 ~]<span class="comment"># ls -l rsync/test1/test.txt</span></div><div class="line">lrwxrwxrwx 1 root root 14 6月 12 13:24 rsync/test1/test.txt -&gt; /root/test.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后再到主机yanyi上同步：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># rsync -avL test@192.168.0.10::test/test1/ /tmp/test6/</span></div><div class="line">Password:</div><div class="line">receiving incremental file list</div><div class="line">symlink has no referent: <span class="string">"/test1/test.txt"</span> (<span class="keyword">in</span> <span class="built_in">test</span>)</div><div class="line">created directory /tmp/test6</div><div class="line">./</div><div class="line">1</div><div class="line">1.txt</div><div class="line">2</div><div class="line">2.txt</div><div class="line">3</div><div class="line">4</div><div class="line"></div><div class="line">sent 143 bytes received 419 bytes 1124.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div><div class="line">rsync error: some files/attrs were not transferred (see previous errors) (code</div><div class="line">23) at main.c(1532) [generator=3.0.6]</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;可以看到，如果设置 <code>use chroot</code> 为true则同步软连接文件会有问题，把主机yanyi-1的rsync配置文件修改一下，把true改为false：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@yanyi-1 ~]<span class="comment"># sed -i 's/use chroot=true/use chroot=false/' /etc/rsyncd.conf</span></div><div class="line">[root@yanyi-1 ~]<span class="comment"># grep 'use chroot' /etc/rsyncd.conf</span></div><div class="line">use chroot=<span class="literal">false</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;然后再到主机yanyi上再次执行同步：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># rsync -avL test@192.168.0.10::test/test1/ /tmp/test7/</span></div><div class="line">Password:</div><div class="line">receiving incremental file list</div><div class="line">created directory /tmp/test7</div><div class="line">./</div><div class="line">1</div><div class="line">1.txt</div><div class="line">2</div><div class="line">2.txt</div><div class="line">3</div><div class="line">4</div><div class="line">test.txt</div><div class="line"></div><div class="line">sent 162 bytes received 410 bytes 1144.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样就没有任何问题了。为什么修改完rsyncd.conf配置文件后，没有重启rsyncd服务？其实这是rsync的一个特定机制，配置文件即实时生效的，不用重启服务。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;上面的例子中，都有输入密码，这样同样不能写入脚本中自动执行，其实这种方式也是可以不用手动输入密码的，有两种实现方式：</p>
<h5 id="1、指定密码文件"><a href="#1、指定密码文件" class="headerlink" title="1、指定密码文件"></a>1、指定密码文件</h5><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在客户端上，也就是主机yanyi上，编辑一个密码文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># vim /etc/pass</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;加入test用户的密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># cat /etc/pass</span></div><div class="line">test123</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改密码文件的权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># chmod 600 /etc/pass</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在同步的时候，指定一下密码文件，就可以省去输入密码的步骤了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@yanyi ~]<span class="comment"># rsync -avL test@192.168.0.10::test/test1/ /tmp/test8/ --password-file=/etc/pass</span></div><div class="line">receiving incremental file list</div><div class="line">created directory /tmp/test8</div><div class="line">./</div><div class="line">1</div><div class="line">1.txt</div><div class="line">2</div><div class="line">2.txt</div><div class="line">3</div><div class="line">4</div><div class="line">test.txt</div><div class="line"></div><div class="line">sent 190 bytes received 451 bytes 1282.00 bytes/sec</div><div class="line">total size is 0 speedup is 0.00</div></pre></td></tr></table></figure>
<h5 id="2、在rsync服务器端不指定用户"><a href="#2、在rsync服务器端不指定用户" class="headerlink" title="2、在rsync服务器端不指定用户"></a>2、在rsync服务器端不指定用户</h5><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在服务端也就是主机yanyi-1上修改配置文件rsyncd.conf，去掉关于认证账户的配置项(auth user和secrets file这两行)：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i <span class="string">'s/auth users/#auth users/;s/secrets file/#secrets file/'</span> /etc/rsyncd.conf</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;上面的命令是把“auth users”和“secrets file”两行的最前面加一个“#”，这样就把这两行注释掉了，使其失去意义。sed的这种用法，只是用分号把两个替换的子命令块给替换了。然后到客户端主机yanyi上测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">rsync -avL 192.168.0.10::<span class="built_in">test</span>/test1/ /tmp/test9/</div><div class="line">receiving incremental file list</div><div class="line">created directory /tmp/test9</div><div class="line">./</div><div class="line">1</div><div class="line">1.txt</div><div class="line">2</div><div class="line">2.txt</div><div class="line">3</div><div class="line">4</div><div class="line">test.txt</div><div class="line">sent 162 bytes  received 410 bytes  1144.00 bytes/sec</div><div class="line">total size is 0  speedup is 0.00</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注意，这里不用再加test这个用户了，默认是以root的身份拷贝的，现在已经不需要输入密码了。</p>
<h3 id="实例8：根据一个文件列表文档来同步"><a href="#实例8：根据一个文件列表文档来同步" class="headerlink" title="实例8：根据一个文件列表文档来同步"></a>实例8：根据一个文件列表文档来同步</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;有时候，需要根据一个文档中的文件列表来同步文件。例，1.txt是文件列表，内容为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cat 1.txt</div><div class="line">/data/a/a.txt</div><div class="line">/data/b.txt</div><div class="line">/data/c/b/c.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;同步命令是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -av --files-from=1.txt / ip::module/</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;需要注意的是，1.txt中如果写全局路径，那么source目录需要写/</p>
<h3 id="实例9：在远程自动创建目录"><a href="#实例9：在远程自动创建目录" class="headerlink" title="实例9：在远程自动创建目录"></a>实例9：在远程自动创建目录</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;默认情况下，使用rsync的时候，不能自动创建级联目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -a /data/1/2/3/1.txt 1.1.1.1:/data/1/2/3/1.txt</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样会报错的。改一改上边的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -a /data/1/2/3/1.txt 1.1.1.1:/data/</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样同样也达不到想要的效果。虽然不在报错，但是只是把1.txt放到了1.1.1.1:/data/目录下。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rsync有个选项就是-R，会帮助我们自动创建级联目录。所以上边的命令应该改成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -aR /data/1/2/3/1.txt 1.1.1.1:/data/</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这样就会在1.1.1.1:/data/目录下创建1/2/3/这样的级联目录，类似mkdir -p</p>
<h3 id="实例10：只同步指定类型的文件"><a href="#实例10：只同步指定类型的文件" class="headerlink" title="实例10：只同步指定类型的文件"></a>实例10：只同步指定类型的文件</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;需求：同步某个目录下所有的图片（*.jpg），该目录下有很多其他的文件，但只想同步*.jpg的文件。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rsync有一个 <code>--exclude</code> 可以排除指定文件，还有一个 <code>--include</code> 选项的作用正好和  <code>--exclude</code> 相反。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;直接使用 <code>--include=&quot;*.jpg&quot;</code> 可否实现？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -av --include=<span class="string">"*.jpg"</span> /src/ /des/</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;实验证明，这是不对的。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;正确的答案是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsync -av --include=<span class="string">"*.jpg"</span> --exclude=* /src/ /des/</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/68. Linux 命令- tr" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/68. Linux 命令- tr/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.251Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/68. Linux 命令- tr/">
        Linux 命令- tr
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tr 命令用户转换或删除文件中的字符。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tr 指令从标准输入设备读取数据，经过字符串转以后，将结果输出到标准输出设备。</p>
<h2 id="1-命令语法"><a href="#1-命令语法" class="headerlink" title="1. 命令语法"></a>1. 命令语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tr [参数] [第一字符集] [第二字符集]</div><div class="line">tr [OPTION] [SET1] [SET2]</div></pre></td></tr></table></figure>
<h2 id="2-命令参数"><a href="#2-命令参数" class="headerlink" title="2. 命令参数"></a>2. 命令参数</h2><ul>
<li>-c, –complement：反选设定字符。也就是符合 SET1 的部份不做处理，不符合的剩余部份才进行转换</li>
<li>-d, –delete：删除指令字符</li>
<li>-s, –squeeze-repeats：缩减连续重复的字符成指定的单个字符</li>
<li>-t, –truncate-set1：削减 SET1 指定范围，使之与 SET2 设定长度相等</li>
<li>–help：显示程序用法信息</li>
<li>–version：显示程序本身的版本信息</li>
</ul>
<h3 id="字符集合的范围："><a href="#字符集合的范围：" class="headerlink" title="字符集合的范围："></a>字符集合的范围：</h3><ul>
<li>\NNN 八进制值的字符 NNN (1 to 3 为八进制值的字符)</li>
<li>\\ 反斜杠</li>
<li>\a Ctrl-G 铃声</li>
<li>\b Ctrl-H 退格符</li>
<li>\f Ctrl-L 走行换页</li>
<li>\n Ctrl-J 新行</li>
<li>\r Ctrl-M 回车</li>
<li>\t Ctrl-I tab键</li>
<li>\v Ctrl-X 水平制表符</li>
<li>CHAR1-CHAR2 ：字符范围从 CHAR1 到 CHAR2 的指定，范围的指定以 ASCII 码的次序为基础，只能由小到大，不能由大到小。</li>
<li>[CHAR*] ：这是 SET2 专用的设定，功能是重复指定的字符到与 SET1 相同长度为止</li>
<li>[CHAR*REPEAT] ：这也是 SET2 专用的设定，功能是重复指定的字符到设定的 REPEAT 次数为止(REPEAT 的数字采 8 进位制计算，以 0 为开始)</li>
<li>[:alnum:] ：所有字母字符与数字</li>
<li>[:alpha:] ：所有字母字符</li>
<li>[:blank:] ：所有水平空格</li>
<li>[:cntrl:] ：所有控制字符</li>
<li>[:digit:] ：所有数字</li>
<li>[:graph:] ：所有可打印的字符(不包含空格符)</li>
<li>[:lower:] ：所有小写字母</li>
<li>[:print:] ：所有可打印的字符(包含空格符)</li>
<li>[:punct:] ：所有标点字符</li>
<li>[:space:] ：所有水平与垂直空格符</li>
<li>[:upper:] ：所有大写字母</li>
<li>[:xdigit:] ：所有 16 进位制的数字</li>
<li>[=CHAR=] ：所有符合指定的字符(等号里的 CHAR，代表你可自订的字符)</li>
</ul>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><h3 id="实例1：将文件testfile-中的小写字母全部转换成大写字母"><a href="#实例1：将文件testfile-中的小写字母全部转换成大写字母" class="headerlink" title="实例1：将文件testfile 中的小写字母全部转换成大写字母"></a>实例1：将文件testfile 中的小写字母全部转换成大写字母</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat testfile|tr a-z A-Z</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ cat testfile         <span class="comment">#testfile原来的内容  </span></div><div class="line">Linux networks are becoming more and more common, </div><div class="line">but scurity is often an overlooked  </div><div class="line">issue. Unfortunately, <span class="keyword">in</span> today’s environment all networks </div><div class="line">are potential hacker targets,  </div><div class="line">fro0m tp-secret military research networks to small home LANs.  </div><div class="line">Linux Network Securty focuses on securing Linux <span class="keyword">in</span> a </div><div class="line">networked environment, <span class="built_in">where</span> the  </div><div class="line">security of the entire network needs to be considered</div><div class="line">rather than just isolated machines.  </div><div class="line">It uses a mix of theory and practicl techniques to </div><div class="line">teach administrators how to install and  </div><div class="line">use security applications, as well as how the </div><div class="line">applcations work and why they are necesary. </div><div class="line">$ cat testfile | tr a-z A-Z <span class="comment">#转换后的输出  </span></div><div class="line">LINUX NETWORKS ARE BECOMING MORE AND MORE COMMON, BUT SCURITY IS OFTEN AN OVERLOOKED  </div><div class="line">ISSUE. UNFORTUNATELY, IN TODAY’S ENVIRONMENT ALL NETWORKS ARE POTENTIAL HACKER TARGETS,  </div><div class="line">FROM TP-SECRET MILITARY RESEARCH NETWORKS TO SMALL HOME LANS.  </div><div class="line">LINUX NETWORK SECURTY FOCUSES ON SECURING LINUX IN A NETWORKED ENVIRONMENT, WHERE THE  </div><div class="line">SECURITY OF THE ENTIRE NETWORK NEEDS TO BE CONSIDERED RATHER THAN JUST ISOLATED MACHINES.  </div><div class="line">IT USES A MIX OF THEORY AND PRACTICL TECHNIQUES TO TEACH ADMINISTRATORS HOW TO INSTALL AND  </div><div class="line">USE SECURITY APPLICATIONS, AS WELL AS HOW THE APPLCATIONS WORK AND WHY THEY ARE NECESARY.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也可以使用 [:lower:] [:upper:] 参数来实现</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat testfile|tr [:lower:] [:upper:]</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ cat testfile | tr [:lower:] [:upper:] <span class="comment">#转换后的输出  </span></div><div class="line">LINUX NETWORKS ARE BECOMING MORE AND MORE COMMON, BUT SCURITY IS OFTEN AN OVERLOOKED  </div><div class="line">ISSUE. UNFORTUNATELY, IN TODAY’S ENVIRONMENT ALL NETWORKS ARE POTENTIAL HACKER TARGETS,  </div><div class="line">FROM TP-SECRET MILITARY RESEARCH NETWORKS TO SMALL HOME LANS.  </div><div class="line">LINUX NETWORK SECURTY FOCUSES ON SECURING LINUX IN A NETWORKED ENVIRONMENT, WHERE THE  </div><div class="line">SECURITY OF THE ENTIRE NETWORK NEEDS TO BE CONSIDERED RATHER THAN JUST ISOLATED MACHINES.  </div><div class="line">IT USES A MIX OF THEORY AND PRACTICL TECHNIQUES TO TEACH ADMINISTRATORS HOW TO INSTALL AND  </div><div class="line">USE SECURITY APPLICATIONS, AS WELL AS HOW THE APPLCATIONS WORK AND WHY THEY ARE NECESARY.</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;不过替换、删除、以及去重复都是针对一个字符来讲的，哟一定局限性。如果是针对一个字符串就不再管用了</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/29. Linux 命令- chgrp" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/29. Linux 命令- chgrp/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.250Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/29. Linux 命令- chgrp/">
        Linux 命令- chgrp
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在 Linux 系统里，文件或目录的权限的掌控以拥有者及所属群组来管理。可以使用 chgrp 指令变更文件与目录所属群组，这种方式采用群组名称或群组织识别码都可以。chgrp 命令就是 change group 的缩写！要被改变的组名必须要在 /etc/group 文件被存在才行。</p>
<h2 id="1-命令格式"><a href="#1-命令格式" class="headerlink" title="1.命令格式"></a>1.命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chgrp [选项] [组] [文件]</div></pre></td></tr></table></figure>
<h2 id="2-命令功能"><a href="#2-命令功能" class="headerlink" title="2.命令功能"></a>2.命令功能</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;chgrp 命令可采用群组名称或群组织识别码的方式改变文件或目录的所属群组。使用权限是超级用户。</p>
<h2 id="3-命令参数"><a href="#3-命令参数" class="headerlink" title="3.命令参数"></a>3.命令参数</h2><h3 id="必要参数"><a href="#必要参数" class="headerlink" title="必要参数"></a>必要参数</h3><ul>
<li>-c 当发生改变时输出调试信息</li>
<li>-f 不显示错误信息</li>
<li>-R 处理指定目录以及其子目录下的所有文件</li>
<li>-v 运行时显示详细的处理信息</li>
<li>–dereference 作用于符号链接的指向，而不是符号链接本身</li>
<li>–no-dereference 作用于符号链接本身</li>
</ul>
<h3 id="选择参数"><a href="#选择参数" class="headerlink" title="选择参数"></a>选择参数</h3><ul>
<li>–reference=&lt;文件或者目录&gt;</li>
<li>–help 显示帮助信息</li>
<li>–version 显示版本信息</li>
</ul>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><h3 id="实例1：改变文件的群组属性"><a href="#实例1：改变文件的群组属性" class="headerlink" title="实例1：改变文件的群组属性"></a>实例1：改变文件的群组属性</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chgrp -v bin log2012.log</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">---xrw-r-- 1 root root 302108 11-13 06:03 log2012.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># chgrp -v bin log2012.log</span></div><div class="line">“log2012.log” 的所属组已更改为 bin</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">---xrw-r-- 1 root bin  302108 11-13 06:03 log2012.log</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;将 log2012.log 文件由 root 群组该为 bin 群组</p>
<h3 id="实例2：根据指定未见改变文件的群组属性"><a href="#实例2：根据指定未见改变文件的群组属性" class="headerlink" title="实例2：根据指定未见改变文件的群组属性"></a>实例2：根据指定未见改变文件的群组属性</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chgrp --reference=log2012.log log2013.log</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">---xrw-r-- 1 root bin  302108 11-13 06:03 log2012.log</div><div class="line">-rw-r--r-- 1 root root     61 11-13 06:03 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#  chgrp --reference=log2012.log log2013.log </span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">---xrw-r-- 1 root bin  302108 11-13 06:03 log2012.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 log2013.log</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;改变文件 log2013.log 的群组属性，是的文件 log2013.log 的群组属性和参考文件 log2012.log 的群组属性相同</p>
<h3 id="实例3-改变指定目录以及其子目录下的所有文件的群组属性"><a href="#实例3-改变指定目录以及其子目录下的所有文件的群组属性" class="headerlink" title="实例3.改变指定目录以及其子目录下的所有文件的群组属性"></a>实例3.改变指定目录以及其子目录下的所有文件的群组属性</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chgrp -R bin test6</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">drwxr-xr-x 2 root root   4096 11-30 08:39 test6</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd test6</span></div><div class="line">[root@localhost test6]<span class="comment"># ll</span></div><div class="line">---xr--r-- 1 root root 302108 11-30 08:39 linklog.log</div><div class="line">---xr--r-- 1 root root 302108 11-30 08:39 log2012.log</div><div class="line">-rw-r--r-- 1 root root     61 11-30 08:39 log2013.log</div><div class="line">-rw-r--r-- 1 root root      0 11-30 08:39 log2014.log</div><div class="line">-rw-r--r-- 1 root root      0 11-30 08:39 log2015.log</div><div class="line">-rw-r--r-- 1 root root      0 11-30 08:39 log2016.log</div><div class="line">-rw-r--r-- 1 root root      0 11-30 08:39 log2017.log</div><div class="line">[root@localhost test6]<span class="comment"># cd ..</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># chgrp -R bin test6</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd test6</span></div><div class="line">[root@localhost test6]<span class="comment"># ll</span></div><div class="line">---xr--r-- 1 root bin 302108 11-30 08:39 linklog.log</div><div class="line">---xr--r-- 1 root bin 302108 11-30 08:39 log2012.log</div><div class="line">-rw-r--r-- 1 root bin     61 11-30 08:39 log2013.log</div><div class="line">-rw-r--r-- 1 root bin      0 11-30 08:39 log2014.log</div><div class="line">-rw-r--r-- 1 root bin      0 11-30 08:39 log2015.log</div><div class="line">-rw-r--r-- 1 root bin      0 11-30 08:39 log2016.log</div><div class="line">-rw-r--r-- 1 root bin      0 11-30 08:39 log2017.log</div><div class="line">[root@localhost test6]<span class="comment"># cd ..</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">drwxr-xr-x 2 root bin    4096 11-30 08:39 test6</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;改变指定目录以及其子目录下的所有文件的群组属性</p>
<h3 id="实例4-通过群组织识别码改变文件群组属性"><a href="#实例4-通过群组织识别码改变文件群组属性" class="headerlink" title="实例4.通过群组织识别码改变文件群组属性"></a>实例4.通过群组织识别码改变文件群组属性</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chgrp -R 100 test6</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># chgrp -R 100 test6</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">drwxr-xr-x 2 root users   4096 11-30 08:39 test6</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd test6</span></div><div class="line">[root@localhost test6]<span class="comment"># ll</span></div><div class="line">---xr--r-- 1 root users 302108 11-30 08:39 linklog.log</div><div class="line">---xr--r-- 1 root users 302108 11-30 08:39 log2012.log</div><div class="line">-rw-r--r-- 1 root users     61 11-30 08:39 log2013.log</div><div class="line">-rw-r--r-- 1 root users      0 11-30 08:39 log2014.log</div><div class="line">-rw-r--r-- 1 root users      0 11-30 08:39 log2015.log</div><div class="line">-rw-r--r-- 1 root users      0 11-30 08:39 log2016.log</div><div class="line">-rw-r--r-- 1 root users      0 11-30 08:39 log2017.log</div><div class="line">[root@localhost test6]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;通过群识别码改变文件群组属性，100为 users 群组的识别码，具体群组和群组识别码可以去 /etc/group 文件中查看</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/35. Linux 命令- df" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/35. Linux 命令- df/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.249Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/35. Linux 命令- df/">
        Linux 命令- df
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linux中df命令的功能是用来检查linux服务器的文件系统的磁盘空间占用情况。可以利用该命令来获取硬盘被占用了多少空间，目前还剩下多少空间等信息。</p>
<h2 id="2-命令功能"><a href="#2-命令功能" class="headerlink" title="2.命令功能"></a>2.命令功能</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;显示指定磁盘文件的可用空间。如果没有文件名被指定，则所有当前被挂载的文件系统的可用空间将被显示。默认情况下，磁盘空间将以 1KB 为单位进行显示，除非环境变量 POSIXL_CORRECT 被指定，那样将以512字节为单位进行显示。</p>
<h2 id="3-命令参数"><a href="#3-命令参数" class="headerlink" title="3.命令参数"></a>3.命令参数</h2><h3 id="必要参数"><a href="#必要参数" class="headerlink" title="必要参数"></a>必要参数</h3><ul>
<li>-a 全部文件系统列表</li>
<li>-h 方便阅读方式显示</li>
<li>-H 等于“-h”，但是计算式，1K=1000，而不是1K=1024</li>
<li>-i 显示inode信息</li>
<li>-k 区块为1024字节</li>
<li>-l 只显示本地文件系统</li>
<li>-m 区块为1048576字节</li>
<li>–no-sync 忽略 sync 命令</li>
<li>-P 输出格式为POSIX</li>
<li>–sync 在取得磁盘信息前，先执行sync命令</li>
<li>-T 文件系统类型</li>
</ul>
<h3 id="选择参数："><a href="#选择参数：" class="headerlink" title="选择参数："></a>选择参数：</h3><ul>
<li>–block-size=&lt;区块大小&gt; 指定区块大小</li>
<li>-t&lt;文件系统类型&gt; 只显示选定文件系统的磁盘信息</li>
<li>-x&lt;文件系统类型&gt; 不显示选定文件系统的磁盘信息</li>
<li>–help 显示帮助信息</li>
<li>–version 显示版本信息</li>
</ul>
<h2 id="4-使用实例"><a href="#4-使用实例" class="headerlink" title="4.使用实例"></a>4.使用实例</h2><h3 id="实例1：显示磁盘使用情况"><a href="#实例1：显示磁盘使用情况" class="headerlink" title="实例1：显示磁盘使用情况"></a>实例1：显示磁盘使用情况</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df</span></div><div class="line">文件系统               1K-块        已用     可用 已用% 挂载点</div><div class="line">/dev/sda7             19840892    890896  17925856   5% /</div><div class="line">/dev/sda9            203727156 112797500  80413912  59% /opt</div><div class="line">/dev/sda8              4956284    570080   4130372  13% /var</div><div class="line">/dev/sda6             19840892   1977568  16839184  11% /usr</div><div class="line">/dev/sda3               988116     23880    913232   3% /boot</div><div class="line">tmpfs                 16473212         0  16473212   0% /dev/shm</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Linux 中 df 命令的输出清单的第1列是代表文件系统对应设备文件的路径名（一般是硬盘上的分区）；第2列给出分区包含的数据块（1024字节）的数目；第3、4列分别表示已用的和可用的数据块数目。用户也许会感到奇怪的是，第3、4列块数之和不等于第2列中的块数。这是因为缺省的每个分区都留了少量空间供系统管理员使用。即使遇到普通用户空间已满的情况，管理员仍能登录和留有解决问题所需的工作空间。清单 use% 列表普通用户空间使用的百分比，即使这一数字达到 100% ，分区仍然留有系统管理员使用的空间。最后，Mounted on 列表示文件系统的挂载点。</p>
<h3 id="实例2：以-inode-模式来显示磁盘使用情况"><a href="#实例2：以-inode-模式来显示磁盘使用情况" class="headerlink" title="实例2：以 inode 模式来显示磁盘使用情况"></a>实例2：以 inode 模式来显示磁盘使用情况</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df -i</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -i</span></div><div class="line">文件系统               Inode (I)已用 (I)可用 (I)已用% 挂载点</div><div class="line">/dev/sda7            5124480    5560 5118920    1% /</div><div class="line">/dev/sda9            52592640   50519 52542121    1% /opt</div><div class="line">/dev/sda8            1280000    8799 1271201    1% /var</div><div class="line">/dev/sda6            5124480   80163 5044317    2% /usr</div><div class="line">/dev/sda3             255232      34  255198    1% /boot</div><div class="line">tmpfs                4118303       1 4118302    1% /dev/shm</div></pre></td></tr></table></figure>
<h3 id="实例3：显示指定类型磁盘"><a href="#实例3：显示指定类型磁盘" class="headerlink" title="实例3：显示指定类型磁盘"></a>实例3：显示指定类型磁盘</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df -t ext3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -t ext3</span></div><div class="line">文件系统               1K-块        已用     可用 已用% 挂载点</div><div class="line">/dev/sda7             19840892    890896  17925856   5% /</div><div class="line">/dev/sda9            203727156  93089700 100121712  49% /opt</div><div class="line">/dev/sda8              4956284    570104   4130348  13% /var</div><div class="line">/dev/sda6             19840892   1977568  16839184  11% /usr</div><div class="line">/dev/sda3               988116     23880    913232   3% /boot</div></pre></td></tr></table></figure>
<h3 id="实例4：列出各文件系统的-i-节点使用情况"><a href="#实例4：列出各文件系统的-i-节点使用情况" class="headerlink" title="实例4：列出各文件系统的 i 节点使用情况"></a>实例4：列出各文件系统的 i 节点使用情况</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df -ia</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -ia</span></div><div class="line">文件系统               Inode (I)已用 (I)可用 (I)已用% 挂载点</div><div class="line">/dev/sda7            5124480    5560 5118920    1% </div><div class="line">/proc                       0       0       0    -  /proc</div><div class="line">sysfs                      0       0       0    -  /sys</div><div class="line">devpts                     0       0       0    -  /dev/pts</div><div class="line">/dev/sda9            52592640   50519 52542121    1% /opt</div><div class="line">/dev/sda8            1280000    8799 1271201    1% /var</div><div class="line">/dev/sda6            5124480   80163 5044317    2% /usr</div><div class="line">/dev/sda3             255232      34  255198    1% /boot</div><div class="line">tmpfs                4118303       1 4118302    1% /dev/shm</div><div class="line">none                       0       0       0    -  /proc/sys/fs/binfmt_misc</div></pre></td></tr></table></figure>
<h3 id="实例5：列出文件系统的类型"><a href="#实例5：列出文件系统的类型" class="headerlink" title="实例5：列出文件系统的类型"></a>实例5：列出文件系统的类型</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df -T</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -T</span></div><div class="line">文件系统      类型     1K-块        已用     可用 已用% 挂载点</div><div class="line">/dev/sda7     ext3    19840892    890896  17925856   5% /</div><div class="line">/dev/sda9     ext3   203727156  93175692 100035720  49% /opt</div><div class="line">/dev/sda8     ext3     4956284    570104   4130348  13% /var</div><div class="line">/dev/sda6     ext3    19840892   1977568  16839184  11% /usr</div><div class="line">/dev/sda3     ext3      988116     23880    913232   3% /boot</div><div class="line">tmpfs        tmpfs    16473212         0  16473212   0% /dev/shm</div></pre></td></tr></table></figure>
<h3 id="实例6：以更易读的方式显示目前磁盘空间和使用情况"><a href="#实例6：以更易读的方式显示目前磁盘空间和使用情况" class="headerlink" title="实例6：以更易读的方式显示目前磁盘空间和使用情况"></a>实例6：以更易读的方式显示目前磁盘空间和使用情况</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df -h</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -h</span></div><div class="line">文件系统              容量  已用 可用 已用% 挂载点</div><div class="line">/dev/sda7              19G  871M   18G   5% /</div><div class="line">/dev/sda9             195G   89G   96G  49% /opt</div><div class="line">/dev/sda8             4.8G  557M  4.0G  13% /var</div><div class="line">/dev/sda6              19G  1.9G   17G  11% /usr</div><div class="line">/dev/sda3             965M   24M  892M   3% /boot</div><div class="line">tmpfs                  16G     0   16G   0% /dev/shm</div><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -H</span></div><div class="line">文件系统               容量   已用  可用 已用% 挂载点</div><div class="line">/dev/sda7               21G   913M    19G   5% /</div><div class="line">/dev/sda9              209G    96G   103G  49% /opt</div><div class="line">/dev/sda8              5.1G   584M   4.3G  13% /var</div><div class="line">/dev/sda6               21G   2.1G    18G  11% /usr</div><div class="line">/dev/sda3              1.1G    25M   936M   3% /boot</div><div class="line">tmpfs                   17G      0    17G   0% /dev/shm</div><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -lh</span></div><div class="line">文件系统              容量  已用 可用 已用% 挂载点</div><div class="line">/dev/sda7              19G  871M   18G   5% /</div><div class="line">/dev/sda9             195G   89G   96G  49% /opt</div><div class="line">/dev/sda8             4.8G  557M  4.0G  13% /var</div><div class="line">/dev/sda6              19G  1.9G   17G  11% /usr</div><div class="line">/dev/sda3             965M   24M  892M   3% /boot</div><div class="line">tmpfs                  16G     0   16G   0% /dev/shm</div><div class="line">[root@CT1190 <span class="built_in">log</span>]<span class="comment"># df -k</span></div><div class="line">文件系统               1K-块        已用     可用 已用% 挂载点</div><div class="line">/dev/sda7             19840892    890896  17925856   5% /</div><div class="line">/dev/sda9            203727156  93292572  99918840  49% /opt</div><div class="line">/dev/sda8              4956284    570188   4130264  13% /var</div><div class="line">/dev/sda6             19840892   1977568  16839184  11% /usr</div><div class="line">/dev/sda3               988116     23880    913232   3% /boot</div><div class="line">tmpfs                 16473212         0  16473212   0% /dev/shm</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong> </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-h更具目前磁盘空间和使用情况 以更易读的方式显示</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-H根上面的-h参数相同,不过在根式化的时候,采用1000而不是1024进行容量转换</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-k以单位显示磁盘的使用情况</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-l显示本地的分区的磁盘空间使用率,如果服务器nfs了远程服务器的磁盘,那么在df上加上-l后系统显示的是过滤nsf驱动器后的结果</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;-i显示inode的使用情况。linux采用了类似指针的方式管理磁盘空间影射.这也是一个比较关键应用</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/37. Linux 命令- ln" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/37. Linux 命令- ln/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.248Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/37. Linux 命令- ln/">
        Linux 命令- ln
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ln 是 Linux 中又一个非常重要的命令，它的功能的功能是为某一个文件在另一个位置建立一个同步的连接。当需要在不同的目录，用到相同的文件时，就不需要在每个需要的目录下都放一个必须相同的文件，只要在某个固定的目录，放上该文件，然后在其他的目录下用 ln 命令连接（link）就可以，不必重复的占用磁盘空间。</p>
<h2 id="1-命令格式"><a href="#1-命令格式" class="headerlink" title="1.命令格式"></a>1.命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln [参数] [源文件或目录] [目标文件或目录]</div></pre></td></tr></table></figure>
<h2 id="2-命令功能"><a href="#2-命令功能" class="headerlink" title="2.命令功能"></a>2.命令功能</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Linux 文件系统中，有所谓的连接（link），可以将其视为档案的别名。而连接有可分为两种：硬链接（hard link）与软连接（symbolic link），硬连接的意思是一个档案可以有多个名称，而软连接的方式则是产生一个特殊的档案，该档案的内容是指向另一个档案的位置。硬链接是存在同一个文件系统中，而软连接却可以跨越不同的文件系统。</p>
<h3 id="软连接"><a href="#软连接" class="headerlink" title="软连接"></a>软连接</h3><ol>
<li><p>软连接，一路径的形式存在。类似与 windows 系统中的快捷方式；</p>
</li>
<li><p>软连接可以跨文件系统，硬链接不可以；</p>
</li>
<li><p>软连接可以对一个不存在的文件名进行连接；</p>
</li>
</ol>
<p>4.软连接可以对目录进行连接</p>
<h3 id="硬链接"><a href="#硬链接" class="headerlink" title="硬链接"></a>硬链接</h3><ol>
<li><p>硬链接，以文件副本的形式存在。但不占用实际空间；</p>
</li>
<li><p>不允许给目录创建硬链接；</p>
</li>
<li><p>硬链接只有在同一个文件系统中才能创建。</p>
</li>
</ol>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol>
<li><p>ln 命令会保持每一处连接文件的同步性，也就是说，不论改动了哪一处，其他的文件都会发生相同的变化；</p>
</li>
<li><p>ln 的连接又分软连接和硬链接两种，软连接就是 <code>ln -s [源文件] [目标文件]</code> ，它只会在选定的位置上生成一个文件的镜像，不回占用磁盘空间，硬链接 <code>ln [源文件] [目标文件]</code> ，没有参数 -s ，会在选定的文职上生成一个和源文件大小相同的文件，无论是软连接还是硬链接，文件都保持同步变化。</p>
</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ln 指令在连接文件或目录，如同时指定两个以上的文件或目录，且最后的目的地是一个存在的目录，则会把前面指定的所有文件或目录复制到该目录中。若同时指定多个文件或目录，且最后的目的地并非是有一个已存在的目录，则会出现错误信息。</p>
<h2 id="3-命令参数"><a href="#3-命令参数" class="headerlink" title="3.命令参数"></a>3.命令参数</h2><h3 id="必要参数"><a href="#必要参数" class="headerlink" title="必要参数"></a>必要参数</h3><ul>
<li>-b 删除，覆盖以前建立的链接</li>
<li>-d 允许超级用户制作目录的硬链接</li>
<li>-f 强制执行</li>
<li>-i 交互模式，文件存在则提示用户是否覆盖</li>
<li>-n 把符号链接视为一般目录</li>
<li>-s 软链接(符号链接)</li>
<li>-v 显示详细的处理过程</li>
</ul>
<h3 id="选择参数"><a href="#选择参数" class="headerlink" title="选择参数"></a>选择参数</h3><ul>
<li>-S “-S&lt;字尾备份字符串&gt; ”或 “–suffix=&lt;字尾备份字符串&gt;”</li>
<li>-V “-V&lt;备份方式&gt;”或“–version-control=&lt;备份方式&gt;”</li>
<li>–help 显示帮助信息</li>
<li>–version 显示版本信息</li>
</ul>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><h3 id="实例1：给文件创建软连接"><a href="#实例1：给文件创建软连接" class="headerlink" title="实例1：给文件创建软连接"></a>实例1：给文件创建软连接</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln -s log2013.log link2013</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ln -s log2013.log link2013</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 log2013.log</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为 log2013.log 文件创建软连接 link2013 ，如果 log2013.log 丢失，link2013 将失效。</p>
<h3 id="实例2：给文件创建硬连接"><a href="#实例2：给文件创建硬连接" class="headerlink" title="实例2：给文件创建硬连接"></a>实例2：给文件创建硬连接</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln log2013.log ln2013</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ln log2013.log ln2013</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 2 root bin      61 11-13 06:03 ln2013</div><div class="line">-rw-r--r-- 2 root bin      61 11-13 06:03 log2013.log</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为 log2013.log 创建硬链接 ln2013 ，log2013.log 与ln2013 的各项属性相同。</p>
<h3 id="实例3：接上面两实例，连接完毕后，删除和重建连接源文件"><a href="#实例3：接上面两实例，连接完毕后，删除和重建连接源文件" class="headerlink" title="实例3：接上面两实例，连接完毕后，删除和重建连接源文件"></a>实例3：接上面两实例，连接完毕后，删除和重建连接源文件</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 2 root bin      61 11-13 06:03 ln2013</div><div class="line">-rw-r--r-- 2 root bin      61 11-13 06:03 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># rm -rf log2013.log </span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 ln2013</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># touch log2013.log</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 ln2013</div><div class="line">---xrw-r-- 1 root bin  302108 11-13 06:03 log2012.log</div><div class="line">-rw-r--r-- 1 root root      0 12-07 16:19 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># vi log2013.log </span></div><div class="line">2013-01</div><div class="line">2013-02</div><div class="line">2013-03</div><div class="line">2013-04</div><div class="line">2013-05</div><div class="line">2013-06</div><div class="line">2013-07</div><div class="line">2013-08</div><div class="line">2013-09</div><div class="line">2013-10</div><div class="line">2013-11</div><div class="line">2013-12[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 ln2013</div><div class="line">-rw-r--r-- 1 root root     96 12-07 16:21 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cat link2013 </span></div><div class="line">2013-01</div><div class="line">2013-02</div><div class="line">2013-03</div><div class="line">2013-04</div><div class="line">2013-05</div><div class="line">2013-06</div><div class="line">2013-07</div><div class="line">2013-08</div><div class="line">2013-09</div><div class="line">2013-10</div><div class="line">2013-11</div><div class="line">2013-12</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cat ln2013 </span></div><div class="line">hostnamebaidu=baidu.com</div><div class="line">hostnamesina=sina.com</div><div class="line">hostnames=<span class="literal">true</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;1.源文件被删除后，并没有影响硬链接文件；软连接文件在 conetos 系统下不断的闪烁，提示远未见已经不存在</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;2.重建源文件后，团连接不再闪烁提示，说明已经连接成功，找到了连接文件系统；重建后，硬链接文件并没有收到源文件影响，硬链接文件的内容还是保留了删除前源文件的内容，说明硬链接已经失效。</p>
<h3 id="实例4：将文件链接为另一个目录中的相同名字"><a href="#实例4：将文件链接为另一个目录中的相同名字" class="headerlink" title="实例4：将文件链接为另一个目录中的相同名字"></a>实例4：将文件链接为另一个目录中的相同名字</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln log2013.log test3</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ln log2013.log test3</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 ln2013</div><div class="line">-rw-r--r-- 2 root root     96 12-07 16:21 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd test3</span></div><div class="line">[root@localhost test3]<span class="comment"># ll</span></div><div class="line">-rw-r--r-- 2 root root 96 12-07 16:21 log2013.log</div><div class="line">[root@localhost test3]<span class="comment"># vi log2013.log </span></div><div class="line">2013-01</div><div class="line">2013-02</div><div class="line">2013-03</div><div class="line">2013-04</div><div class="line">2013-05</div><div class="line">2013-06</div><div class="line">2013-07</div><div class="line">2013-08</div><div class="line">2013-09</div><div class="line">2013-10[root@localhost test3]<span class="comment"># ll</span></div><div class="line">-rw-r--r-- 2 root root 80 12-07 16:36 log2013.log</div><div class="line">[root@localhost test3]<span class="comment"># cd ..</span></div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root     11 12-07 16:01 link2013 -&gt; log2013.log</div><div class="line">-rw-r--r-- 1 root bin      61 11-13 06:03 ln2013</div><div class="line">-rw-r--r-- 2 root root     80 12-07 16:36 log2013.log</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在 test3 目录中创建了 log2013.log 的硬链接，修改 test3 目录中的 log2013.log 文件，同时也会同步到源文件</p>
<h3 id="实例5：给目录创建软连接"><a href="#实例5：给目录创建软连接" class="headerlink" title="实例5：给目录创建软连接"></a>实例5：给目录创建软连接</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln -sv /opt/soft/<span class="built_in">test</span>/test3 /opt/soft/<span class="built_in">test</span>/test5</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ll</span></div><div class="line">drwxr-xr-x 2 root root   4096 12-07 16:36 test3</div><div class="line">drwxr-xr-x 2 root root   4096 12-07 16:57 test5</div><div class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd test5</span></div><div class="line">[root@localhost test5]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root 5 12-07 16:57 test3 -&gt; test3</div><div class="line">[root@localhost test5]<span class="comment"># cd test3</span></div><div class="line">-bash: <span class="built_in">cd</span>: test3: 符号连接的层数过多</div><div class="line">[root@localhost test5]<span class="comment"># </span></div><div class="line">[root@localhost test5]<span class="comment"># </span></div><div class="line">[root@localhost test5]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root 5 12-07 16:57 test3 -&gt; test3</div><div class="line">[root@localhost test5]<span class="comment"># rm -rf test3</span></div><div class="line">[root@localhost test5]<span class="comment"># ll</span></div><div class="line">[root@localhost test5]<span class="comment"># ln -sv /opt/soft/test/test3 /opt/soft/test/test5</span></div><div class="line">创建指向“/opt/soft/<span class="built_in">test</span>/test3”的符号链接“/opt/soft/<span class="built_in">test</span>/test5/test3”</div><div class="line">[root@localhost test5]<span class="comment"># ll</span></div><div class="line">lrwxrwxrwx 1 root root 20 12-07 16:59 test3 -&gt; /opt/soft/<span class="built_in">test</span>/test3</div><div class="line">[root@localhost test5]<span class="comment"># </span></div><div class="line">[root@localhost test5]<span class="comment"># cd test3</span></div><div class="line">[root@localhost test3]<span class="comment"># ll</span></div><div class="line">总计 4</div><div class="line">-rw-r--r-- 2 root root 80 12-07 16:36 log2013.log</div><div class="line">[root@localhost test3]<span class="comment"># touch log2014.log</span></div><div class="line">[root@localhost test3]<span class="comment"># ll</span></div><div class="line">总计 4</div><div class="line">-rw-r--r-- 2 root root 80 12-07 16:36 log2013.log</div><div class="line">-rw-r--r-- 1 root root  0 12-07 17:05 log2014.log</div><div class="line">[root@localhost test3]<span class="comment"># cd ..</span></div><div class="line">[root@localhost test5]<span class="comment"># cd ..</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<ol>
<li><p>目录只能创建软连接      </p>
</li>
<li><p>目录创建链接必须用绝对路径，相对路径创建会不成功，会提示：符号连接的层数过多 ，这样的错误      </p>
</li>
<li><p>在连接目标目录中修改文件都会在源文件目录中同步变化</p>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-2. Linux 命令/74. Linux 命令- rpm" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/2. Linux 命令/74. Linux 命令- rpm/" class="article-date">
  	<time datetime="2017-09-02T17:57:34.247Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/2. Linux 命令/74. Linux 命令- rpm/">
        Linux 命令- rpm
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rpm命令是RPM软件包的管理工具。RPM是 “Redhat Package Manager” 的缩写，根据名字也能猜到这是Redhat公司开发出来的。RPM 是以一种数据库记录的方式来将需要的套件安装到Linux 主机的一套管理程序。也就是说，linux系统中存在着一个关于RPM的数据库，它记录了安装的包以及包与包之间依赖相关性。RPM包是预先在linux机器上编译好并打包好的文件，安装起来非常快捷。但是也有一些缺点，比如安装的环境必须与编译时的环境一致或者相当；包与包之间存在着相互依赖的情况；卸载包时需要先把依赖的包卸载掉，如果依赖的包是系统所必须的，那就不能卸载这个包，否则会造成系统崩溃。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果光驱中还有系统安装盘的话，可以通过 mount /dev/cdrom /mnt 命令把光驱挂载到/mnt目录下，那么会在/mnt/Packages目录下看到很多.rpm的文件，这就是RPM包了。</p>
<h2 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm [选项] [参数]</div></pre></td></tr></table></figure>
<h2 id="命令选项"><a href="#命令选项" class="headerlink" title="命令选项"></a>命令选项</h2><ul>
<li>-a：查询所有套件； </li>
<li>-b&lt;完成阶段&gt;&lt;套件档&gt;+或-t &lt;完成阶段&gt;&lt;套件档&gt;+：设置包装套件的完成阶段，并指定套件档的文件名称； </li>
<li>-c：只列出组态配置文件，本参数需配合”-l”参数使用； </li>
<li>-d：只列出文本文件，本参数需配合”-l”参数使用； </li>
<li>-e&lt;套件档&gt;或–erase&lt;套件档&gt;：删除指定的套件； </li>
<li>-f&lt;文件&gt;+：查询拥有指定文件的套件；</li>
<li>-h或–hash：套件安装时列出标记； </li>
<li>-i：显示套件的相关信息； </li>
<li>-i&lt;套件档&gt;或–install&lt;套件档&gt;：安装指定的套件档； </li>
<li>-l：显示套件的文件列表； </li>
<li>-p&lt;套件档&gt;+：查询指定的RPM套件档； </li>
<li>-q：使用询问模式，当遇到任何问题时，rpm指令会先询问用户； </li>
<li>-R：显示套件的关联性信息； </li>
<li>-s：显示文件状态，本参数需配合”-l”参数使用； </li>
<li>-U&lt;套件档&gt;或–upgrade&lt;套件档&gt;：升级指定的套件档； </li>
<li>-v：显示指令执行过程； </li>
<li>-vv：详细显示指令执行过程，便于排错。</li>
</ul>
<h2 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h2><ul>
<li>软件包：指定要操纵的rpm软件包</li>
</ul>
<h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><h3 id="实例1：安装一个rpm"><a href="#实例1：安装一个rpm" class="headerlink" title="实例1：安装一个rpm"></a>实例1：安装一个rpm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># rpm -ivh /mnt/Packages/libjpeg-turbo-devel-1.2.1-1.el6.i686.rpm</span></div><div class="line">Preparing... <span class="comment">########################################### [100%]</span></div><div class="line">1:libjpeg-turbo-devel <span class="comment">########################################### [100%]</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;其中libhpeg-turbo-devel-1.2.1-1，el6.i686.rpm 是rpm包的文件名。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;另外在安装一个rpm常用的附带参数：</p>
<ul>
<li><strong>–force</strong>:强制安装，即使覆盖属于其他包的文件也要安装</li>
<li><strong>nodeps</strong>：当要安装的rpm包依赖其他包时，几十其他包没有安装，也要安装这个包</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;也就是说 <code>rpm -i --force --nodeps</code> 可以忽略所有依赖关系和文件问题，什么包都能安装上，但这种强制安装的软件包不能保证完全发挥功能。</p>
<h3 id="实例2：升级一个rpm包"><a href="#实例2：升级一个rpm包" class="headerlink" title="实例2：升级一个rpm包"></a>实例2：升级一个rpm包</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -Uvh filename</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;“-U”即升级的意思</p>
<h3 id="实例3：卸载一个rpm包"><a href="#实例3：卸载一个rpm包" class="headerlink" title="实例3：卸载一个rpm包"></a>实例3：卸载一个rpm包</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -e filename</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># rpm -qa |grep libjpeg-turbo-devel</span></div><div class="line">libjpeg-turbo-devel-1.2.1-1.el6.i686</div><div class="line">[root@localhost ~]<span class="comment"># rpm -e libjpeg-turbo-devel</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<strong>说明</strong><br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这里的filename是通过rpm的查询功能所查询到的。卸载时后边跟的filename和安装时的是有区别的，安装时是把一个存在的文件作为参数，而卸载时只需要包名即可。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;有时会出现一些错误或者警告</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">... is needed by ...</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这说明这个软件被其他软件需要，不能随便卸载，可以用 <code>rpm -e --nodeps</code> 强制卸载</p>
<h3 id="实例4：如何安装-src-rpm软件包"><a href="#实例4：如何安装-src-rpm软件包" class="headerlink" title="实例4：如何安装.src.rpm软件包"></a>实例4：如何安装.src.rpm软件包</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;有些rpm包是以 .src.rpm结尾的，这类rpm包是包含了源代码的rpm包，在安装时需要进行编译。这类rpm包有两种方法安装：</p>
<h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">rpm -i your-package.src.rpm </div><div class="line"><span class="built_in">cd</span> /usr/src/redhat/SPECS </div><div class="line">rpmbuild -bp your-package.specs <span class="comment">#一个和软件包同名的specs文件 </span></div><div class="line"><span class="built_in">cd</span> /usr/src/redhat/BUILD/your-package/ <span class="comment">#一个和软件包同名的目录 </span></div><div class="line">./configure <span class="comment">#这一步和编译普通的源码软件一样，可以加上参数 </span></div><div class="line">make </div><div class="line">make install</div></pre></td></tr></table></figure>
<h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm -i you-package.src.rpm </div><div class="line"><span class="built_in">cd</span> /usr/src/redhat/SPECS</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;前两步和方法一相同</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpmbuild -bb your-package.specs   <span class="comment">#一个和软件包同名的specs文件</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这是在 <code>/usr/src/redhat/RPM/i386/</code>（根据提提包的不同，也可能是i686、noarch等等）在这个目录下，有一个新的rpm包，这个是编译好的二进制文件。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;执行 <code>rpm -i new-package.rpm</code>即可安装完成。</p>
<h3 id="实例5：不安装但是获取rpm包中的文件"><a href="#实例5：不安装但是获取rpm包中的文件" class="headerlink" title="实例5：不安装但是获取rpm包中的文件"></a>实例5：不安装但是获取rpm包中的文件</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;需要使用工具 <code>rpm2cpio</code>和<code>cpio</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rpm2cpio xxx.rpm | cpio -vi</div><div class="line">rpm2cpio xxx.rpm | cpio -idmv</div><div class="line">rpm2cpio xxx.rpm | cpio --extract --make-firectories</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数i和extract相同，表示提取文件。v表示显示执行进程，d和make-directory相同，表示根据包中文件原来的路径建立目录，m表示保持文件的更新时间。</p>
<h3 id="实例6：查看与rpm包相关的文件和其他信息"><a href="#实例6：查看与rpm包相关的文件和其他信息" class="headerlink" title="实例6：查看与rpm包相关的文件和其他信息"></a>实例6：查看与rpm包相关的文件和其他信息</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;假设使用rpm包<code>mysql-3.23.54a-11</code></p>
<h4 id="1-列出系统中所有安装过的rpm包"><a href="#1-列出系统中所有安装过的rpm包" class="headerlink" title="1. 列出系统中所有安装过的rpm包"></a>1. 列出系统中所有安装过的rpm包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -qa</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查找所有安装过的包含某个字符串sql的rpm包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -qa | grep sql</div></pre></td></tr></table></figure>
<h4 id="2-获得某个rpm包的文件全名"><a href="#2-获得某个rpm包的文件全名" class="headerlink" title="2. 获得某个rpm包的文件全名"></a>2. 获得某个rpm包的文件全名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -q mysql</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;可以获得系统中安装的mysql软件包全名，从中可以获得当前软件包的版本信息。此例可以得到信息 mysql-3.23.54a-11</p>
<h4 id="3-一个rpm包中的文件的安装路径"><a href="#3-一个rpm包中的文件的安装路径" class="headerlink" title="3. 一个rpm包中的文件的安装路径"></a>3. 一个rpm包中的文件的安装路径</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ql 包名</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注意：这里的是不包括 .rpm 后缀的rpm包的名称，也就是说这能使用mysql或者mysql-3.23.54a-11而不是mysql-3.23.54a-11.rpm。如果只是想知道可执行程序放到那里去了，也可以用which</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">which</span> mysql</div></pre></td></tr></table></figure>
<h4 id="4-一个rpm包中包含哪些文件。"><a href="#4-一个rpm包中包含哪些文件。" class="headerlink" title="4. 一个rpm包中包含哪些文件。"></a>4. 一个rpm包中包含哪些文件。</h4><ul>
<li>一个没有安装过的rpm包，使用 </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -qlp ***.rpm</div></pre></td></tr></table></figure>
<ul>
<li>一个已经安装过的rpm包，还可以使用 </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ql ***.rpm</div></pre></td></tr></table></figure>
<h4 id="5-获取关于一个rpm包的版本，用途等相关信息"><a href="#5-获取关于一个rpm包的版本，用途等相关信息" class="headerlink" title="5. 获取关于一个rpm包的版本，用途等相关信息"></a>5. 获取关于一个rpm包的版本，用途等相关信息</h4><ul>
<li>一个没有安装过的rpm包，使用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -qip ***.rpm</div></pre></td></tr></table></figure>
<ul>
<li>一个已经安装过的rpm包，还可以使用</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -qi ***.rpm</div></pre></td></tr></table></figure>
<h4 id="6-某个程序是哪个rpm包安装的，或者哪个rpm包包含这个程序"><a href="#6-某个程序是哪个rpm包安装的，或者哪个rpm包包含这个程序" class="headerlink" title="6. 某个程序是哪个rpm包安装的，或者哪个rpm包包含这个程序"></a>6. 某个程序是哪个rpm包安装的，或者哪个rpm包包含这个程序</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rpm -qf `<span class="built_in">which</span> 程序名` <span class="comment">#返回软件包的全名 </span></div><div class="line">rpm -qif `<span class="built_in">which</span> 程序名` <span class="comment">#返回软件包的有关信息 </span></div><div class="line">rpm -qlf `<span class="built_in">which</span> 程序名` <span class="comment">#返回软件包的文件列表</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注意：这里不是引号，而是`(反引号)，就是键盘左上角那个键。也可以使用 <code>rpm -qilf</code>，同时输出rpm包信息和文件列表</p>
<h4 id="7-某个文件是哪个rpm包安装的，或者哪个rpm包包含这个文件。"><a href="#7-某个文件是哪个rpm包安装的，或者哪个rpm包包含这个文件。" class="headerlink" title="7. 某个文件是哪个rpm包安装的，或者哪个rpm包包含这个文件。"></a>7. 某个文件是哪个rpm包安装的，或者哪个rpm包包含这个文件。</h4><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注意，前一个问题中的方法，只适用与可执行的程序，而下面的方法，不仅可以用于可执行程序，也可以用于普通的任何文件。前提是知道这个文件名。首先获得这个程序的完整路径，可以用whereis或者which，然后使用rpm -qf例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">whereis ftptop </div><div class="line">ftptop: /usr/bin/ftptop /usr/share/man/man1/ftptop.1.gz </div><div class="line">rpm -qf /usr/bin/ftptop proftpd-1.2.8-1 </div><div class="line">rpm -qf /usr/share/doc/proftpd-1.2.8/rfc/rfc0959.txt proftpd-1.2.8-1</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux命令/">Linux命令</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/46/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="page-number" href="/page/46/">46</a><span class="page-number current">47</span><a class="page-number" href="/page/48/">48</a><a class="page-number" href="/page/49/">49</a><span class="space">&hellip;</span><a class="page-number" href="/page/63/">63</a><a class="extend next" rel="next" href="/page/48/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 失落的乐章
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    

<script>
	var yiliaConfig = {
		fancybox: ,
		mathjax: ,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



  </div>
</body>
</html>