<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>失落的乐章</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="失落的乐章的Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="失落的乐章">
<meta property="og:url" content="https://hcldirgit.github.io/page/40/index.html">
<meta property="og:site_name" content="失落的乐章">
<meta property="og:description" content="失落的乐章的Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="失落的乐章">
<meta name="twitter:description" content="失落的乐章的Blog">
  
    <link rel="alternative" href="/atom.xml" title="失落的乐章" type="application/atom+xml">
  
  
    <link rel="icon" href="https://github.com/hcldirgit/image/blob/master/0.png?raw=true">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85415703-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">失落的乐章</a></h1>
		</hgroup>

		
		<p class="header-subtitle">技术面前，永远都是学生。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Ansible/" style="font-size: 10.42px;">Ansible</a> <a href="/tags/Apache/" style="font-size: 18.33px;">Apache</a> <a href="/tags/Cacti/" style="font-size: 11.67px;">Cacti</a> <a href="/tags/DNS/" style="font-size: 13.33px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/FTP/" style="font-size: 11.25px;">FTP</a> <a href="/tags/Git/" style="font-size: 10.83px;">Git</a> <a href="/tags/HA集群/" style="font-size: 11.67px;">HA集群</a> <a href="/tags/Hadoop/" style="font-size: 12.5px;">Hadoop</a> <a href="/tags/Jenkins/" style="font-size: 10.42px;">Jenkins</a> <a href="/tags/LAMP/" style="font-size: 19.58px;">LAMP</a> <a href="/tags/LNMP/" style="font-size: 17.08px;">LNMP</a> <a href="/tags/LVS/" style="font-size: 16.67px;">LVS</a> <a href="/tags/Linux/" style="font-size: 19.17px;">Linux</a> <a href="/tags/Linux命令/" style="font-size: 20px;">Linux命令</a> <a href="/tags/Linux安全/" style="font-size: 14.17px;">Linux安全</a> <a href="/tags/Memcached/" style="font-size: 11.25px;">Memcached</a> <a href="/tags/MongoDB/" style="font-size: 15.42px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 17.5px;">MySQL</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/Nagios/" style="font-size: 11.67px;">Nagios</a> <a href="/tags/Nginx/" style="font-size: 17.92px;">Nginx</a> <a href="/tags/OpenStack/" style="font-size: 11.25px;">OpenStack</a> <a href="/tags/Php/" style="font-size: 14.58px;">Php</a> <a href="/tags/Puppet/" style="font-size: 11.25px;">Puppet</a> <a href="/tags/Python/" style="font-size: 14.58px;">Python</a> <a href="/tags/Redis/" style="font-size: 16.25px;">Redis</a> <a href="/tags/Resin/" style="font-size: 10px;">Resin</a> <a href="/tags/Saltstack/" style="font-size: 10px;">Saltstack</a> <a href="/tags/Samba/" style="font-size: 12.08px;">Samba</a> <a href="/tags/Squid/" style="font-size: 14.58px;">Squid</a> <a href="/tags/Tomcat/" style="font-size: 13.75px;">Tomcat</a> <a href="/tags/Zabbix/" style="font-size: 15.83px;">Zabbix</a> <a href="/tags/haproxy/" style="font-size: 12.5px;">haproxy</a> <a href="/tags/keepalived/" style="font-size: 12.92px;">keepalived</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/shell练习/" style="font-size: 18.75px;">shell练习</a> <a href="/tags/正则表达式/" style="font-size: 12.92px;">正则表达式</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">失落的乐章</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">失落的乐章</h1>
			</hgroup>
			
			<p class="header-subtitle">技术面前，永远都是学生。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-Apache/10. Apache模块动态加载和静态加载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Apache/10. Apache模块动态加载和静态加载/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.889Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Apache/10. Apache模块动态加载和静态加载/">
        Apache模块动态加载和静态加载
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;以前对apache研究的不够深刻，甚至连模块的动态以及静态都搞不清楚。查了资料，基本上明了。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;静态，顾名思义就是apache本身不用干什么，不用动就可以使用模块。这就需要把模块都编译进apache的httpd文件中。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;动态，需要apache去调用这个模块，用哪个调用哪个，这种方式的前提是，需要告诉apache这些模块在哪里。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;现在apache版本都普遍都是2.0或者2.2了，针对apache2.x如何动态以及静态编译?</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;对于2.x版本来讲，编译apache的时候，只要加上  –enable-mods-shared=all 就可以动态的编译全部模块。安装完成后会在  apache2/modules 目录下多了很多模块文件。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果想静态加载所有模块，编译参数改成  –enable-mods=all</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache/">Apache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LAMP/">LAMP</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Apache/11. apache mod_proxy 扩展模块安装" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Apache/11. apache mod_proxy 扩展模块安装/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.889Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Apache/11. apache mod_proxy 扩展模块安装/">
        apache mod_proxy 扩展模块安装
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;现在用到apache的扩展功能了，可是在第一次编译的时候，没有编译进这个模块去？怎么办呢，可以通过扩展的方式编译一下。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下载相同版本的apache源代码，注意，一定是要相同版本的，否则编译不能成功。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;下载后，解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span>  httpd-2.0.59/modules/proxy</div><div class="line">/usr/<span class="built_in">local</span>/apache2/bin/apxs -c -i -a mod_proxy.c proxy_connect.c proxy_http.c proxy_util.c</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;从输出里面看到apache的modules目录下已经产生了mod_proxy.so,且已经在httpd.conf中激活了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/apache2/conf/</div><div class="line">ls ../modules/</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;看到确实有mod_prxoy.so</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编辑配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim httpd.conf</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改如下</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;加载模块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">LoadModule proxy_module modules/mod_proxy.so (这句是编译激活时产生的)</div><div class="line">LoadModule proxy_http_module modules/mod_proxy.so (这句是要手动添加的)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;到这里proxy模块的支持算是已经完成了，下面就该配置虚拟主机了。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache/">Apache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LAMP/">LAMP</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Apache/1. Apache编译安装" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Apache/1. Apache编译安装/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.888Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Apache/1. Apache编译安装/">
        Apache编译安装
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Apache也需要到官网下载合适的版本，目前使用较多的版本为2.0或者2.2建议下载2.2版本。<a href="http://www.apache.org/dyn/closer.cgi" target="_blank" rel="external">Apache官网下载地址</a> 实际上，我们所谓的 apache ，真正的名字叫 httpd 。</p>
<h2 id="1-下载"><a href="#1-下载" class="headerlink" title="1.下载"></a>1.下载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost mysql]<span class="comment"># cd /usr/local/src/</span></div><div class="line">[root@localhost src]<span class="comment"># wget http://syslab.comsenz.com/downloads/linux/httpd-2.2.16.tar.gz</span></div></pre></td></tr></table></figure>
<h2 id="2-解压"><a href="#2-解压" class="headerlink" title="2.解压"></a>2.解压</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost src]<span class="comment"># tar zxvf httpd-2.2.16.tar.gz</span></div></pre></td></tr></table></figure>
<h2 id="3-配置编译参数"><a href="#3-配置编译参数" class="headerlink" title="3.配置编译参数"></a>3.配置编译参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost src]<span class="comment"># cd httpd-2.2.16</span></div><div class="line">[root@localhost httpd-2.2.16]<span class="comment"># ./configure \</span></div><div class="line">--prefix=/usr/<span class="built_in">local</span>/apache2 \</div><div class="line">--with-included-apr \</div><div class="line">--<span class="built_in">enable</span>-so \</div><div class="line">--<span class="built_in">enable</span>-deflate=shared \</div><div class="line">--<span class="built_in">enable</span>-expires=shared \</div><div class="line">--<span class="built_in">enable</span>-rewrite=shared \</div><div class="line">--with-pcre</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<code>--prefix</code> 指定安装到哪里， <code>--enable-so</code> 表示启用DSO 。DSO是Dynamic Shared Objects（动态共享目标）的缩写，它提供了一种在运行时将特殊格式的代码在程序运行需要时，将需要的部分从外存调入内存执行的方法。Apache 支持动态共享模块，也支持静态模块，静态的话，会把需要的目标直接编译进apache的可执行文件中，相比较动态，虽然省去了加载共享模块的步骤，但是也加大了二进制执行文件的空间，变得臃肿。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<code>--enable-deflate=shared</code> 表示共享的方式编译deflate，后面的参数同理。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;那什么是动态共享，什么是静态？ apache 编译安装完成后会生成一个核心的二进制可执行文件叫做 httpd ，这个文件座位核心文件，提供服务时就是它在处理用户的请求，但是有一些功能，比如这里提到的 expires 就是配置静态文件（图片）过期时间的，也就是说图片可以在用户浏览器的临时缓存目录中缓存多久。这些功能是作为 httpd 的一个扩展模块来工作的，那么这种扩展模块有两种存在的方式，一种是直接在编译的时候和 httpd 文件拧到一起，组成一个体积大的文件，这种叫做静态。而另一种方式是，扩展模块作为一个独立的文件存在，只有在使用这个模块时再去调用它，这种叫做动态共享。两种方式中，动态的好处是，核心文件 httpd 比较小，模块随时用随时加载，耗费内存相对较少。而静态的优势是，在服务启动时，会把所有模块加载，用到时很快就执行，效率较高。建议倾向用动态。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果出现了这样的错误:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">error: mod_deflate has been requested but can not be built due to prerequisite failures</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;解决办法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y zlib-devel</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为了避免在make的时候出现错误，所以最好是提前先安装好一些库文件:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y pcre pcre-devel apr apr-devel</div></pre></td></tr></table></figure>
<h2 id="4-编译"><a href="#4-编译" class="headerlink" title="4.编译"></a>4.编译</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost httpd-2.2.16]<span class="comment"># make</span></div></pre></td></tr></table></figure>
<h2 id="5-安装"><a href="#5-安装" class="headerlink" title="5.安装"></a>5.安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost httpd-2.2.16]<span class="comment"># make install</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;以上两个步骤都可以使用 <code>echo $?</code> 来检查是否正确执行，否则需要根据错误提示去解决问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost httpd-2.2.16]<span class="comment"># echo $?</span></div><div class="line">[root@localhost httpd-2.2.16]<span class="comment"># 0</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为 0 则没有问题。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache/">Apache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LAMP/">LAMP</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Dns、Iredmaill/9. DNS服务器(三)：子域授权及转发" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Dns、Iredmaill/9. DNS服务器(三)：子域授权及转发/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.886Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Dns、Iredmaill/9. DNS服务器(三)：子域授权及转发/">
        DNS服务器(三)：子域授权及转发
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、DNS服务器子域授权的实现"><a href="#一、DNS服务器子域授权的实现" class="headerlink" title="一、DNS服务器子域授权的实现"></a>一、DNS服务器子域授权的实现</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;通常自己架设DNS服务器给自己使用的公司都是内部有特殊需求，或者公司内部域名较多，为了方便以后的管理而架设。我们知道一个域名就是一个区域，一般每个区域都会有专人负责管理，当一个公司人员足够多时，这时就会有划分子域给下级部门管理的需求。在一个区域下划分子域，并给子域指定一个新的DNS服务器，这种方法是可以实现的，我们通常称这种划分子区域的方法为子域授权。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;实例：给wubinary.com域名划分一个blog.wubinary.com的子域。bind的安装配置及主DNS服务器的架设不再此讨论</p>
<ol>
<li>首先架设一个主DNS服务器，编辑/var/named/wubinary.com.zone文件，主DNS服务器的IP为192.168.0.6，资源记录数据文件如下：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$TTL</span> 600</div><div class="line">@ IN SOA dns.wubinary.com. dnsadmin.wubinary.com. (</div><div class="line"> 2014031203</div><div class="line"> 2H</div><div class="line"> 4M</div><div class="line"> 1D</div><div class="line"> 2D )</div><div class="line">@ IN NS dns.wubinary.com.</div><div class="line">@ IN NS ns2.wubinary.com.</div><div class="line">@ IN MX 10 mail.wubinary.com.</div><div class="line">dns IN A 192.168.0.6</div><div class="line">mail IN A 192.168.0.12</div><div class="line">www IN A 192.168.0.48</div><div class="line">ns2 IN A 192.168.0.80</div><div class="line">blog.wubinary.com. IN NS dns.blog.wubinary.com.</div><div class="line">dns.blog.wubinary.com. IN A 192.168.0.2</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注意，以上最后两行为子域的DNS服务器，只要在主DNS服务器定义好了子域的DNS服务器就等于给子域授权了。</p>
<ol>
<li>然后在回到子域的服务器，192.168.0.2上配置子域区域。打开/etc/named.rfc1912.zones文件，在最末尾定义子域的区域。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">zone <span class="string">"blog.wubinary.com"</span> IN &#123;</div><div class="line"> <span class="built_in">type</span> master;</div><div class="line"> file <span class="string">"blog.wubinary.com.zone"</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ol>
<li>接着再定义子域DNS服务器的资源记录文件，/var/named/blog.wubinary.com.zone。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$TTL</span> 600</div><div class="line">@ IN SOA dns.blog.wubinary.com. dnsadmin.blog.wubinary.com. (</div><div class="line"> 2014031201</div><div class="line"> 1H</div><div class="line"> 5M</div><div class="line"> 3D</div><div class="line"> 1D )</div><div class="line">@ IN NS dns.blog.wubinary.com.</div><div class="line">dns IN A 192.168.0.2</div><div class="line">www IN A 192.168.0.78</div><div class="line">ftp IN A 192.168.0.23</div></pre></td></tr></table></figure>
<ol>
<li>重新启动两边的DNS服务，测试一下子域授权是否成功。</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;主域机器测试：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%B8%89" alt="">%EF%BC%9A%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E5%8F%8A%E8%BD%AC%E5%8F%91/01.jpeg?raw=true)</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%B8%89" alt="">%EF%BC%9A%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E5%8F%8A%E8%BD%AC%E5%8F%91/02.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;子域机器测试：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%B8%89" alt="">%EF%BC%9A%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E5%8F%8A%E8%BD%AC%E5%8F%91/03.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;测试正常，操作成功！</p>
<h2 id="二、DNS服务器域名解析转发"><a href="#二、DNS服务器域名解析转发" class="headerlink" title="二、DNS服务器域名解析转发"></a>二、DNS服务器域名解析转发</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DNS转发的意义在于，定向查询，一台DNS服务器在获取到查询请求时，自己不尝试解析域名，而转发查询请求给指定的DNS服务器实现此次解析操作。假设，我们现在碰到这么一种情况，我们的DNS服务器是处在一个内网的网段，与外网不能直接通信，在这个局域网中唯一一个能和外网通信的是路由器或者其它的DNS服务器。那么如果我们想要实现通过这台局域网的DNS服务器查询解析外网的域名，就要用到转发的功能了。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;转发可以用参数forwarders和forward实现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">forwarders &#123; IP_ADDR1; IP_ADDR; ...&#125;;</div><div class="line">forward &#123; only|first &#125;;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数说明：</p>
<ul>
<li>forwarders：用于定义转发的服务器的IP地址，可以写多个，用分号隔开。</li>
<li>forward：用于定义转发的操作，only为只作转发操作，有结果则返回结果，没有结果则什么操作也不作；first为先作转发操作，如果没有结果则去递归查找。</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;全局和区域：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这两个参数可以放在全局定义，也可放在区域定义，也可以两个同时使用，但不管怎样，放在区域的优先权更高。如果用于特定区域则把转发定义在区域内，如果用于全局，则把转发定义在全局。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;转发实例：让上面的区域wubinary.com可以实现解析外网的域名。</p>
<ol>
<li>区域wubinary.com所设的DNS服务器为局域网的IP地址，不可以解析外网域名。</li>
</ol>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%B8%89" alt="">%EF%BC%9A%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E5%8F%8A%E8%BD%AC%E5%8F%91/04.jpeg?raw=true)</p>
<ol>
<li>由上图可以看出wubinary.com区域不能解析51cto.com的NS记录，我们添加一个转发功能。</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;编辑/etc/named.conf文件，添加转发ip 192.168.0.1</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%B8%89" alt="">%EF%BC%9A%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E5%8F%8A%E8%BD%AC%E5%8F%91/05.jpeg?raw=true)</p>
<ol>
<li>修改完成后，重启服务，测试一下，可以解析了，转发成功！</li>
</ol>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%B8%89" alt="">%EF%BC%9A%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E5%8F%8A%E8%BD%AC%E5%8F%91/06.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;说明：有的时候，如果我们事先已经知道了某个区域DNS服务器的地址，为了不让当前DNS服务器向根查询结果，那么我们就可以直接使用转发，向当前DNS服务器指定一个地址，让它查询直接向这个地址请求，这样做的好处能明显的提高响应速度。</p>
<h2 id="三、DNS中的访问控制列表"><a href="#三、DNS中的访问控制列表" class="headerlink" title="三、DNS中的访问控制列表"></a>三、DNS中的访问控制列表</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;有的时候我们须要在DNS配置文件中指定n个IP地址，如果全都写在一起的话，每块地方都要写一次，那么相当麻烦，如果使用一个参数定义那一片的IP地址，那么管理起来就相当方便了，这个就是DNS中的ACL,bind支持的访问控制表。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> acl ACL_NAME &#123;</div><div class="line"> 172.16.0.0/16;</div><div class="line"> 192.168.0.0/24</div><div class="line"> 127.0.0.0/8;</div><div class="line"> ...</div><div class="line"> ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在全局选项中定义ACL，给每个ACL取一个名字，这样以后每次引用，只须在填定IP地址的地方填写那个变量就行了。在bind中有几个事先定义好的ACL:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">any: 任何主机</div><div class="line">none: 无一主机</div><div class="line"><span class="built_in">local</span>: 本机</div><div class="line">localnet: 本机的所在的网络</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DNS/">DNS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Dns、Iredmaill/8. DNS服务器(二)：使用bind实现主从DNS服务器数据同步" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Dns、Iredmaill/8. DNS服务器(二)：使用bind实现主从DNS服务器数据同步/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.885Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Dns、Iredmaill/8. DNS服务器(二)：使用bind实现主从DNS服务器数据同步/">
        DNS服务器(二)：使用bind实现主从DNS服务器数据同步
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、bind简介"><a href="#一、bind简介" class="headerlink" title="一、bind简介"></a>一、bind简介</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Linux中通常使用bind来实现DNS服务器的架设，bind软件由isc(www.isc.org)维护。在yum仓库中可以找到软件，配置好yum源，直接使用命令yum install bind就可以安装。当前bind的稳定版本为bind9，bind的服务名称为named，监听的端口为53号端口。bind的主要配置文件为/etc/named.conf，此文件主要用于配置区域，并指定区域数据库文件名称。区域数据库文件通常保存于/var/named/目录下，用于定义区域的资源类型。</p>
<h2 id="二、使用bind架设DNS服务器"><a href="#二、使用bind架设DNS服务器" class="headerlink" title="二、使用bind架设DNS服务器"></a>二、使用bind架设DNS服务器</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;实例操作：以域名wubinary.com为例配置一个DNS服务器，实现正向解析与反向解析。</p>
<h3 id="1-使用setup命令配置DNS服务器的IP地址，我们以192-168-0-70这个IP地址为例，在本地架设一个DNS服务器。"><a href="#1-使用setup命令配置DNS服务器的IP地址，我们以192-168-0-70这个IP地址为例，在本地架设一个DNS服务器。" class="headerlink" title="1.使用setup命令配置DNS服务器的IP地址，我们以192.168.0.70这个IP地址为例，在本地架设一个DNS服务器。"></a>1.使用setup命令配置DNS服务器的IP地址，我们以192.168.0.70这个IP地址为例，在本地架设一个DNS服务器。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/01.jpeg?raw=true)</p>
<h3 id="2-bind配置文件为-etc-named-conf，此文件用于定义区域。每个区域的数据文件保存在-var-named目录下。"><a href="#2-bind配置文件为-etc-named-conf，此文件用于定义区域。每个区域的数据文件保存在-var-named目录下。" class="headerlink" title="2.bind配置文件为/etc/named.conf，此文件用于定义区域。每个区域的数据文件保存在/var/named目录下。"></a>2.bind配置文件为/etc/named.conf，此文件用于定义区域。每个区域的数据文件保存在/var/named目录下。</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;named.conf各参数项说明：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">options &#123;</div><div class="line">//全局选项</div><div class="line">&#125;</div><div class="line">zone <span class="string">"ZONE name"</span>&#123;</div><div class="line">//定义区域</div><div class="line">&#125;</div><div class="line">logging&#123;</div><div class="line">//定义日志系统</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;named.conf文件内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"> options &#123;</div><div class="line"> listen-on port 53 &#123; 127.0.0.1; &#125;; <span class="comment">#定义监听端口及IP地址</span></div><div class="line"> listen-on-v6 port 53 &#123; ::1; &#125;; <span class="comment">#定义监听的IPv6地址</span></div><div class="line"> directory  <span class="string">"/var/named"</span>; <span class="comment">#全局目录</span></div><div class="line"> dump-file  <span class="string">"/var/named/data/cache_dump.db"</span>;</div><div class="line"> statistics-file <span class="string">"/var/named/data/named_stats.txt"</span>;</div><div class="line"> memstatistics-file <span class="string">"/var/named/data/named_mem_stats.txt"</span>;</div><div class="line"> allow-query &#123; localhost; &#125;;<span class="comment">#允许查询的IP地址</span></div><div class="line"> recursion yes; <span class="comment">#是否允许递归查询</span></div><div class="line"> dnssec-enable yes;</div><div class="line"> dnssec-validation yes;</div><div class="line"> dnssec-lookaside auto;</div><div class="line"> /* Path to ISC DLV key */</div><div class="line"> bindkeys-file <span class="string">"/etc/named.iscdlv.key"</span>;</div><div class="line"> managed-keys-directory <span class="string">"/var/named/dynamic"</span>;</div><div class="line">&#125;;</div><div class="line">logging &#123;</div><div class="line"> channel default_debug &#123;</div><div class="line"> file <span class="string">"data/named.run"</span>;</div><div class="line"> severity dynamic;</div><div class="line"> &#125;;</div><div class="line">&#125;;</div><div class="line">zone <span class="string">"."</span> IN &#123;</div><div class="line"> <span class="built_in">type</span> hint;</div><div class="line"> file <span class="string">"named.ca"</span>;</div><div class="line">&#125;;</div><div class="line">include <span class="string">"/etc/named.rfc1912.zones"</span>;</div><div class="line">include <span class="string">"/etc/named.root.key"</span>;</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注意：bind的配置文件/etc/named.conf里必须要定义的三个区域是：根、127.0.0.1和127.0.0.1的反解。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;以上options选项中有许多是我们用不到，我们先把它们注释掉。结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">options &#123;</div><div class="line">// listen-on port 53 &#123; 127.0.0.1; &#125;;</div><div class="line">// listen-on-v6 port 53 &#123; ::1; &#125;;</div><div class="line"> directory  <span class="string">"/var/named"</span>;</div><div class="line"> dump-file  <span class="string">"/var/named/data/cache_dump.db"</span>;</div><div class="line"> statistics-file <span class="string">"/var/named/data/named_stats.txt"</span>;</div><div class="line"> memstatistics-file <span class="string">"/var/named/data/named_mem_stats.txt"</span>;</div><div class="line">// allow-query &#123; localhost; &#125;;</div><div class="line">// recursion yes;</div><div class="line">// dnssec-enable yes;</div><div class="line">// dnssec-validation yes;</div><div class="line">// dnssec-lookaside auto;</div><div class="line"> /* Path to ISC DLV key */</div><div class="line">// bindkeys-file <span class="string">"/etc/named.iscdlv.key"</span>;</div><div class="line">// managed-keys-directory <span class="string">"/var/named/dynamic"</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="3-打开-etc-named-rfc1912-zones文件，添加一个区域。"><a href="#3-打开-etc-named-rfc1912-zones文件，添加一个区域。" class="headerlink" title="3.打开/etc/named.rfc1912.zones文件，添加一个区域。"></a>3.打开/etc/named.rfc1912.zones文件，添加一个区域。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/02.jpeg?raw=true)</p>
<ul>
<li>type: 用于定义区域类型，此时只有一个DNS服务器，所以为master，type可选值为：hint(根的)|master(主的)|slave(辅助的)|forward(转发)</li>
<li>file：用于定义区域数据文件路径，默认该文件保存在/var/named/目录。</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;区域添加好后，使用命令：named-checkconf 或 service named configtest测试配置文件语法格式。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/03.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;出错了！原来少了一个分号，配置文件的格式是每行后面都必须加分号结束，并且有花括号的地方，花括号两边必须要有空格。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/04.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;没有提示则表示文件语法正常。</p>
<h3 id="4-新建数据库文件-var-named-wubinary-com-zone，并添加资源记录。"><a href="#4-新建数据库文件-var-named-wubinary-com-zone，并添加资源记录。" class="headerlink" title="4.新建数据库文件/var/named/wubinary.com.zone，并添加资源记录。"></a>4.新建数据库文件/var/named/wubinary.com.zone，并添加资源记录。</h3><blockquote>
<p>资源记录的格式：<br> name [ttl] IN RRtype Value<br> 资源记录名 有效时间 IN 类型 资源记录的值</p>
<p>SOA: 只能有一个，而且必须是第一个<br> name: 只能是区域名称，通常可以简写为@<br> value: 主DNS服务器的FQDN</p>
<p>NS: 可以有多条<br> name: 区域名称，通常可以简写为@<br> value: DNS服务器的FQDN(可以使用相对名称)</p>
<p>A: 只能定义在正向区域文件中<br> name: FQDN(可以使用相对名称)<br> value: IP</p>
<p>MX: 可以有多个<br> name: 区域名称，用于标识smtp服务器<br> value: 包含优先级和FQDN<br> 优先级：0-99，数字越小，级别越高；</p>
<p>CNAME:<br> name: FQDN<br> value: FQDN</p>
<p>PTR: IP –&gt; FQDN, 只能定义在反向区域数据文件中，反向区域名称为逆向网络地址加.in-addr.arpa.后缀组成<br> name: IP, 逆向的主机地址，主机地址反过来写加上.in-addr.arpa.<br> value: FQDN</p>
</blockquote>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/05.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$TTL为定义的宏，表示下面资源记录ttl的值都为600秒。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@符号可代表区域文件/etc/named.conf里面定义的区域名称，即：”wubinary.com.”。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;每个区域的资源记录第一条必须是SOA，SOA后面接DNS服务器的域名和电子邮箱地址，此处电子邮箱地址里的@因为有特殊用途，所以此处要用点号代替。SOA后面小括号里的各值所代表的意义如下所示：</p>
<blockquote>
<p>@ IN SOA dns.wubinary.com dnsadmin.wubinary.com (<br> 2014031201 ;标识序列号，十进制数字，不能超过10位，通常使用日期<br> 2H ;刷新时间，即每隔多久到主服务器检查一次，此处为2小时<br> 4M ;重试时间，应该小于刷新时间，此处为4分钟<br> 1D ;过期时间，此处为1天<br> 2D ;主服务器挂后，从服务器至多工作的时间，此处为2天)</p>
</blockquote>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;区域数据文件配置好后，可以使用命令named-checkzone检查语法错误。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;命令格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">named-checkzone <span class="string">"zone_name"</span> zone_file_name</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/06.jpeg?raw=true)</p>
<h3 id="5-两个文件都配置好后，记得查看一下文件的所属组。因为bind程序的服务名称为named，bind默认是使用named组的身份操作文件，所以我们新建的文件所属组都要改为named，并且为了安全起见不能让别人有修改的权限，权限最好改为640。"><a href="#5-两个文件都配置好后，记得查看一下文件的所属组。因为bind程序的服务名称为named，bind默认是使用named组的身份操作文件，所以我们新建的文件所属组都要改为named，并且为了安全起见不能让别人有修改的权限，权限最好改为640。" class="headerlink" title="5.两个文件都配置好后，记得查看一下文件的所属组。因为bind程序的服务名称为named，bind默认是使用named组的身份操作文件，所以我们新建的文件所属组都要改为named，并且为了安全起见不能让别人有修改的权限，权限最好改为640。"></a>5.两个文件都配置好后，记得查看一下文件的所属组。因为bind程序的服务名称为named，bind默认是使用named组的身份操作文件，所以我们新建的文件所属组都要改为named，并且为了安全起见不能让别人有修改的权限，权限最好改为640。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/07.jpeg?raw=true)</p>
<h3 id="6-设置妥当当后我们就可以开启服务了。"><a href="#6-设置妥当当后我们就可以开启服务了。" class="headerlink" title="6.设置妥当当后我们就可以开启服务了。"></a>6.设置妥当当后我们就可以开启服务了。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/08.jpeg?raw=true)</p>
<h3 id="7-使用dig命令测试DNS。"><a href="#7-使用dig命令测试DNS。" class="headerlink" title="7.使用dig命令测试DNS。"></a>7.使用dig命令测试DNS。</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;命令格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dig [-t <span class="built_in">type</span>] [-x addr] [name] [@server]</div></pre></td></tr></table></figure>
<ul>
<li>-t: 指定资源类型，用于正解</li>
<li>-x: 指定IP地址，用于反解</li>
</ul>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/09.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;测试成功！</p>
<h3 id="8-以上配置的是DNS服务器的正向解析，接着再配置一下反向解析。编辑配置文件-etc-named-rfc1912-zones，添加一个反解区域。"><a href="#8-以上配置的是DNS服务器的正向解析，接着再配置一下反向解析。编辑配置文件-etc-named-rfc1912-zones，添加一个反解区域。" class="headerlink" title="8.以上配置的是DNS服务器的正向解析，接着再配置一下反向解析。编辑配置文件/etc/named.rfc1912.zones，添加一个反解区域。"></a>8.以上配置的是DNS服务器的正向解析，接着再配置一下反向解析。编辑配置文件/etc/named.rfc1912.zones，添加一个反解区域。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/10.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;因为反向解是和正向解析相反的，所以配置文件192.168.0.70.zone直接可以复制wubinary.com.zone修改。反向解析数据文件里面只有SOA、NS、PTR资源记录，所有A记录都要改为PTR记录，名称为IP地址，IP地址可以写全也可以简写，如果写全则是IP地址反写加上.in-addr.arpa.例如：70.0.168.192.in-addr.arpa. PTR资源记录的值为域名。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/11.jpeg?raw=true)</p>
<h3 id="9-检查配置文件语法。"><a href="#9-检查配置文件语法。" class="headerlink" title="9.检查配置文件语法。"></a>9.检查配置文件语法。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/12.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改权限</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/13.jpeg?raw=true)</p>
<h3 id="10-重新载入配置文件，并测试反向解析。"><a href="#10-重新载入配置文件，并测试反向解析。" class="headerlink" title="10.重新载入配置文件，并测试反向解析。"></a>10.重新载入配置文件，并测试反向解析。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/14.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;使用dig -x 测试反向解析。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/15.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;反向解析配置成功！</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注意：通常在应用中，DNS的反向解析并不是很重要，可以不配置，当服务器中有域名作为邮件服务器时，此时可以配置反向解析，因为邮件中过滤垃圾邮件的技术通常是解析邮箱地址，如果IP地址不能反解成一个域名则视为垃圾邮件。</p>
<h2 id="三、使用bind架设辅助DNS服务器，实现主从数据同步"><a href="#三、使用bind架设辅助DNS服务器，实现主从数据同步" class="headerlink" title="三、使用bind架设辅助DNS服务器，实现主从数据同步"></a>三、使用bind架设辅助DNS服务器，实现主从数据同步</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DNS从服务器也叫辅服DNS服务器，如果网络上某个节点只有一台DNS服务器的话，首先服务器的抗压能力是有限的，当压力达到一定的程度，服务器就会宕机罢工，其次如果这台服务器出现了硬件故障那么服务器管理的区域的域名将无法访问。为了解决这些问题，最好的办法就是使用多个DNS服务器同时工作，并实现数据的同步，这样两台服务器就都可以实现域名解析操作。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;主DNS服务器架设好后，辅助的DNS服务器的架设就相对简单多了。架设主从DNS服务器有两个前提条件，一是两台主机可以不一定处在同一网段，但是两台主机之间必须要实现网络通信；二，辅助DNS服务器必须要有主DNS服务器的授权，才可以正常操作。此时，我们以IP地址192.168.0.80作为我们辅助的DNS服务器的IP地址；</p>
<h3 id="1-设置IP地址；"><a href="#1-设置IP地址；" class="headerlink" title="1.设置IP地址；"></a>1.设置IP地址；</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/16.jpeg?raw=true)</p>
<h3 id="2-打开辅助DNS服务器的-etc-named-rfc1912-zones文件，添加两个区域记录，这两个记录是主DNS服务器配置文件里已经存在的记录，一个是正向解析记录，一个是反向解析记录。"><a href="#2-打开辅助DNS服务器的-etc-named-rfc1912-zones文件，添加两个区域记录，这两个记录是主DNS服务器配置文件里已经存在的记录，一个是正向解析记录，一个是反向解析记录。" class="headerlink" title="2.打开辅助DNS服务器的/etc/named.rfc1912.zones文件，添加两个区域记录，这两个记录是主DNS服务器配置文件里已经存在的记录，一个是正向解析记录，一个是反向解析记录。"></a>2.打开辅助DNS服务器的/etc/named.rfc1912.zones文件，添加两个区域记录，这两个记录是主DNS服务器配置文件里已经存在的记录，一个是正向解析记录，一个是反向解析记录。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/17.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;type: slave，表示此时DNS服务器为辅助DNS服务器，于是下面一行就要定义主DNS服务器的IP地址，辅助DNS服务器才知道去哪里同步数据。辅助DNS服务器的资源类型数据文件通常保存在slaves目录，只需定义一个名称，文件内容通常是自动生成。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;配置好后，直接开启DNS服务，然后再回到主DNS服务器上。</p>
<h3 id="3-修改主DNS服务器的数据文件，添加一条辅助DNS服务器记录，给辅助DNS服务器授权。"><a href="#3-修改主DNS服务器的数据文件，添加一条辅助DNS服务器记录，给辅助DNS服务器授权。" class="headerlink" title="3.修改主DNS服务器的数据文件，添加一条辅助DNS服务器记录，给辅助DNS服务器授权。"></a>3.修改主DNS服务器的数据文件，添加一条辅助DNS服务器记录，给辅助DNS服务器授权。</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改正向解析文件/var/named/wubinary.com.zone。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/18.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;添加了一条NS记录，值为，ns2.wubinary.com.，对应的A记录也要增加一条，把IP地址指向对应的辅助DNS服务器的IP地址。修改完成后，记得要把序列号的值加1，用于通知辅助DNS服务器自动更新数据文件。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改反向解析文件/var/named/192.168.0.70.zone。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/19.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;同样的也增加了两条记录，一条辅助DNS服务器的NS记录和对应的PTR记录。修改完成后记得所序列号的值加1，用于通知辅助DNS服务器自动更新数据文件。</p>
<h3 id="4-重新加载主DNS服务器的配置文件，这时再到回辅助DNS服务器，在-var-named-slaves-目录下会多了两个文件。"><a href="#4-重新加载主DNS服务器的配置文件，这时再到回辅助DNS服务器，在-var-named-slaves-目录下会多了两个文件。" class="headerlink" title="4.重新加载主DNS服务器的配置文件，这时再到回辅助DNS服务器，在/var/named/slaves/目录下会多了两个文件。"></a>4.重新加载主DNS服务器的配置文件，这时再到回辅助DNS服务器，在/var/named/slaves/目录下会多了两个文件。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/20.jpeg?raw=true   )</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;查看文件内容，可以看到该文件和主DNS服务器上的文件内容是一样的。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/21.jpeg?raw=true)</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/22.jpeg?raw=true)</p>
<h3 id="5-测试辅助DNS服务器。"><a href="#5-测试辅助DNS服务器。" class="headerlink" title="5.测试辅助DNS服务器。"></a>5.测试辅助DNS服务器。</h3><p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/23.jpeg?raw=true)</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/24.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在辅助DNS服务器上正向解析和反向解析都能测试成功！</p>
<h2 id="四、主从同步数据的安全性"><a href="#四、主从同步数据的安全性" class="headerlink" title="四、主从同步数据的安全性"></a>四、主从同步数据的安全性</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DNS服务器的数据同步默认是没有限定主机的，也就是说，网络上只要有一台DNS服务器向你的DNS服务器请求数据，都能实现数据同步，那么这样就相当的不安全了。我们可以使用一个选项allow-transfer，指定可以同步数据的主机IP。主DNS服务器的数据可以给别的服务器同步，相对的，辅助DNS服务器的数据也是可以给其它辅助DNS服务器同步，于是，所有的主从DNS服务器都要设置该参数。</p>
<h3 id="1-指定可以从主DNS服务器上同步数据的主机。"><a href="#1-指定可以从主DNS服务器上同步数据的主机。" class="headerlink" title="1.指定可以从主DNS服务器上同步数据的主机。"></a>1.指定可以从主DNS服务器上同步数据的主机。</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改/etc/named.rfc1912.zones文件：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/25.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在每块区域上添加参数allow-transfer，花括号内填写可以同步的主机IP，一般填写辅助DNS服务器的IP地址。可以使用dig命令测试，区域同步：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dig -t axfr ZONE_NAME @DNS_SERVCER_IP</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/26.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;指定IP可以同步数据。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/27.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;非指定IP不可以同步数据。</p>
<h3 id="2-指定可以从辅助DNS服务器上同步数据的主机。"><a href="#2-指定可以从辅助DNS服务器上同步数据的主机。" class="headerlink" title="2.指定可以从辅助DNS服务器上同步数据的主机。"></a>2.指定可以从辅助DNS服务器上同步数据的主机。</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;修改/etc/named.rfc1912.zones文件：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/28.jpeg?raw=true)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;我们只有一台辅助DNS服务器，所以根本不会有主机从这台机器同步数据，所以我们设置成不允许任何人同步。</p>
<h2 id="五、测试DNS解析的其它命令"><a href="#五、测试DNS解析的其它命令" class="headerlink" title="五、测试DNS解析的其它命令"></a>五、测试DNS解析的其它命令</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 测试DNS解析的命令不只是dig可以实现，还有两个命令也可以实现相同的效果。</p>
<h3 id="1-host命令"><a href="#1-host命令" class="headerlink" title="1.host命令"></a>1.host命令</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;host命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># host [-t type] &#123;name&#125; [server]</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/29.jpeg?raw=true)</p>
<h3 id="2-nslookup命令"><a href="#2-nslookup命令" class="headerlink" title="2.nslookup命令"></a>2.nslookup命令</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;这个命令很神奇，在windows的dos里面也可以使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">nslookup&gt;</div><div class="line">server DNS_SERVER_IP</div><div class="line"><span class="built_in">set</span> q=TYPE</div><div class="line">&#123;name&#125;</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%BA%8C" alt="">%EF%BC%9A%E4%BD%BF%E7%94%A8bind%E5%AE%9E%E7%8E%B0%E4%B8%BB%E4%BB%8EDNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/30.jpeg?raw=true)</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DNS/">DNS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Dns、Iredmaill/7. DNS服务器(一)：基本原理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Dns、Iredmaill/7. DNS服务器(一)：基本原理/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.884Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Dns、Iredmaill/7. DNS服务器(一)：基本原理/">
        DNS服务器(一)：基本原理
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;网络中的主机通信是通过IP地址来实现的，通常IPv4的地址是四个数字加点组成，如果和每台主机通信我们都要去记忆IP地址的话，这通常对于人类来讲是相当痛苦的。于是网络上就有了一套为了解决这个问题的方案出现了，也就是DNS主机名称解析系统。它是一套能够将数以千万计的IP地址通过查询DNS数据库，轻松的转化成与之对应的一串单词字符串，也就是主机名，网络上称之为域名，相对于IP地址，用单词组成的域名明显好记多了。</p>
<h2 id="二、DNS域名解析系统的层级关系"><a href="#二、DNS域名解析系统的层级关系" class="headerlink" title="二、DNS域名解析系统的层级关系"></a>二、DNS域名解析系统的层级关系</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DNS域名解析系统是有层级关系的，整个层级关系的表现形式就像一棵大树，每一层，我们称之为域。最顶层的域我们通常叫作根域，用点号表示，第二层通常用com、net、edu、gov、mil、org….，这层我们叫作顶级域，往下第三层，也就是我们经常见到的域名了，如,51cto.com，这一层我们称之为二级域，当二级域加上www后，就是第四层了，就这样一直往下细分。域名的写法通常是由小到大，从左往右书写，用点连接，最后加点表示根，整个结构如下图所示：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/DNS%E6%9C%8D%E5%8A%A1%E5%99%A8(%E4%B8%80" alt="">%EF%BC%9A%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/01.jpeg?raw=true)</p>
<h2 id="三、DNS的资源记录"><a href="#三、DNS的资源记录" class="headerlink" title="三、DNS的资源记录"></a>三、DNS的资源记录</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;我们要查询这些庞大数据当然要有专门的主机负责这些工作了，提供查询、存储DNS数据服务的主机我们称之为DNS服务器。网络上为了方便域名的注册、管理、解析，将DNS域名映射到特定类型的资源信息，我们称之为资源记录。资源记录是有类型的，</p>
<h3 id="资源记录类型"><a href="#资源记录类型" class="headerlink" title="资源记录类型"></a>资源记录类型</h3><table>
<thead>
<tr>
<th style="text-align:center">SOA</th>
<th style="text-align:center">NS</th>
<th style="text-align:center">MX</th>
<th style="text-align:center">A</th>
<th style="text-align:center">PTR</th>
<th style="text-align:center">AAAA</th>
<th style="text-align:center">CNAME</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">起始授权</td>
<td style="text-align:center">域名服务器</td>
<td style="text-align:center">邮件交换器</td>
<td style="text-align:center">域名–&gt;IP</td>
<td style="text-align:center">IP–&gt;域名</td>
<td style="text-align:center">域名–&gt;IPv6</td>
<td style="text-align:center">别名记录</td>
</tr>
<tr>
<td style="text-align:center">特点：只能有一个，而且必须是第一个</td>
<td style="text-align:center">特点：用于表示DNS服务器的域名地址</td>
<td style="text-align:center">特点：用于一个域下的邮件使用</td>
<td style="text-align:center">特点：我们经常用到的就是它了</td>
<td style="text-align:center">特点：和A记录相反，用于反向解析</td>
<td style="text-align:center">特点：基本不用</td>
<td style="text-align:center">特点：用于作A记录的域名的别名，</td>
</tr>
</tbody>
</table>
<h2 id="四、DNS服务器的工作原理"><a href="#四、DNS服务器的工作原理" class="headerlink" title="四、DNS服务器的工作原理"></a>四、DNS服务器的工作原理</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;假设我们以wubinary.blog.51cto.com为例：</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;第一步：当我们使用DNS客户端请求查询此域名的的A记录时，DNS服务器首先会判断所要查询域名是属于哪个区域，是否在自己的管辖范围，假设此次域名不在管辖范围。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;第二步：为了确定当前域名是在哪个级别，DNS服务器要向根询求帮助，根会向DNS服务器返回所在域名的顶级域的DNS服务器地址，也就是根的下一级com的DNS服务器地址。此时DNS服器根据这个地址又再次查询，此次查询获得了51cto.com的DNS的服务器地址。于是终于确定了wubinary.blog.51cto.com的区域所在的DNS服务器地址了。DNS服务器的此类确定一个地址，并使用这个址去查询下一个的查询方式我们称之为<strong>迭代查询</strong>。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;第三步：确定了区域地址后，51cto.com为了向DNS服务器返回结果需要一级一级的往下查。一开始查询到了blog.51cto.com的DNS服务器地址，于是blog.51cto.com的DNS服务器则向下查询。blog.51cto.com又查询到了wubinary.blog.51cto.com的DNS服务器地址，此时的地址正是DNS服务器要找的地址。到了这一步，wubinary.blog.51cto.com的DNS服务器则会把结果向它的上级汇报，于是上一级又向上一级汇报，最终结果回到了最初的DNS服务器，此时DNS客户端才能获得最终的IP地址。像这样DNS服务器的数据逐级遍历及逐级返回的过程，我们称之为<strong>递归查询</strong>。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;如果我们查询的域名正好和当前查询使用的DNS服务器所匹配，则DNS服务器会先查询本地缓存是否存在，如果存在则返回缓存数据，如果不存在则去数据文件中读取数据并运回结果。</p>
<h2 id="五、三个与解析有关的配置文件"><a href="#五、三个与解析有关的配置文件" class="headerlink" title="五、三个与解析有关的配置文件"></a>五、三个与解析有关的配置文件</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/etc/hosts：此文件早期在没有出现DNS服务器的时候，作用和DNS服务器类似，不过随着网络的发展，单个文件根本无法满足需求，于是，此文件通常运用于本地IP解析。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/etc/resolv.conf：定义DNS服务器IP地址，本地解析域名通常使用的都是这里面定义的IP地址。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/etc/nsswitch.conf：这个文件则是来决定先要使用/etc/hosts还是/etc/resolv.conf的设置。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;总结：理解DNS的树状结构、递归及迭代查询后，其它就好办了。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DNS/">DNS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Dns、Iredmaill/6. 递归查询和迭代查询的区别" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Dns、Iredmaill/6. 递归查询和迭代查询的区别/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.884Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Dns、Iredmaill/6. 递归查询和迭代查询的区别/">
        递归查询和迭代查询的区别
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="递归查询"><a href="#递归查询" class="headerlink" title="递归查询"></a>递归查询</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;递归查询是一种DNS 服务器的查询模式，在该模式下DNS 服务器接收到客户机请求，必须使用一个准确的查询结果回复客户机。如果DNS 服务器本地没有存储查询DNS 信息，那么该服务器会询问其他服务器，并将返回的查询结果提交给客户机。</p>
<h2 id="迭代查询"><a href="#迭代查询" class="headerlink" title="迭代查询"></a>迭代查询</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DNS 服务器另外一种查询方式为迭代查询，DNS 服务器会向客户机提供其他能够解析查询请求的DNS 服务器地址，当客户机发送查询请求时，DNS 服务器并不直接回复查询结果，而是告诉客户机另一台DNS 服务器地址，客户机再向这台DNS 服务器提交请求，依次循环直到返回查询的结果<br>为止。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;两种过程的示意图：</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2%E5%92%8C%E8%BF%AD%E4%BB%A3%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%8C%BA%E5%88%AB/01.gif?raw=true" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DNS/">DNS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Dns、Iredmaill/5. centos安装配置dnsmasq" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Dns、Iredmaill/5. centos安装配置dnsmasq/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.883Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Dns、Iredmaill/5. centos安装配置dnsmasq/">
        centos安装配置dnsmasq
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;公司业务使用的mydns搭建dns服务器（参考<a href="https://hcldirgit.github.io/2017/08/05/4.%20mydns%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">mydns安装配置</a>），使用mydns的优点是配置、更改容易，能实现自动增加记录，而缺点也是显而易见的，因为mydns使用mysql作为数据存储仓库，如果查询很频繁的话，就会影响效率，甚至导致服务中止。但这个缺点也不是不可克服，只要在前端多配置几台dns缓存服务器即可。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在centos上使用dnsmasq是不错的选择，安装简易，配置更容易。</p>
<ol>
<li>安装</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y dnsmasq</div></pre></td></tr></table></figure>
<ol>
<li>配置</li>
</ol>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;假如mydns服务器为 1.1.1.1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim  /etc/dnsmasq.conf</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;增加一行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">resolv-file=/etc/resolv_dnsmasq.conf</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;保存,然后编辑 /etc/resolv_dnsmasq.conf</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;增加一行 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nameserver 1.1.1.1</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;保存该文件，启动dnsmasq</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/dnsmasq  start</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DNS/">DNS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Dns、Iredmaill/4. mydns安装配置" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Dns、Iredmaill/4. mydns安装配置/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.882Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Dns、Iredmaill/4. mydns安装配置/">
        mydns安装配置
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<a href="http://mydns.bboy.net/download/mydns-1.1.0.tar.gz" target="_blank" rel="external">远程下载</a></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<a href="http://www.apelearn.com/bbs/data/attachment/forum/month_1002/mydns-mysql-1.1.0-1.i386.rpm" target="_blank" rel="external">rpm包下载</a></p>
<h2 id="1-因为mydns依赖mysql，所以需要先安装mysql。"><a href="#1-因为mydns依赖mysql，所以需要先安装mysql。" class="headerlink" title="1.因为mydns依赖mysql，所以需要先安装mysql。"></a>1.因为mydns依赖mysql，所以需要先安装mysql。</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y mysql-server</div></pre></td></tr></table></figure>
<h2 id="2-安装mydns"><a href="#2-安装mydns" class="headerlink" title="2 安装mydns"></a>2 安装mydns</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget  http://www.lishiming.net/data//a ... ql-1.1.0-1.i386.rpm</div><div class="line">rpm -ivh mydns-mysql-1.1.0-1.i386.rpm</div></pre></td></tr></table></figure>
<h2 id="3-创建库和表"><a href="#3-创建库和表" class="headerlink" title="3.创建库和表"></a>3.创建库和表</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql -uroot  -e <span class="string">"create database mydns"</span></div><div class="line">mysql -uroot mydns</div><div class="line">mysql&gt; CREATE TABLE `soa` (   `id` int(10) unsigned NOT NULL auto_increment,   `origin` char(255) default NULL,   `ns` char(255) default NULL,   `mbox` char(255) default NULL,   `serial` int(10) unsigned default <span class="string">'1'</span>,   `refresh` int(10) unsigned default <span class="string">'28800'</span>,   `retry` int(10) unsigned default <span class="string">'7200'</span>,   `expire` int(10) unsigned default <span class="string">'604800'</span>,   `minimum` int(10) unsigned default <span class="string">'86400'</span>,   `ttl` int(10) unsigned default <span class="string">'86400'</span>,   `xfer` char(255) default NULL,   PRIMARY KEY  (`id`),   UNIQUE KEY `origin` (`origin`) ) ENGINE=MyISAM AUTO_INCREMENT=4 DEFAULT CHARSET=gbk;</div><div class="line"></div><div class="line">mysql&gt;  CREATE TABLE `rr` (   `id` int(10) unsigned NOT NULL auto_increment,   `zone` int(10) unsigned NOT NULL,   `name` char(64) default NULL,   `<span class="built_in">type</span>` enum(<span class="string">'A'</span>,<span class="string">'AAAA'</span>,<span class="string">'CNAME'</span>,<span class="string">'HINFO'</span>,<span class="string">'MX'</span>,<span class="string">'NAPTR'</span>,<span class="string">'NS'</span>,<span class="string">'PTR'</span>,<span class="string">'RP'</span>,<span class="string">'SRV'</span>,<span class="string">'TXT'</span>) default NULL,   `data` char(128) default NULL,   `aux` int(10) unsigned NOT NULL,   `ttl` int(10) unsigned NOT NULL default <span class="string">'600'</span>,   `inter` tinyint(3) unsigned NOT NULL default <span class="string">'1'</span>,   `intra` tinyint(3) unsigned NOT NULL default <span class="string">'1'</span>,   PRIMARY KEY  (`id`),   KEY `name` (`name`),   KEY `rr` (`zone`,`name`,`<span class="built_in">type</span>`,`data`) ) ENGINE=MyISAM AUTO_INCREMENT=1437896 DEFAULT CHARSET=gbk;</div></pre></td></tr></table></figure>
<h2 id="4-创建第一个zone"><a href="#4-创建第一个zone" class="headerlink" title="4.创建第一个zone"></a>4.创建第一个zone</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; use mydns</div><div class="line">mysql&gt; insert into soa (id, origin,ns,mbox,serial,refresh,retry,expire,minimum,ttl) values(1,<span class="string">'abc.com.'</span>, <span class="string">'ns.abc.com.'</span>,  <span class="string">'root.aminglinux.com'</span>, 1, 28800, 7200, 604800, 86400, 86400);</div><div class="line">mysql&gt; insert into rr values(1, 1, <span class="string">'www'</span>, <span class="string">'A'</span>, <span class="string">'1.1.1.1'</span>, 0, 1, 1, 1, 1);</div></pre></td></tr></table></figure>
<h2 id="5-配置"><a href="#5-配置" class="headerlink" title="5.配置"></a>5.配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show create table soa\G;</div><div class="line"></div><div class="line"></div><div class="line">CREATE TABLE `soa` (   `id` int(10) unsigned NOT NULL auto_increment,   `origin` char(255) default NULL,   `ns` char(255) default NULL,   `mbox` char(255) default NULL,   `serial` int(10) unsigned default <span class="string">'1'</span>,   `refresh` int(10) unsigned default <span class="string">'28800'</span>,   `retry` int(10) unsigned default <span class="string">'7200'</span>,   `expire` int(10) unsigned default <span class="string">'604800'</span>,   `minimum` int(10) unsigned default <span class="string">'86400'</span>,   `ttl` int(10) unsigned default <span class="string">'86400'</span>,   `xfer` char(255) default NULL,   PRIMARY KEY  (`id`),   UNIQUE KEY `origin` (`origin`) ) ENGINE=MyISAM AUTO_INCREMENT=4 DEFAULT CHARSET=gbk;</div><div class="line"></div><div class="line">mysql&gt; show create table rr\G;</div><div class="line">*************************** 1. row ***************************</div><div class="line">       Table: rr</div><div class="line">CREATE TABLE `rr` (   `id` int(10) unsigned NOT NULL auto_increment,   `zone` int(10) unsigned NOT NULL,   `name` char(64) default NULL,   `<span class="built_in">type</span>` enum(<span class="string">'A'</span>,<span class="string">'AAAA'</span>,<span class="string">'CNAME'</span>,<span class="string">'HINFO'</span>,<span class="string">'MX'</span>,<span class="string">'NAPTR'</span>,<span class="string">'NS'</span>,<span class="string">'PTR'</span>,<span class="string">'RP'</span>,<span class="string">'SRV'</span>,<span class="string">'TXT'</span>) default NULL,   `data` char(128) default NULL,   `aux` int(10) unsigned NOT NULL,   `ttl` int(10) unsigned NOT NULL default <span class="string">'600'</span>,   `inter` tinyint(3) unsigned NOT NULL default <span class="string">'1'</span>,   `intra` tinyint(3) unsigned NOT NULL default <span class="string">'1'</span>,   PRIMARY KEY  (`id`),   KEY `name` (`name`),   KEY `rr` (`zone`,`name`,`<span class="built_in">type</span>`,`data`) ) ENGINE=MyISAM AUTO_INCREMENT=1437896 DEFAULT CHARSET=gbk;</div><div class="line"></div><div class="line">mysql&gt; select * from soa <span class="built_in">where</span> id=3;</div><div class="line">+----+--------------+--------------+---------------------+--------+---------+-------+--------+---------+-------+------+</div><div class="line">| id | origin       | ns           | mbox                | serial | refresh | retry | expire | minimum | ttl   | xfer |</div><div class="line">+----+--------------+--------------+---------------------+--------+---------+-------+--------+---------+-------+------+</div><div class="line">|  3 | example.com. | ns.example.com. | julyclyde.gmail.com |      1 |   28800 |  7200 | 604800 |   86400 | 86400 | NULL |</div><div class="line"></div><div class="line">mysql&gt; select * from rr <span class="built_in">where</span> id=1;</div><div class="line">+----+------+------+------+----------------+-----+-----+-------+-------+</div><div class="line">| id | zone | name | <span class="built_in">type</span> | data           | aux | ttl | inter | intra |</div><div class="line">+----+------+------+------+----------------+-----+-----+-------+-------+</div><div class="line">|  1 |    1 | www  | A    | 1.1.1.1 |   0 |   1 |     1 |     1 |</div><div class="line"></div><div class="line">cat  /etc/mydns.conf</div><div class="line"></div><div class="line"><span class="comment">##</span></div><div class="line"><span class="comment">##  /etc/mydns.conf</span></div><div class="line"><span class="comment">##  Wed Nov 19 10:04:14 2008</span></div><div class="line"><span class="comment">##  For more information, see mydns.conf(5).</span></div><div class="line"><span class="comment">##</span></div><div class="line"></div><div class="line"></div><div class="line">                                <span class="comment"># DATABASE INFORMATION</span></div><div class="line"></div><div class="line">db-host = localhost             <span class="comment"># SQL server hostname</span></div><div class="line">db-user = yourdbname                 <span class="comment"># SQL server username</span></div><div class="line">db-password = yourpassword          <span class="comment"># SQL server password</span></div><div class="line">database = dns                  <span class="comment"># MyDNS database name</span></div><div class="line"></div><div class="line"></div><div class="line">                                <span class="comment"># GENERAL OPTIONS</span></div><div class="line"></div><div class="line">user = nobody                   <span class="comment"># Run with the permissions of this user</span></div><div class="line">group = nobody                  <span class="comment"># Run with the permissions of this group</span></div><div class="line">listen = *                         <span class="comment"># Listen on these addresses ('*' for all)</span></div><div class="line">no-listen =                     <span class="comment"># Do not listen on these addresses</span></div><div class="line"></div><div class="line"></div><div class="line">                                <span class="comment"># CACHE OPTIONS</span></div><div class="line"></div><div class="line">zone-cache-size = 1024          <span class="comment"># Maximum number of elements stored in the zone cache</span></div><div class="line">zone-cache-expire = 60          <span class="comment"># Number of seconds after which cached zones expires</span></div><div class="line">reply-cache-size = 1024         <span class="comment"># Maximum number of elements stored in the reply cache</span></div><div class="line">reply-cache-expire = 30         <span class="comment"># Number of seconds after which cached replies expire</span></div><div class="line"></div><div class="line"></div><div class="line">                                <span class="comment"># ESOTERICA</span></div><div class="line"></div><div class="line"><span class="built_in">log</span> = /var/<span class="built_in">log</span>/mydns.log                <span class="comment"># Facility to use for program output (LOG_*/stdout/stderr)</span></div><div class="line">pidfile = /var/run/mydns.pid    <span class="comment"># Path to PID file</span></div><div class="line">timeout = 120                   <span class="comment"># Number of seconds after which queries time out</span></div><div class="line">multicpu = 4                    <span class="comment"># Number of CPUs installed on your system - (deprecated)</span></div><div class="line">servers = 2                     <span class="comment"># Number of servers to run</span></div><div class="line">recursive = 8.8.8.8                     <span class="comment"># Location of recursive resolver</span></div><div class="line">recursive-timeout =             <span class="comment"># Number of seconds before first retry</span></div><div class="line">recursive-retries =             <span class="comment"># Number of retries before abandoning recursion</span></div><div class="line">recursive-algorithm =           <span class="comment"># Recursion retry algorithm one of: linear, exponential, progressive</span></div><div class="line">allow-axfr = no                 <span class="comment"># Should AXFR be enabled?</span></div><div class="line">allow-tcp = no                  <span class="comment"># Should TCP be enabled?</span></div><div class="line">allow-update = no               <span class="comment"># Should DNS UPDATE be enabled?</span></div><div class="line">ignore-minimum = no             <span class="comment"># Ignore minimum TTL for zone?</span></div><div class="line">soa-table = soa                 <span class="comment"># Name of table containing SOA records</span></div><div class="line">rr-table = rr                   <span class="comment"># Name of table containing RR data</span></div><div class="line">use-soa-active = no             <span class="comment"># Use the soa active attribute if provided</span></div><div class="line">use-rr-active = no              <span class="comment"># Use the rr active attribute if provided</span></div><div class="line">notify-enabled = no             <span class="comment"># Enable notify from updates</span></div><div class="line">notify-source = 0.0.0.0         <span class="comment"># Source address for ipv4 notify messages</span></div><div class="line">notify-source6 = 0.0.0.0        <span class="comment"># Source address for ipv6 notify messages</span></div><div class="line">notify-timeout = 60             <span class="comment"># Number of seconds before first retry</span></div><div class="line">notify-retries = 5              <span class="comment"># Number of retries before abandoning notify</span></div><div class="line">notify-algorithm = linear       <span class="comment"># Notify retry algorithm one of: linear, exponential, progressive</span></div><div class="line">ixfr-enabled = no               <span class="comment"># Enable IXFR functionality</span></div><div class="line">ixfr-gc-enabled = no            <span class="comment"># Enable IXFR GC functionality</span></div><div class="line">ixfr-gc-interval = 86400        <span class="comment"># How often to run GC for IXFR</span></div><div class="line">ixfr-gc-delay = 600             <span class="comment"># Delay until first IXFR GC runs</span></div><div class="line">extended-data-support = no      <span class="comment"># Support extended data fields for large TXT records</span></div><div class="line">dbengine = MyISAM               <span class="comment"># Support different database engines</span></div><div class="line">wildcard-recursion = 0          <span class="comment"># Wildcard ancestor search levels</span></div><div class="line">soa-where =                     <span class="comment"># Extra WHERE clause for SOA queries</span></div><div class="line">rr-where =    inter=1                   <span class="comment"># Extra WHERE clause for RR queries</span></div></pre></td></tr></table></figure>
<h2 id="6-启动"><a href="#6-启动" class="headerlink" title="6.启动"></a>6.启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/mydns start</div></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DNS/">DNS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Dns、Iredmaill/2. DNS介绍" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/09/03/Dns、Iredmaill/2. DNS介绍/" class="article-date">
  	<time datetime="2017-09-02T18:00:30.881Z" itemprop="datePublished">2017-09-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/03/Dns、Iredmaill/2. DNS介绍/">
        DNS介绍
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;DNS 为 Domain Name System （域名系统）的缩写，它是一种将 ip 地址转换成对应的主机名或将主机名转换成与之相对应 ip 的一种服务机制。其中通过域名解析出 ip 地址的叫做正向解析，通过 ip 地址解析出域名的叫做反向解析。 DNS 使用 TCP 和 UDP ，端口号都是53，但它主要使用 UDP ，服务器之间备份使用 TCP 。全世界只有 13 台 “根”服务器，1 个根服务器放在美国，其他 12 台为辅根服务器，DNS 服务器根据角色可以分为：主 DNS 、从 DNS 、缓存 DNS 服务器，DNS 转发服务器。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;首先来看看域名的结构组成，平时访问网站的时候，都会用一个域名去请求，比如 www.baidu.com ，其实在 com 后面还有一个点，这个点叫做根域。下图是一个域名的树状结构，根域下面会有 .com  .cn  .net 等顶级域，在顶级域下面又有了第二层域，比如 www.baidu.com 或者 .com.cn ，而 www.baidu.com则为子域，我们经常用子域来作为网站的域名。</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/dns%20%E4%BB%8B%E7%BB%8D/01.png?raw=true" alt=""></p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;有了网站域名，下面来看看，域名是如何解析到 ip 的，下图为域名解析过程流程图</p>
<p><img src="https://github.com/hcldirgit/image/blob/master/dns%20%E4%BB%8B%E7%BB%8D/02.png?raw=true" alt=""></p>
<ol>
<li><p>在浏览器中输入 www.sina.com.cn 域名，操作系统会先检查子机本地的 hosts 文件是否有这个网站映射关系，如果有，就先调用这个 IP 地址映射，完成域名解析。</p>
</li>
<li><p>如果 hosts 里没有这个域名的映射，则查找本地 DNS 解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。</p>
</li>
<li><p>如果 hosts 与本地 DNS 解析器缓存都没有相应的网址映射关系，首先会找本机设置的首选 DNS 服务器，在此我们叫它本地 DNS 服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。</p>
</li>
<li><p>如果要查询的域名，不由本地 DNS 服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个 IP 地址映射，完成域名解析，此解析不具有权威性。</p>
</li>
<li><p>如果本地 DNS 服务器本地区域文件与缓存解析都失效，则分局本地 DNS 服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地 DNS 就把请求发至 13 台根 DNS ，根 DNS 服务器收到请求后会判断这个域名是谁来授权管理 ，并会返回一个负责该顶级域名服务器的一个 IP 。本地 DNS 服务器收到 IP 信息后，将会联系负责 域的这台服务器。这台负责 域的服务器收到请求后，如果自己无法解析，它就会找一个管理 管理域的下一级 DNS 服务器地址给本地 DNS 服务器。当本地 DNS 服务器收到这个地址后，就会找这个域服务器，重复上面的动作，进行查询，直至找到 www.sina.com.cn 主机。</p>
</li>
<li><p>如果用的是转发模式，此 DNS 服务器就会把请求转发至上一级服务器进行解析，上一级服务器如果不能解析，或找根 DNS 或把转请求转至上上级，以此循环。不管是本地 DNS 服务器用是是转发，还是根提示，最后都是把结果返回给本地 DNS 服务器，由此 DNS 服务器再返回给客户机。</p>
</li>
</ol>
<p><img src="https://github.com/hcldirgit/image/blob/master/dns%20%E4%BB%8B%E7%BB%8D/03.png?raw=true" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DNS/">DNS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/39/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/38/">38</a><a class="page-number" href="/page/39/">39</a><span class="page-number current">40</span><a class="page-number" href="/page/41/">41</a><a class="page-number" href="/page/42/">42</a><span class="space">&hellip;</span><a class="page-number" href="/page/63/">63</a><a class="extend next" rel="next" href="/page/41/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2017 失落的乐章
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    

<script>
	var yiliaConfig = {
		fancybox: ,
		mathjax: ,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



  </div>
</body>
</html>