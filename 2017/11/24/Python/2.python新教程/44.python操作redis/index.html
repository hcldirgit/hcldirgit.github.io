<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>python操作redis | 失落的乐章</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;redis的概念：redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。这些数据类型都支持push/pop、add/rem">
<meta name="keywords" content="Python">
<meta property="og:type" content="article">
<meta property="og:title" content="python操作redis">
<meta property="og:url" content="https://hcldirgit.github.io/2017/11/24/Python/2.python新教程/44.python操作redis/index.html">
<meta property="og:site_name" content="失落的乐章">
<meta property="og:description" content="&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;redis的概念：redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。这些数据类型都支持push/pop、add/rem">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-12-06T15:14:22.585Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python操作redis">
<meta name="twitter:description" content="&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;redis的概念：redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。这些数据类型都支持push/pop、add/rem">
  
    <link rel="alternative" href="/atom.xml" title="失落的乐章" type="application/atom+xml">
  
  
    <link rel="icon" href="https://github.com/hcldirgit/image/blob/master/0.png?raw=true">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-85415703-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">失落的乐章</a></h1>
		</hgroup>

		
		<p class="header-subtitle">技术面前，永远都是学生。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Ansible/" style="font-size: 10.45px;">Ansible</a> <a href="/tags/Apache/" style="font-size: 18.64px;">Apache</a> <a href="/tags/Cacti/" style="font-size: 11.36px;">Cacti</a> <a href="/tags/DNS/" style="font-size: 13.18px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10.91px;">Docker</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10.91px;">FTP</a> <a href="/tags/FastDFS/" style="font-size: 10px;">FastDFS</a> <a href="/tags/Git/" style="font-size: 12.73px;">Git</a> <a href="/tags/HA集群/" style="font-size: 11.36px;">HA集群</a> <a href="/tags/Hadoop/" style="font-size: 12.27px;">Hadoop</a> <a href="/tags/Jenkins/" style="font-size: 10.45px;">Jenkins</a> <a href="/tags/Kafka/" style="font-size: 10px;">Kafka</a> <a href="/tags/Kubernetes/" style="font-size: 10.45px;">Kubernetes</a> <a href="/tags/LAMP/" style="font-size: 19.09px;">LAMP</a> <a href="/tags/LNMP/" style="font-size: 16.82px;">LNMP</a> <a href="/tags/LVS/" style="font-size: 15.91px;">LVS</a> <a href="/tags/Linux/" style="font-size: 19.09px;">Linux</a> <a href="/tags/Linux命令/" style="font-size: 20px;">Linux命令</a> <a href="/tags/Linux安全/" style="font-size: 14.09px;">Linux安全</a> <a href="/tags/Memcached/" style="font-size: 11.36px;">Memcached</a> <a href="/tags/MongoDB/" style="font-size: 15.45px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 17.73px;">MySQL</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/Nagios/" style="font-size: 11.36px;">Nagios</a> <a href="/tags/Nginx/" style="font-size: 18.18px;">Nginx</a> <a href="/tags/OpenStack/" style="font-size: 10.91px;">OpenStack</a> <a href="/tags/Php/" style="font-size: 14.55px;">Php</a> <a href="/tags/Puppet/" style="font-size: 10.91px;">Puppet</a> <a href="/tags/Python/" style="font-size: 18.64px;">Python</a> <a href="/tags/Redis/" style="font-size: 16.36px;">Redis</a> <a href="/tags/Resin/" style="font-size: 10px;">Resin</a> <a href="/tags/Saltstack/" style="font-size: 10px;">Saltstack</a> <a href="/tags/Samba/" style="font-size: 11.82px;">Samba</a> <a href="/tags/Squid/" style="font-size: 14.55px;">Squid</a> <a href="/tags/Tomcat/" style="font-size: 13.64px;">Tomcat</a> <a href="/tags/Zabbix/" style="font-size: 17.27px;">Zabbix</a> <a href="/tags/Zookeeper/" style="font-size: 10px;">Zookeeper</a> <a href="/tags/haproxy/" style="font-size: 12.27px;">haproxy</a> <a href="/tags/keepalived/" style="font-size: 12.73px;">keepalived</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/shell练习/" style="font-size: 19.55px;">shell练习</a> <a href="/tags/正则表达式/" style="font-size: 12.73px;">正则表达式</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">失落的乐章</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">失落的乐章</h1>
			</hgroup>
			
			<p class="header-subtitle">技术面前，永远都是学生。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Python/2.python新教程/44.python操作redis" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/24/Python/2.python新教程/44.python操作redis/" class="article-date">
  	<time datetime="2017-11-24T14:52:09.789Z" itemprop="datePublished">2017-11-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      python操作redis
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;redis的概念：redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。在此基础上，redis支持各种不同方式的排序。与memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Redis 是一个高性能的key-value数据库。 redis的出现，很大程度补偿了memcached这类key/value存储的不足，在部 分场合可以对关系数据库起到很好的补充作用。它提供了Java，C/C++，C#，PHP，JavaScript，Perl，Object-C，Python，Ruby，Erlang等客户端，使用很方便。</p>
<a id="more"></a>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Redis支持主从同步。数据可以从主服务器向任意数量的从服务器上同步，从服务器可以是关联其他从服务器的主服务器。这使得Redis可执行单层树复制。存盘可以有意无意的对数据进行写操作。由于完全实现了发布/订阅机制，使得从数据库在任何地方同步树时，可订阅一个频道并接收主服务器完整的消息发布记录。同步对读取操作的可扩展性和数据冗余很有帮助。</p>
<h2 id="Redis的安装"><a href="#Redis的安装" class="headerlink" title="Redis的安装"></a>Redis的安装</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Redis一般都是安装在linux系统中，具体安装步骤如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#cd /usr/local/src</span></div><div class="line"><span class="comment">#wget http://download.redis.io/releases/redis-3.0.1.tar.gz </span></div><div class="line"><span class="comment">#tar xzf redis-3.0.1.tar.gz </span></div><div class="line"><span class="comment">#cd redis-3.0.1 </span></div><div class="line"><span class="comment">#make</span></div><div class="line"><span class="comment">#src/redis-server &amp;</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;检查redis是否正常启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Ps –ef |grep redis</div><div class="line">Netstat –lnp |grep 6379</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;安装redis的客户端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Pip install redis</div></pre></td></tr></table></figure>
<h2 id="简单操作"><a href="#简单操作" class="headerlink" title="简单操作"></a>简单操作</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;redis是以key-value的形式存储的，所以我们在操作的时候。首先我们将redis所在主机的ip和发布端口作为参数实例化了一个对象r，然后执行set(‘name’,’I love you!’)，这样我们就在内存中存储了一个key为shang，值为‘I love you!’的项。我们可以理解为{‘shang’:’I love you!’},当我们要读取的之后，keys()就是获得多有key值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> redis</div><div class="line"></div><div class="line">r = redis.Redis(host=<span class="string">"192.168.48.128"</span>, port=<span class="number">6379</span>)</div><div class="line">r.set(<span class="string">"shang"</span>, <span class="string">"I love you!"</span>)</div><div class="line">print(r.get(<span class="string">"shang"</span>))</div><div class="line">print(r.keys())</div><div class="line"><span class="comment"># print(dir(r))</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">I love you!</div><div class="line">[<span class="string">'shang'</span>, <span class="string">'ajing'</span>]</div></pre></td></tr></table></figure>
<h2 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;redis-py使用connection pool来管理对一个redis server的所有连接，避免每次建立、释放连接的开销。默认，每个Redis实例都会维护一个自己的连接池。可以直接建立一个连接池，然后作为参数Redis，这样就可以实现多个Redis实例共享一个连接池</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment"># @Time    : 2017/9/17 23:54</span></div><div class="line"><span class="comment"># @Author  : yanyi</span></div><div class="line"><span class="comment"># @File    : demon2.py</span></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"></div><div class="line">pool = redis.ConnectionPool(host=<span class="string">"192.168.48.128"</span>)</div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line">r.set(<span class="string">"name"</span>, <span class="string">"yanyi"</span>)</div><div class="line">print(r.get(<span class="string">"name"</span>))</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yanyi</div></pre></td></tr></table></figure>
<h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;redis-py默认在执行每次请求都会创建（连接池申请连接）和断开（归还连接池）一次连接操作，如果想要在一次请求中指定多个命令，则可以使用pipline实现一次请求指定多个命令，并且默认情况下一次pipline 是原子性操作。减少功耗</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;redis是一个cs模式的tcp server，使用和http类似的请求响应协议。一个client可以通过一个socket连接发起多个请求命令。每个请求命令发出后client通常会阻塞并等待redis服务处理，redis处理完后请求命令后会将结果通过响应报文返回给client。基本的通信过程如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Client: INCR X</div><div class="line">Server: <span class="number">1</span></div><div class="line">Client: INCR X</div><div class="line">Server: <span class="number">2</span></div><div class="line">Client: INCR X</div><div class="line">Server: <span class="number">3</span></div><div class="line">Client: INCR X</div><div class="line">Server: <span class="number">4</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;基本上四个命令需要8个tcp报文才能完成。由于通信会有网络延迟,假如从client和server之间的包传输时间需要0.125秒。那么上面的四个命令8个报文至少会需要1秒才能完成。这样即使redis每秒能处理100个命令，而我们的client也只能一秒钟发出四个命令。这显示没有充分利用 redis的处理能力。除了可以利用mget,mset 之类的单条命令处理多个key的命令外我们还可以利用pipeline的方式从client打包多条命令一起发出，不需要等待单条命令的响应返回，而redis服务端会处理完多条命令后会将多条命令的处理结果打包到一起返回给客户端。通信过程如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Client: INCR X</div><div class="line">Client: INCR X</div><div class="line">Client: INCR X</div><div class="line">Client: INCR X</div><div class="line">Server: <span class="number">1</span></div><div class="line">Server: <span class="number">2</span></div><div class="line">Server: <span class="number">3</span></div><div class="line">Server: <span class="number">4</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;假设不会因为tcp报文过长而被拆分。可能两个tcp报文就能完成四条命令，client可以将四个命令放到一个tcp报文一起发送，server则可以将四条命令的处理结果放到一个tcp报文返回。通过pipeline方式当有大批量的操作时候。我们可以节省很多原来浪费在网络延迟的时间。需要注意到是用 pipeline方式打包命令发送，redis必须在处理完所有命令前先缓存起所有命令的处理结果。打包的命令越多，缓存消耗内存也越多。所以并是不是打包的命令越多越好。具体多少合适需要根据具体情况测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment"># @Time    : 2017/10/9 22:45</span></div><div class="line"><span class="comment"># @Author  : yanyi</span></div><div class="line"><span class="comment"># @File    : demon4.py</span></div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"><span class="keyword">import</span> redis</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">withpipe</span><span class="params">(r)</span>:</span></div><div class="line">    pipe = r.pipeline(transaction=<span class="keyword">True</span>)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">1000</span>):</div><div class="line">        key = <span class="string">"test1"</span> +str(i)</div><div class="line">        value = <span class="string">"test1"</span> + str(i)</div><div class="line">        pipe.set(key, value)</div><div class="line">    pipe.execute()</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">withoutpipe</span><span class="params">(r)</span>:</span></div><div class="line">    <span class="comment"># pipe = r.pipeline(transaction=True)</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">1000</span>):</div><div class="line">        key = <span class="string">"test1"</span> + str(i)</div><div class="line">        value = <span class="string">"test1"</span> + str(i)</div><div class="line">        r.set(key, value)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    pool = redis.ConnectionPool(host=<span class="string">"192.168.48.131"</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>)</div><div class="line">    r1 = redis.Redis(connection_pool=pool)</div><div class="line">    r2 = redis.Redis(connection_pool=pool)</div><div class="line">    start = datetime.datetime.now()</div><div class="line">    <span class="comment"># print(start)</span></div><div class="line">    withpipe(r1)</div><div class="line">    end = datetime.datetime.now()</div><div class="line">    <span class="comment"># print((end-start).microseconds)</span></div><div class="line">    <span class="comment"># print(end-start)</span></div><div class="line">    t_time = (end - start).microseconds</div><div class="line">    print(<span class="string">"withpipe time is : &#123;0&#125;"</span>.format(t_time))</div><div class="line"></div><div class="line">    start = datetime.datetime.now()</div><div class="line">    withoutpipe(r2)</div><div class="line">    end = datetime.datetime.now()</div><div class="line">    t_time = (end - start).microseconds</div><div class="line">    print(<span class="string">"withoutpipe time is : &#123;0&#125;"</span>.format(t_time))</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">withpipe time <span class="keyword">is</span> : <span class="number">28000</span></div><div class="line">withoutpipe time <span class="keyword">is</span> : <span class="number">253000</span></div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reids目前提供5种数据类型：string类型, list类型， set集合类型， 有序集合类型， hash类型，下面我们就来详细介绍他们的使用。</p>
<h2 id="string操作"><a href="#string操作" class="headerlink" title="string操作"></a>string操作</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;redis中的string在内存中都是按照一个key对应一个value来存储的。如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r.set(“name”, “lingxiangxiang”)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;set的使用方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">set(name, value, ex=<span class="keyword">None</span>, px=<span class="keyword">None</span>, nx=<span class="keyword">False</span>, xx=<span class="keyword">False</span>)</div><div class="line">     ex，过期时间（秒）</div><div class="line">     px，过期时间（毫秒）</div><div class="line">     nx，如果设置为<span class="keyword">True</span>，则只有name不存在时，当前set操作才执行,同setnx(name, value)</div><div class="line">     xx，如果设置为<span class="keyword">True</span>，则只有name存在时，当前set操作才执行<span class="string">'''</span></div><div class="line"><span class="string">get(name)   　　获取值</span></div><div class="line"><span class="string">print(r.get("name"))</span></div><div class="line"><span class="string">mset()		批量设置值</span></div><div class="line"><span class="string">r.mset(name1="shang", name2="ling")</span></div><div class="line"><span class="string">r.mset(&#123;"name3": "kong", "name4": "gu"&#125;)</span></div><div class="line"><span class="string">mget(keys, *args)			批量获取值</span></div><div class="line"><span class="string">print(r.mget("name1", "name2", "name3", "name4"))</span></div><div class="line"><span class="string">append(name, value)</span></div><div class="line"><span class="string">r.append("name","lisi")</span></div><div class="line"><span class="string">print(r.get("name"))</span></div></pre></td></tr></table></figure>
<h2 id="list操作"><a href="#list操作" class="headerlink" title="list操作"></a>list操作</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;redis中的List在在内存中按照一个name对应一个List来存储</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">lpush(name,values)</div><div class="line"><span class="comment"># 在name对应的list中添加元素，每个新的元素都添加到列表的最左边</span></div><div class="line">r.lpush(<span class="string">"list_name"</span>,<span class="number">2</span>)</div><div class="line">r.lpush(<span class="string">"list_name"</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)<span class="comment">#保存在列表中的顺序为5，4，3，2</span></div><div class="line">rpush(name,values)</div><div class="line"><span class="comment">#同lpush，但每个新的元素都添加到列表的最右边</span></div><div class="line">lpushx(name,value)</div><div class="line"><span class="comment">#在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边</span></div><div class="line">rpushx(name,value)</div><div class="line"><span class="comment">#在name对应的list中添加元素，只有name已经存在时，值添加到列表的最右边</span></div><div class="line">llen(name)</div><div class="line"><span class="comment"># name对应的list元素的个数</span></div><div class="line">print(r.llen(<span class="string">"list_name"</span>))、</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linsert(name,where,refvalue,value)：在name对应的列表的某一个值前后插入一个新值</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数：</p>
<ul>
<li>name，redis的name</li>
<li>where，BEFORE或AFTER</li>
<li>refvalue，标杆值，即：在它前后插入数据</li>
<li>value，要插入的数据</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.lset(name,index,value)：对name对应的list中的某一个索引位置重新赋值。</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数：</p>
<ul>
<li>name，redis的name</li>
<li>index，list的索引位置</li>
<li>value，要设置的值</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;r.lrem(name,value,num):在name对应的list中删除指定的值</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数：</p>
<ul>
<li>name，redis的name</li>
<li>value，要删除的值</li>
<li>num，  num=0，删除列表中所有的指定值；<ul>
<li>num=2,从前到后，删除2个；</li>
<li>num=-2,从后向前，删除2个</li>
</ul>
</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lpop(name)：在name对应的列表的左侧获取第一个元素并在列表中移除，返回值删除那个元素的值</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;扩展： rpop(name) 表示从右向左操作</p>
<ul>
<li>lindex(name,index)：在name对应的列表中根据索引取列表元素</li>
<li>lrange(name,start,end)：在name对应的列表分片获取数据</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="comment"># @Time    : 2017/10/10 21:20</span></div><div class="line"><span class="comment"># @Author  : yanyi</span></div><div class="line"><span class="comment"># @File    : demon6.py</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"></div><div class="line">pool = redis.ConnectionPool(host=<span class="string">"192.168.48.131"</span>, port=<span class="number">6379</span>, db=<span class="number">0</span>)</div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"><span class="comment"># lpush  在list的左边增加一个元素           left</span></div><div class="line"><span class="comment"># rpush  在list的右边增加一个元素           right</span></div><div class="line">r.lpush(<span class="string">"list1"</span>, <span class="string">"test1"</span>)</div><div class="line">r.rpush(<span class="string">"list1"</span>, <span class="string">"ling"</span>)</div><div class="line">r.lpush(<span class="string">"list1"</span>, <span class="string">"test2"</span>)</div><div class="line">r.lpush(<span class="string">"list1"</span>, <span class="string">"test3"</span>)</div><div class="line">r.lpush(<span class="string">"list1"</span>, <span class="string">"test2"</span>)</div><div class="line">r.lpush(<span class="string">"list1"</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</div><div class="line">r.lpush(<span class="string">"list1"</span>, <span class="string">"test2"</span>)</div><div class="line">print(r.lrange(<span class="string">"list1"</span>, <span class="number">0</span>, <span class="number">-1</span>))</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;最终的list结果是 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="string">"test3"</span>, <span class="string">"test2"</span>, <span class="string">"test1"</span>, <span class="string">"ling"</span>]</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在中间位置增加一个元素，linsert(name,where,refvalue,value)</p>
<ul>
<li>name   代表的是list对应的key值</li>
<li>where     AFTER   BEFORE</li>
<li>refvalue    list中的某个元素</li>
<li>value      你要增加的值是什么</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">r.linsert(<span class="string">"list1"</span>, <span class="string">"AFTER"</span>,  <span class="string">"test2"</span>, <span class="string">"hello"</span>)</div><div class="line">print(r.lrange(<span class="string">"list1"</span>, <span class="number">0</span>, <span class="number">-1</span>))</div><div class="line">r.lset(<span class="string">"list1"</span>, <span class="number">2</span>, <span class="string">"world"</span>)</div><div class="line"><span class="comment"># lset  更改某个元素的值</span></div><div class="line"><span class="comment"># r.lset(name,index,value)</span></div><div class="line">print(r.lrange(<span class="string">"list1"</span>, <span class="number">0</span>, <span class="number">-1</span>))</div><div class="line">print(r.lindex(<span class="string">"list1"</span>, <span class="number">2</span>))</div><div class="line"><span class="comment"># lindex   查看list某个下标的值</span></div><div class="line">print(r.lpop(<span class="string">"list1"</span>))</div><div class="line"><span class="comment"># lpop从list的最左边删除一个元素，返回删除元素的值</span></div><div class="line">print(r.lrange(<span class="string">"list1"</span>, <span class="number">0</span>, <span class="number">-1</span>))</div><div class="line">r.lrem(<span class="string">"list1"</span>, <span class="string">"world"</span>)</div><div class="line"></div><div class="line"><span class="comment"># r.lrem(name,value,num):</span></div><div class="line"><span class="comment"># num，  num=0，删除列表中所有的指定值；</span></div><div class="line">    <span class="comment"># num=2,从前到后，删除2个；</span></div><div class="line">    <span class="comment"># num=-2,从后向前，删除2个</span></div><div class="line"></div><div class="line">print(r.lrange(<span class="string">"list1"</span>, <span class="number">0</span>, <span class="number">-1</span>))</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="string">'test2'</span>, <span class="string">'4'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'test2'</span>, <span class="string">'test3'</span>, <span class="string">'test2'</span>, <span class="string">'test1'</span>, <span class="string">'ling'</span>]</div><div class="line">[<span class="string">'test2'</span>, <span class="string">'hello'</span>, <span class="string">'4'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'test2'</span>, <span class="string">'test3'</span>, <span class="string">'test2'</span>, <span class="string">'test1'</span>, <span class="string">'ling'</span>]</div><div class="line">[<span class="string">'test2'</span>, <span class="string">'hello'</span>, <span class="string">'world'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'test2'</span>, <span class="string">'test3'</span>, <span class="string">'test2'</span>, <span class="string">'test1'</span>, <span class="string">'ling'</span>]</div><div class="line">world</div><div class="line">test2</div><div class="line">[<span class="string">'hello'</span>, <span class="string">'world'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'test2'</span>, <span class="string">'test3'</span>, <span class="string">'test2'</span>, <span class="string">'test1'</span>, <span class="string">'ling'</span>]</div><div class="line">[<span class="string">'hello'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'test2'</span>, <span class="string">'test3'</span>, <span class="string">'test2'</span>, <span class="string">'test1'</span>, <span class="string">'ling'</span>]</div></pre></td></tr></table></figure>
<h2 id="set操作"><a href="#set操作" class="headerlink" title="set操作"></a>set操作</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;set集合就是不重复的列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sadd(name,values)</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;给name对应的集合中添加元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">r.sadd(<span class="string">"set_name"</span>,<span class="string">"aa"</span>)</div><div class="line">r.sadd(<span class="string">"set_name"</span>,<span class="string">"aa"</span>,<span class="string">"bb"</span>)</div><div class="line">smembers(name)</div><div class="line"><span class="comment">#获取name对应的集合的所有成员</span></div><div class="line">scard(name)</div><div class="line"><span class="comment">#获取name对应的集合中的元素个数</span></div><div class="line">r.scard(<span class="string">"set_name"</span>)</div><div class="line">sinter(keys, *args)</div><div class="line"><span class="comment"># 获取多个name对应集合的并集</span></div><div class="line">r.sadd(<span class="string">"set_name"</span>,<span class="string">"aa"</span>,<span class="string">"bb"</span>)</div><div class="line">r.sadd(<span class="string">"set_name1"</span>,<span class="string">"bb"</span>,<span class="string">"cc"</span>)</div><div class="line">r.sadd(<span class="string">"set_name2"</span>,<span class="string">"bb"</span>,<span class="string">"cc"</span>,<span class="string">"dd"</span>)</div><div class="line"></div><div class="line">print(r.sinter(<span class="string">"set_name"</span>,<span class="string">"set_name1"</span>,<span class="string">"set_name2"</span>))</div><div class="line"></div><div class="line"><span class="comment">#输出:</span></div><div class="line"></div><div class="line">｛bb｝</div><div class="line"></div><div class="line">sismember(name, value)</div><div class="line"><span class="comment">#检查value是否是name对应的集合内的元素</span></div><div class="line">spop(name)</div><div class="line"><span class="comment">#从集合的右侧移除一个元素，并将其返回</span></div><div class="line">sunion(keys, *args)</div><div class="line"><span class="comment">#获取多个name对应的集合的并集</span></div><div class="line">r.sunion(<span class="string">"set_name"</span>,<span class="string">"set_name1"</span>,<span class="string">"set_name2"</span>)</div><div class="line">srem(name, value)  删除集合中的某个元素</div><div class="line">r.srem(<span class="string">"set_name"</span>, <span class="string">"aa"</span>)</div></pre></td></tr></table></figure>
<h2 id="Hash类型操作"><a href="#Hash类型操作" class="headerlink" title="Hash类型操作"></a>Hash类型操作</h2><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Redis在内存中存储hash类型是以name对应一个字典形式存储的</p>
<h3 id="hset-name-key-value"><a href="#hset-name-key-value" class="headerlink" title="hset(name,key,value)"></a>hset(name,key,value)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name对应的hash中设置一个键值对(不存在，则创建；否则，修改)</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数：</p>
<ul>
<li>name:redis的name</li>
<li>key:key1对应的hash中的key</li>
<li>value:value1对应的hash中的value</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;注：hsetx(name,key,value),当name对应的hash中不存在当前key则创建(相当于添加)</p>
<h3 id="hget-name-key"><a href="#hget-name-key" class="headerlink" title="hget(name,key)"></a>hget(name,key)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在name对应的hash中获取根据key获取value</p>
<h3 id="hmset-name-mapping"><a href="#hmset-name-mapping" class="headerlink" title="hmset(name,mapping)"></a>hmset(name,mapping)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在name对应的hash中批量设置键值对</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数：</p>
<ul>
<li>name：redis的name</li>
<li>mapping：字典，如{‘k1’:’v1’,’k2’,’v2’}</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'192.168.10.128'</span>,port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"> </div><div class="line">r.hmset(<span class="string">'test'</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;)</div><div class="line">print(r.hmget(<span class="string">'test'</span>,<span class="string">'k1'</span>,<span class="string">'k2'</span>))</div><div class="line">``` </div><div class="line"></div><div class="line">&amp;<span class="comment">#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;结果</span></div><div class="line"></div><div class="line">```python</div><div class="line">[<span class="string">b'v1'</span>, <span class="string">b'v2'</span>]</div></pre></td></tr></table></figure>
<h3 id="hmget-name-keys-args"><a href="#hmget-name-keys-args" class="headerlink" title="hmget(name,keys,*args)"></a>hmget(name,keys,*args)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;在name对应的hash中获取多个key的值</p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;参数：</p>
<ul>
<li>name：redis对应的name</li>
<li>keys：要获取key的集合，如：[‘k1’,’k2’,’k3’]</li>
<li>*args：要获取的key,如：k1,k2,k3</li>
</ul>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'192.168.10.128'</span>,port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"> </div><div class="line">r.hmset(<span class="string">'test'</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;)</div><div class="line"></div><div class="line">print(r.hmget(<span class="string">'test'</span>,<span class="string">'k1'</span>,<span class="string">'k2'</span>))   <span class="comment">#获取多个值</span></div></pre></td></tr></table></figure>
<h3 id="hgetall-name-：获取name对应hash的所有键值"><a href="#hgetall-name-：获取name对应hash的所有键值" class="headerlink" title="hgetall(name)：获取name对应hash的所有键值"></a>hgetall(name)：获取name对应hash的所有键值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'192.168.10.128'</span>,port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"> </div><div class="line">r.hmset(<span class="string">'test'</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;)</div><div class="line"> </div><div class="line">print(r.hgetall(<span class="string">'test'</span>))</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="string">b'k2'</span>: <span class="string">b'v2'</span>, <span class="string">b'k1'</span>: <span class="string">b'v1'</span>&#125;</div></pre></td></tr></table></figure>
<h3 id="hlen-name-：获取name对应的hash中键值的个数"><a href="#hlen-name-：获取name对应的hash中键值的个数" class="headerlink" title="hlen(name)：获取name对应的hash中键值的个数"></a>hlen(name)：获取name对应的hash中键值的个数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'192.168.10.128'</span>,port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"> </div><div class="line">r.hmset(<span class="string">'test'</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;)</div><div class="line"> </div><div class="line">print(r.hlen(<span class="string">'test'</span>))</div><div class="line">``` </div><div class="line"></div><div class="line">&amp;<span class="comment">#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;结果：</span></div><div class="line"></div><div class="line">```python</div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
<h3 id="hkeys-name-：获取name对应的hash中所有的key的值"><a href="#hkeys-name-：获取name对应的hash中所有的key的值" class="headerlink" title="hkeys(name)：获取name对应的hash中所有的key的值"></a>hkeys(name)：获取name对应的hash中所有的key的值</h3><h3 id="hvals-name-：获取name对应的hash中所有的value的值"><a href="#hvals-name-：获取name对应的hash中所有的value的值" class="headerlink" title="hvals(name)：获取name对应的hash中所有的value的值"></a>hvals(name)：获取name对应的hash中所有的value的值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'192.168.10.128'</span>,port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"> </div><div class="line">r.hmset(<span class="string">'test'</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;)</div><div class="line"> </div><div class="line">print(r.hkeys(<span class="string">'test'</span>))</div><div class="line">print(r.hvals(<span class="string">'test'</span>))</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[<span class="string">b'k2'</span>, <span class="string">b'k1'</span>]</div><div class="line">[<span class="string">b'v2'</span>, <span class="string">b'v1'</span>]</div></pre></td></tr></table></figure>
<h3 id="hexists-name-key-：检查name对应的hash是否存在当前传入的key"><a href="#hexists-name-key-：检查name对应的hash是否存在当前传入的key" class="headerlink" title="hexists(name,key)：检查name对应的hash是否存在当前传入的key"></a>hexists(name,key)：检查name对应的hash是否存在当前传入的key</h3><h3 id="hdel-name-keys-：将name对应的hash中指定key的键值对删除"><a href="#hdel-name-keys-：将name对应的hash中指定key的键值对删除" class="headerlink" title="hdel(name,*keys)：将name对应的hash中指定key的键值对删除"></a>hdel(name,*keys)：将name对应的hash中指定key的键值对删除</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'192.168.10.128'</span>,port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"> </div><div class="line">r.hmset(<span class="string">'test'</span>,&#123;<span class="string">'k1'</span>:<span class="string">'v1'</span>,<span class="string">'k2'</span>:<span class="string">'v2'</span>&#125;)</div><div class="line"> </div><div class="line">print(r.exists(<span class="string">'test'</span>))</div><div class="line">print(r.hdel(<span class="string">'test'</span>,<span class="string">'k1'</span>))</div><div class="line">print(r.hmget(<span class="string">'test'</span>,<span class="string">'k1'</span>,<span class="string">'k2'</span>))</div></pre></td></tr></table></figure>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">True</span></div><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="其他常用操作"><a href="#其他常用操作" class="headerlink" title="其他常用操作"></a>其他常用操作</h2><h3 id="delete-names"><a href="#delete-names" class="headerlink" title="delete(*names)"></a>delete(*names)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;根据name删除redis中的任意数据类型</p>
<h3 id="exists-name"><a href="#exists-name" class="headerlink" title="exists(name)"></a>exists(name)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;检测redis的name是否存在</p>
<h3 id="keys-pattern-’-’"><a href="#keys-pattern-’-’" class="headerlink" title="keys(pattern=’*’)"></a>keys(pattern=’*’)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;根据* ？等通配符匹配获取redis的name</p>
<h3 id="expire-name-time"><a href="#expire-name-time" class="headerlink" title="expire(name ,time)"></a>expire(name ,time)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;为某个name设置超时时间</p>
<h3 id="rename-src-dst"><a href="#rename-src-dst" class="headerlink" title="rename(src, dst)"></a>rename(src, dst)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;重命名</p>
<h3 id="move-name-db"><a href="#move-name-db" class="headerlink" title="move(name, db))"></a>move(name, db))</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;将redis的某个值移动到指定的db下</p>
<h3 id="type-name"><a href="#type-name" class="headerlink" title="type(name)"></a>type(name)</h3><p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;获取name对应值的类型</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/06/Python/2.python新教程/45.python操作memcached/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          python操作memcached
        
      </div>
    </a>
  
  
    <a href="/2017/11/24/Python/2.python新教程/43.python操作nosql数据库/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">python操作nosql数据库</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>


<div class="ds-share share" data-thread-key="Python/2.python新教程/44.python操作redis" data-title="python操作redis" data-url="https://hcldirgit.github.io/2017/11/24/Python/2.python新教程/44.python操作redis/"  data-images="https://github.com/hcldirgit/image/blob/master/0.png?raw=true" data-content="python操作redis">
    <div class="ds-share-inline">
      <ul  class="ds-share-icons-16">
      	<li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
        <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
        <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
      </ul>
      <div class="ds-share-icons-more">
      </div>
    </div>
 </div>
 





</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2018 失落的乐章
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>